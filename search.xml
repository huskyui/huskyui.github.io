<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>leetcode-22æ‹¬å·ç”Ÿæˆ</title>
      <link href="/2020/11/14/leetcode-22%E6%8B%AC%E5%8F%B7%E7%94%9F%E6%88%90/"/>
      <url>/2020/11/14/leetcode-22%E6%8B%AC%E5%8F%B7%E7%94%9F%E6%88%90/</url>
      
        <content type="html"><![CDATA[<pre><code>//æ•°å­— n ä»£è¡¨ç”Ÿæˆæ‹¬å·çš„å¯¹æ•°ï¼Œè¯·ä½ è®¾è®¡ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºèƒ½å¤Ÿç”Ÿæˆæ‰€æœ‰å¯èƒ½çš„å¹¶ä¸” æœ‰æ•ˆçš„ æ‹¬å·ç»„åˆã€‚ //// //// ç¤ºä¾‹ï¼š //// è¾“å…¥ï¼šn = 3//è¾“å‡ºï¼š[//       &quot;((()))&quot;,//       &quot;(()())&quot;,//       &quot;(())()&quot;,//       &quot;()(())&quot;,//       &quot;()()()&quot;//     ]// // Related Topics å­—ç¬¦ä¸² å›æº¯ç®—æ³• // ğŸ‘ 1356 ğŸ‘ 0import java.util.ArrayList;import java.util.List;//leetcode submit region begin(Prohibit modification and deletion)class Solution {    // å…¨å±€å˜é‡    private List&lt;String&gt; list = new ArrayList&lt;&gt;();    public List&lt;String&gt; generateParenthesis(int n) {        // ç”Ÿæˆé¢˜ç›®å½“ç„¶ä¸èƒ½æ˜¯forå¾ªç¯ç”Ÿæˆ        dfs(0, 0, n, &quot;&quot;);        return list;    }    public void dfs(int left, int right, int n, String path) {        // æ’é™¤æ‰ æ‹¬å·æ•°é‡å¤ªå¤šçš„é€‰æ‰‹        if (left &gt; n || right &gt; n) {            return;        }        // å¦‚æœå³è¾¹å¤§äºå·¦è¾¹ï¼Œé‚£ä¹ˆå°±åˆ é™¤å½“å‰é€‰æ‰‹        if (right&gt;left) {            return;        }        // final champion        if (left + right == 2 * n) {            list.add(path);            return;        }        dfs(left + 1, right, n, path + &quot;(&quot;);        dfs(left, right + 1, n, path + &quot;)&quot;);    }}//leetcode submit region end(Prohibit modification and deletion)</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>zookeeper-2</title>
      <link href="/2020/04/24/zookeeper-2/"/>
      <url>/2020/04/24/zookeeper-2/</url>
      
        <content type="html"><![CDATA[<h4 id="javaè¿æ¥"><a href="#javaè¿æ¥" class="headerlink" title="javaè¿æ¥"></a>javaè¿æ¥</h4><p>pom</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- åœ¨æäº¤åˆ°githubçš„æ—¶å€™ï¼Œæç¤ºè®©ä½¿ç”¨3.4.14ä»¥åçš„ç‰ˆæœ¬ --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- &lt;version&gt;[3.4.14,)&lt;/version&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.zookeeper/zookeeper --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.14<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/log4j/log4j --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.16<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.slf4j/slf4j-api --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.6.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>zookeeper-1</title>
      <link href="/2020/04/20/zookeeper-1/"/>
      <url>/2020/04/20/zookeeper-1/</url>
      
        <content type="html"><![CDATA[<h4 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">ZooKeeper: A Distributed Coordination Service for Distributed Applications</span><br><span class="line">zooKeeper:ä¸€ä¸ªåˆ†å¸ƒå¼åº”ç”¨çš„åˆ†å¸ƒå¼åè°ƒæœåŠ¡</span><br><span class="line">ZooKeeper is a distributed, open-source coordination service for distributed applications. It exposes a simple set of primitives that distributed applications can build upon to implement higher level services for synchronization, configuration maintenance, and groups and naming. It is designed to be easy to program to, and uses a data model styled after the familiar directory tree structure of file systems. It runs in Java and has bindings for both Java and C.</span><br><span class="line">zooKeeperæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼åº”ç”¨çš„åˆ†å¸ƒå¼ï¼Œå¼€æºï¼Œåè°ƒæœåŠ¡ã€‚å®ƒæä¾›äº†ä¸€ç»„ç®€å•çš„åŸè¯­ï¼Œåˆ†å¸ƒå¼åº”ç”¨å¯ä»¥åœ¨è¿™äº›åŸè¯­åŸºç¡€ä¸Šå®ç°æ›´é«˜çº§çš„æœåŠ¡ï¼Œç”¨äºåŒæ­¥ï¼Œé…ç½®ç»´æŠ¤ï¼Œç»„åˆå‘½åã€‚å®ƒè¢«è®¾è®¡æ˜“äºä½¿ç”¨ï¼Œå¹¶ä½¿ç”¨äº†é£æ ¼å’Œæ–‡ä»¶ç³»ç»Ÿç›¸ä¼¼çš„æ•°æ®æ¨¡å‹ã€‚å®ƒåœ¨javaè¿è¡Œï¼Œå¹¶å…·æœ‰javaå’Œcç»‘å®šã€‚</span><br><span class="line">Coordination services are notoriously hard to get right. They are especially prone to errors such as race conditions and deadlock. The motivation behind ZooKeeper is to relieve distributed applications the responsibility of implementing coordination services from scratch.</span><br><span class="line">åè°ƒæœåŠ¡æ˜¯å‡ºäº†åçš„éš¾å†™ã€‚ä»–ä»¬ç‰¹åˆ«å®¹æ˜“å‡ºç°ç«äº‰æ¡ä»¶å’Œæ­»é”é”™è¯¯ã€‚zookeeperèƒŒåçš„åŠ¨æœºæ˜¯ä¸ºäº†å‡å°‘åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºä»å¤´å®ç°åè°ƒæœåŠ¡çš„è´£ä»»ã€‚</span><br><span class="line">Design Goals</span><br><span class="line">ZooKeeper is simple. ZooKeeper allows distributed processes to coordinate with each other through a shared hierarchical namespace which is organized similarly to a standard file system. The namespace consists of data registers - called znodes, in ZooKeeper parlance - and these are similar to files and directories. Unlike a typical file system, which is designed for storage, ZooKeeper data is kept in-memory, which means ZooKeeper can achieve high throughput and low latency numbers.</span><br><span class="line">zooKeeperæ˜¯ç®€å•çš„ã€‚zooKeeperå…è®¸åˆ†å¸ƒå¼è¿›ç¨‹é€šè¿‡å…±äº«çš„å±‚æ¬¡å‘½åç©ºé—´ç›¸äº’åè°ƒï¼Œè¯¥å‘½åç©ºé—´ç±»ä¼¼äºæ ‡å‡†æ–‡ä»¶ç³»ç»Ÿã€‚å‘½åç©ºé—´ç”±æ•°æ®å¯„å­˜å™¨æ³¨å†Œï¼Œç”¨zooKeeperçš„è¯è¯´å«znodesï¼Œç±»ä¼¼äºæ–‡ä»¶ç³»ç»Ÿä¸­çš„ç›®å½•å’Œæ–‡ä»¶ã€‚ä¸åƒå…¸å‹çš„æ–‡ä»¶ç³»ç»Ÿï¼Œzookeeperæ˜¯è®¾è®¡ç”¨äºä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œæ„å‘³ç€zooKeeperå¯ä»¥å®ç°é«˜ååé‡å’Œä½å»¶è¿Ÿç‡ã€‚</span><br><span class="line">The ZooKeeper implementation puts a premium on high performance, highly available, strictly ordered access. The performance aspects of ZooKeeper means it can be used in large, distributed systems. The reliability aspects keep it from being a single point of failure. The strict ordering means that sophisticated synchronization primitives can be implemented at the client.</span><br><span class="line">ZooKeeperå®æ–½å¯¹é«˜æ€§èƒ½ï¼Œé«˜å¯ç”¨æ€§ï¼Œä¸¥æ ¼æœ‰åºè®¿é—®åŠ ä»¥é‡è§†ã€‚ ZooKeeperçš„æ€§èƒ½æ–¹é¢æ„å‘³ç€å®ƒå¯ä»¥åœ¨å¤§å‹çš„åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ä½¿ç”¨ã€‚ å¯é æ€§æ–¹é¢ä½¿å®ƒä¸ä¼šæˆä¸ºå•ç‚¹æ•…éšœã€‚ ä¸¥æ ¼æ’åºæ„å‘³ç€å¯ä»¥åœ¨å®¢æˆ·ç«¯ä¸Šå®ç°å¤æ‚çš„åŒæ­¥åŸè¯­ã€‚</span><br><span class="line">ZooKeeper is replicated. Like the distributed processes it coordinates, ZooKeeper itself is intended to be replicated over a set of hosts called an ensemble.</span><br><span class="line">ZooKeeperæ˜¯å¤åˆ¶çš„ã€‚ä¸å®ƒæ‰€åè°ƒçš„åˆ†å¸ƒå¼è¿›ç¨‹ä¸€æ ·ï¼ŒZooKeeperæœ¬èº«ä¹Ÿæ‰“ç®—åœ¨ä¸€ç»„ç§°ä¸ºé›†åˆçš„ä¸»æœºä¸Šè¿›è¡Œå¤åˆ¶ã€‚</span><br><span class="line">The servers that make up the ZooKeeper service must all know about each other. They maintain an in-memory image of state, along with a transaction logs and snapshots in a persistent store. As long as a majority of the servers are available, the ZooKeeper service will be available.</span><br><span class="line">ç»„æˆZooKeeperæœåŠ¡çš„æœåŠ¡å™¨å¿…é¡»ç›¸äº’äº†è§£ã€‚å®ƒä»¬åœ¨å†…å­˜ä¸­ç»´æŠ¤çŠ¶æ€æ˜ åƒï¼Œä»¥åŠæŒä¹…å­˜å‚¨ä¸­çš„äº‹åŠ¡æ—¥å¿—å’Œå¿«ç…§ã€‚åªè¦å¤§å¤šæ•°æœåŠ¡å™¨å¯ç”¨ï¼ŒZooKeeperæœåŠ¡å°±å¯ç”¨ã€‚</span><br><span class="line">Clients connect to a single ZooKeeper server. The client maintains a TCP connection through which it sends requests, gets responses, gets watch events, and sends heart beats. If the TCP connection to the server breaks, the client will connect to a different server.</span><br><span class="line">å®¢æˆ·ç«¯è¿æ¥åˆ°å•ä¸ªZooKeeperæœåŠ¡å™¨ã€‚å®¢æˆ·ç«¯ç»´æŠ¤ä¸€ä¸ªTCPè¿æ¥ï¼Œé€šè¿‡å®ƒå‘é€è¯·æ±‚ã€è·å–å“åº”ã€è·å–ç›‘è§†äº‹ä»¶å’Œå‘é€å¿ƒè·³ã€‚å¦‚æœåˆ°æœåŠ¡å™¨çš„TCPè¿æ¥ä¸­æ–­ï¼Œå®¢æˆ·æœºå°†è¿æ¥åˆ°å¦ä¸€å°æœåŠ¡å™¨ã€‚</span><br><span class="line">ZooKeeper is ordered. ZooKeeper stamps each update with a number that reflects the order of all ZooKeeper transactions. Subsequent operations can use the order to implement higher-level abstractions, such as synchronization primitives.</span><br><span class="line">Zookeeperæ˜¯æœ‰åºçš„ã€‚ZooKeeperç”¨ä¸€ä¸ªæ•°å­—æ¥æ ‡è®°æ¯ä¸ªæ›´æ–°ï¼Œè¿™ä¸ªæ•°å­—åæ˜ äº†æ‰€æœ‰ZooKeeperäº‹åŠ¡çš„é¡ºåºã€‚åç»­æ“ä½œå¯ä»¥ä½¿ç”¨è¯¥é¡ºåºå®ç°æ›´é«˜çº§åˆ«çš„æŠ½è±¡ï¼Œæ¯”å¦‚åŒæ­¥åŸè¯­ã€‚</span><br><span class="line">ZooKeeper is fast. It is especially fast in &quot;read-dominant&quot; workloads. ZooKeeper applications run on thousands of machines, and it performs best where reads are more common than writes, at ratios of around 10:1.</span><br><span class="line">ZooKeeperå¾ˆå¿«ã€‚åœ¨â€œä»¥è¯»å–ä¸ºä¸»â€çš„å·¥ä½œè´Ÿè½½ä¸­ï¼Œå®ƒçš„é€Ÿåº¦ç‰¹åˆ«å¿«ã€‚ZooKeeperåº”ç”¨ç¨‹åºè¿è¡Œåœ¨æ•°åƒå°æœºå™¨ä¸Šï¼Œå½“è¯»æ“ä½œæ¯”å†™æ“ä½œæ›´å¸¸è§æ—¶ï¼Œå®ƒçš„æ€§èƒ½æœ€å¥½ï¼Œæ¯”ç‡çº¦ä¸º10:1ã€‚</span><br><span class="line">Data model and the hierarchical namespace</span><br><span class="line">The namespace provided by ZooKeeper is much like that of a standard file system. A name is a sequence of path elements separated by a slash (&#x2F;). Every node in ZooKeeper&#39;s namespace is identified by a path.</span><br><span class="line">æ•°æ®æ¨¡å‹å’Œåˆ†å±‚åç§°ç©ºé—´</span><br><span class="line"></span><br><span class="line">ZooKeeperæä¾›çš„åç§°ç©ºé—´ä¸æ ‡å‡†æ–‡ä»¶ç³»ç»Ÿçš„åç§°ç©ºé—´éå¸¸ç›¸ä¼¼ã€‚ åç§°æ˜¯ç”±æ–œæ ï¼ˆ&#x2F;ï¼‰åˆ†éš”çš„ä¸€ç³»åˆ—è·¯å¾„å…ƒç´ ã€‚ ZooKeeperå‘½åç©ºé—´ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½ç”±è·¯å¾„æ ‡è¯†ã€‚</span><br><span class="line">Nodes and ephemeral nodes</span><br><span class="line">Unlike standard file systems, each node in a ZooKeeper namespace can have data associated with it as well as children. It is like having a file-system that allows a file to also be a directory. (ZooKeeper was designed to store coordination data: status information, configuration, location information, etc., so the data stored at each node is usually small, in the byte to kilobyte range.) We use the term znode to make it clear that we are talking about ZooKeeper data nodes.</span><br><span class="line"></span><br><span class="line">Znodes maintain a stat structure that includes version numbers for data changes, ACL changes, and timestamps, to allow cache validations and coordinated updates. Each time a znode&#39;s data changes, the version number increases. For instance, whenever a client retrieves data it also receives the version of the data.</span><br><span class="line"></span><br><span class="line">The data stored at each znode in a namespace is read and written atomically. Reads get all the data bytes associated with a znode and a write replaces all the data. Each node has an Access Control List (ACL) that restricts who can do what.</span><br><span class="line"></span><br><span class="line">ZooKeeper also has the notion of ephemeral nodes. These znodes exists as long as the session that created the znode is active. When the session ends the znode is deleted.</span><br><span class="line">èŠ‚ç‚¹å’ŒçŸ­æš‚èŠ‚ç‚¹</span><br><span class="line"></span><br><span class="line">ä¸æ ‡å‡†æ–‡ä»¶ç³»ç»Ÿä¸åŒï¼ŒZooKeeperå‘½åç©ºé—´ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥å…·æœ‰ä¸å…¶å…³è”çš„æ•°æ®ä»¥åŠå­èŠ‚ç‚¹ã€‚ å°±åƒæ‹¥æœ‰ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿä¸€æ ·ï¼Œè¯¥æ–‡ä»¶ç³»ç»Ÿä¹Ÿå…è®¸æ–‡ä»¶æˆä¸ºç›®å½•ã€‚ ï¼ˆZooKeeperæ—¨åœ¨å­˜å‚¨åè°ƒæ•°æ®ï¼šçŠ¶æ€ä¿¡æ¯ï¼Œé…ç½®ï¼Œä½ç½®ä¿¡æ¯ç­‰ï¼Œå› æ­¤å­˜å‚¨åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„æ•°æ®é€šå¸¸å¾ˆå°ï¼Œåœ¨å­—èŠ‚åˆ°åƒå­—èŠ‚èŒƒå›´å†…ã€‚ï¼‰æˆ‘ä»¬ä½¿ç”¨æœ¯è¯­znodeæ¥æ˜ç¡®è¡¨ç¤º åœ¨è°ˆè®ºZooKeeperæ•°æ®èŠ‚ç‚¹ã€‚</span><br><span class="line"></span><br><span class="line">Znodesç»´æŠ¤ä¸€ä¸ªç»Ÿè®¡ä¿¡æ¯ç»“æ„ï¼Œå…¶ä¸­åŒ…æ‹¬ç”¨äºæ•°æ®æ›´æ”¹ï¼ŒACLæ›´æ”¹å’Œæ—¶é—´æˆ³çš„ç‰ˆæœ¬å·ï¼Œä»¥å…è®¸è¿›è¡Œç¼“å­˜éªŒè¯å’Œåè°ƒæ›´æ–°ã€‚ znodeçš„æ•°æ®æ¯æ¬¡æ›´æ”¹æ—¶ï¼Œç‰ˆæœ¬å·éƒ½ä¼šå¢åŠ ã€‚ ä¾‹å¦‚ï¼Œæ¯å½“å®¢æˆ·ç«¯æ£€ç´¢æ•°æ®æ—¶ï¼Œå®ƒä¹Ÿæ¥æ”¶æ•°æ®çš„ç‰ˆæœ¬ã€‚</span><br><span class="line"></span><br><span class="line">åŸå­åœ°è¯»å–å’Œå†™å…¥å­˜å‚¨åœ¨åç§°ç©ºé—´ä¸­æ¯ä¸ªznodeä¸Šçš„æ•°æ®ã€‚ è¯»å–å°†è·å–ä¸znodeå…³è”çš„æ‰€æœ‰æ•°æ®å­—èŠ‚ï¼Œè€Œå†™å…¥å°†æ›¿æ¢æ‰€æœ‰æ•°æ®ã€‚ æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªè®¿é—®æ§åˆ¶åˆ—è¡¨ï¼ˆACLï¼‰ï¼Œç”¨äºé™åˆ¶è°å¯ä»¥æ‰§è¡Œæ“ä½œã€‚</span><br><span class="line"></span><br><span class="line">ZooKeeperè¿˜å…·æœ‰çŸ­æš‚èŠ‚ç‚¹çš„æ¦‚å¿µã€‚ åªè¦åˆ›å»ºznodeçš„ä¼šè¯å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œè¿™äº›znodeå°±å­˜åœ¨ã€‚ ä¼šè¯ç»“æŸæ—¶ï¼Œå°†åˆ é™¤znodeã€‚</span><br><span class="line"></span><br><span class="line">Conditional updates and watches</span><br><span class="line">ZooKeeper supports the concept of watches. Clients can set a watch on a znode. A watch will be triggered and removed when the znode changes. When a watch is triggered, the client receives a packet saying that the znode has changed. If the connection between the client and one of the ZooKeeper servers is broken, the client will receive a local notification.</span><br><span class="line"></span><br><span class="line">æ¡ä»¶æ›´æ–°å’Œæ‰‹è¡¨ZooKeeperæ”¯æŒæ‰‹è¡¨çš„æ¦‚å¿µã€‚å®¢æˆ·ç«¯å¯ä»¥åœ¨znodeä¸Šè®¾ç½®æ‰‹è¡¨ã€‚å½“znodeå‘ç”Ÿå˜åŒ–æ—¶ï¼Œå°†è§¦å‘å¹¶åˆ é™¤ä¸€ä¸ªæ‰‹è¡¨ã€‚å½“ä¸€ä¸ªæ‰‹è¡¨è¢«è§¦å‘æ—¶ï¼Œå®¢æˆ·ç«¯ä¼šæ”¶åˆ°ä¸€ä¸ªæ•°æ®åŒ…ï¼Œè¯´znodeå·²ç»æ”¹å˜äº†ã€‚å¦‚æœå®¢æˆ·ç«¯å’Œä¸€ä¸ªZooKeeperæœåŠ¡å™¨ä¹‹é—´çš„è¿æ¥æ–­å¼€ï¼Œå®¢æˆ·ç«¯å°†æ”¶åˆ°ä¸€ä¸ªæœ¬åœ°é€šçŸ¥ã€‚</span><br></pre></td></tr></table></figure><h4 id="å®‰è£…zookeeper"><a href="#å®‰è£…zookeeper" class="headerlink" title="å®‰è£…zookeeper"></a>å®‰è£…zookeeper</h4><p>Standalone Operation</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">1.ä¸‹è½½zookeeperï¼Œé€šè¿‡fileZileä¸Šä¼ ä¸Šå»</span><br><span class="line">tar -zxvf apache-zookeeper-3.6.0-bin.tar.gz</span><br><span class="line">2.å®‰è£…java</span><br><span class="line">3.å°†è§£å‹åçš„æ–‡ä»¶åé‡å‘½å</span><br><span class="line">mv apache-zookeeper-3.6.0-bin zookeeper</span><br><span class="line">å¹¶ç§»åŠ¨è‡³&#x2F;usr&#x2F;lib</span><br><span class="line">mv &#x2F;tmp&#x2F;zookeeper&#x2F; &#x2F;usr&#x2F;lib</span><br><span class="line">Standalone Operation</span><br><span class="line">å•å‡»æ¼”ç¤º</span><br><span class="line"></span><br><span class="line">4.ç”Ÿæˆä¸€ä¸ªzoo.cfg</span><br><span class="line">vi conf zoo.cfg</span><br><span class="line">â€‹</span><br></pre></td></tr></table></figure><p>tickTime=2000<br>dataDir=/var/lib/zookeeper<br>clientPort=2181<br>â€‹```<br>å¯åŠ¨<br>sh bin/zkServer.sh start<br>5.æµ‹è¯•<br>sh bin/zkCli.sh -server 127.0.0.1:2181<br>ls /<br>[ zookeeper]<br>Next, create a new znode by running create /zk_test my_data. This creates a new znode and associates the string â€œmy_dataâ€ with the node. You should see:<br>[zkshell: 9] create /zk_test my_data<br>Created /zk_test<br>[zk: 127.0.0.1:2181(CONNECTED) 0] ls /<br>[zk_test, zookeeper]<br>[zk: 127.0.0.1:2181(CONNECTED) 3] get /zk_test<br>my_data</p><p>[zk: 127.0.0.1:2181(CONNECTED) 5] get -s /zk_test<br>my_data<br>cZxid = 0x3<br>ctime = Wed Apr 22 18:33:23 CST 2020<br>mZxid = 0x3<br>mtime = Wed Apr 22 18:33:23 CST 2020<br>pZxid = 0x3<br>cversion = 0<br>dataVersion = 0<br>aclVersion = 0<br>ephemeralOwner = 0x0<br>dataLength = 7<br>numChildren = 0<br>[zk: 127.0.0.1:2181(CONNECTED) 6] set /zk_test junk<br>[zk: 127.0.0.1:2181(CONNECTED) 7] get -s /zk_test<br>junk<br>cZxid = 0x3<br>ctime = Wed Apr 22 18:33:23 CST 2020<br>mZxid = 0x7<br>mtime = Fri Apr 24 17:48:13 CST 2020<br>pZxid = 0x3<br>cversion = 0<br>dataVersion = 1<br>aclVersion = 0<br>ephemeralOwner = 0x0<br>dataLength = 4<br>numChildren = 0<br>å¯ä»¥çœ‹åˆ°mTimeè¢«æ”¹å˜äº†ï¼Œä»¥åŠznodeçš„å€¼<br>[zk: 127.0.0.1:2181(CONNECTED) 8] delete /zk_test<br>åˆ é™¤/zk_test<br>[zk: 127.0.0.1:2181(CONNECTED) 9] get -s /zk_test<br>org.apache.zookeeper.KeeperException$NoNodeException: KeeperErrorCode = NoNode for /zk_test</p><pre><code>é›†ç¾¤æ¨¡å¼ åç»­å†ä»‹ç»</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>springcloud-gateway</title>
      <link href="/2020/04/08/springcloud-gateway/"/>
      <url>/2020/04/08/springcloud-gateway/</url>
      
        <content type="html"><![CDATA[<blockquote><p>åœ¨å†™ä¹‹å‰ï¼Œæƒ³å†™ä¸€ä¸‹æ„Ÿå—ï¼Œä¹‹å‰æœ‰å¯¹æ¥è¿‡springcloudçš„é¡¹ç›®ï¼Œæœ‰ä»¥ä¸‹å‡ ä¸ªæ„Ÿå—</p><p>1.æˆ‘ä»¬è¯·æ±‚æ‰€æœ‰æ¥å£ï¼Œéƒ½æ˜¯è¯·æ±‚åŒä¸€ä¸ªç«¯å£ï¼Œè·¯å¾„ä¸åŒï¼Œéƒ½ä¼šåŠ ä¸€ä¸ªtokenæ¥éªŒè¯æƒé™</p><p>æˆ‘æ„Ÿè§‰æ˜¯è¿™ä¹ˆå®ç°çš„ï¼ŒæœåŠ¡å™¨å¯¹å¤–è®¿é—®åªå¼€æ”¾gatewayé¡¹ç›®ç«¯å£ï¼Œç„¶ååŠ ä¸€ä¸ªtokenæ¥å…¨å±€filter</p><p>å½“ç„¶ï¼Œæˆ‘ä¸æ˜¯è¿™ä¸ªé¡¹ç›®çš„è®¾è®¡å¸ˆï¼Œè¿™æ˜¯å‡­ç©ºæƒ³è±¡è€Œå·²ã€‚</p></blockquote><h4 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>This project provides an API Gateway built on top of the Spring Ecosystem, including: Spring 5, Spring Boot 2 and Project Reactor. Spring Cloud Gateway aims to provide a simple, yet effective way to route to APIs and provide cross cutting concerns to them such as: security, monitoring/metrics, and resiliency.</p><p>è¯¥é¡¹ç›®æä¾›äº†ä¸€ä¸ªåœ¨springç”Ÿæ€ç³»ç»Ÿä¸Šæ„å»ºçš„apiç½‘å…³ï¼ŒåŒ…æ‹¬spring 5,spring boot2å’Œproject reactor.spring cloud gatewayæ—¨åœ¨æä¾›ä¸€ä¸ªç®€å•æœ‰æ•ˆçš„è·¯ç”±åˆ°apiså¹¶ä¸”æä¾›è·¨é¢†åŸŸçš„å…³æ³¨ç‚¹å¦‚ï¼šå®‰å…¨ï¼Œæ£€æµ‹ã€æŒ‡æ ‡å’Œå¼¹æ€§ã€‚</p><h4 id="æœ¯è¯­"><a href="#æœ¯è¯­" class="headerlink" title="æœ¯è¯­"></a>æœ¯è¯­</h4><ul><li><p><strong>Route</strong>: The basic building block of the gateway. It is defined by an ID, a destination URI, a collection of predicates, and a collection of filters. A route is matched if the aggregate predicate is true.â€”-Routeæ˜¯gatewayä¸­æœ€åŸºæœ¬å—ï¼Œå¦‚æœæ‰€æœ‰predicateæ˜¯trueï¼Œé‚£ä¹ˆrouteä¼šè¢«åŒ¹é…</p></li><li><p><strong>Predicate</strong>: This is a <a href="https://docs.oracle.com/javase/8/docs/api/java/util/function/Predicate.html" target="_blank" rel="noopener">Java 8 Function Predicate</a>. The input type is a <a href="https://docs.spring.io/spring/docs/5.0.x/javadoc-api/org/springframework/web/server/ServerWebExchange.html" target="_blank" rel="noopener">Spring Framework <code>ServerWebExchange</code></a>. This lets you match on anything from the HTTP request, such as headers or parameters.é€šè¿‡java8æä¾›çš„Predicateï¼Œæˆ‘ä»¬å¯ä»¥åŒ¹é…HttpRequestä¸­çš„ï¼Œheadersæˆ–è€…parameters</p></li><li><p><strong>Filter</strong>: These are instances of <a href="https://docs.spring.io/spring/docs/5.0.x/javadoc-api/org/springframework/web/server/GatewayFilter.html" target="_blank" rel="noopener">Spring Framework <code>GatewayFilter</code></a> that have been constructed with a specific factory. Here, you can modify requests and responses before or after sending the downstream request.æˆ‘ä»¬å¯ä»¥åœ¨å‘é€ç»™ä¸‹æ¸¸ä¹‹å‰ä¿®æ”¹è¯·æ±‚æˆ–è€…ä¹‹åä¿®æ”¹è¿”å›å›æ¥çš„å“åº”ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬ç”¨ä¸‹é¢ä¸€å¼ å›¾æ¥è§£é‡Š</p></li></ul><p>  <img src="https://s1.ax1x.com/2020/04/09/G52mV0.png" alt="G52mV0.png"></p><p>  â€‹        ä»å›¾ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ³¨æ„åˆ°Filterä¸­æ˜¯æ”¯æŒè¯·æ±‚å‰ï¼Œå’Œå“åº”åçš„å¤„ç†çš„</p><h4 id="è£…é…spring-cloud-gateway"><a href="#è£…é…spring-cloud-gateway" class="headerlink" title="è£…é…spring cloud gateway"></a>è£…é…spring cloud gateway</h4><p>  <strong>pom</strong></p>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--æš‚æ—¶å…ˆæ³¨é‡Š </span></span><br><span class="line"><span class="comment">  &lt;dependency&gt;</span></span><br><span class="line"><span class="comment">              &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">              &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">          &lt;/dependency&gt;</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--spring cloud version :Hoxton.SR3--&gt;</span></span><br></pre></td></tr></table></figure><p>  <strong>application.yml</strong></p>  <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">"*"</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">10000</span></span><br><span class="line"><span class="comment">#spring: æ­¤å¤„æ³¨é‡Šæ”¹ä¸ºjavaæ³¨å…¥</span></span><br><span class="line"><span class="comment">#  cloud:</span></span><br><span class="line"><span class="comment">#    gateway:</span></span><br><span class="line"><span class="comment">#      routes:</span></span><br><span class="line"><span class="comment">#        - id: first</span></span><br><span class="line"><span class="comment">#          uri: http://localhost:9000</span></span><br><span class="line"><span class="comment">#          predicates:</span></span><br><span class="line"><span class="comment">#            - Path=/**</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">org.springframework.cloud.gateway:</span> <span class="string">debug</span></span><br></pre></td></tr></table></figure><p>  <strong>javaæ³¨å…¥</strong></p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> RouteLocator <span class="title">customerRouteLocator</span><span class="params">(RouteLocatorBuilder builder)</span></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> builder.routes()</span><br><span class="line">            .route(r-&gt;r.path(<span class="string">"/**"</span>)</span><br><span class="line">                  .uri(<span class="string">"http://localhost:9000"</span>).id(<span class="string">"first"</span>)</span><br><span class="line">            ).build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  <strong>æµ‹è¯•</strong></p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">D:\gitclonepackage\cloud&gt;curl http:&#x2F;&#x2F;localhost:10000&#x2F;hello&#x2F;huskyui</span><br><span class="line">  hello, huskyui Mon Apr 13 17:25:28 CST 2020</span><br></pre></td></tr></table></figure><h4 id="ä»‹ç»predicate"><a href="#ä»‹ç»predicate" class="headerlink" title="ä»‹ç»predicate"></a>ä»‹ç»predicate</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">java8ä¸­çš„predicate,å°±æ˜¯filteré‡Œé¢çš„å‡½æ•°ã€‚è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒç›´è§‚çš„ä¾‹å­</span><br><span class="line">List&lt;Integer&gt; list &#x3D; new ArrayList&lt;&gt;(Arrays.asList(1,2,3,4,5,6,7,8,9));</span><br><span class="line">list.stream().filter(t-&gt;t&lt;5).forEach(System.out::println);</span><br><span class="line">è¾“å‡º 1,2,3,4</span><br></pre></td></tr></table></figure><h5 id="PathRoutePredicateFactory"><a href="#PathRoutePredicateFactory" class="headerlink" title="PathRoutePredicateFactory"></a>PathRoutePredicateFactory</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> RouteLocator <span class="title">customerRouteLocator</span><span class="params">(RouteLocatorBuilder builder)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> builder.routes()</span><br><span class="line">        .route(r-&gt;r.path(<span class="string">"/**"</span>)</span><br><span class="line">        .uri(<span class="string">"http://localhost:9000"</span>).id(<span class="string">"first"</span>)</span><br><span class="line">    ).build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">æ”¾å¼€äº†&#x2F;**,ä¹Ÿå°±æ˜¯æ”¾å¼€äº†æ‰€æœ‰http:&#x2F;&#x2F;localhost:9000æ‰€æœ‰è·¯å¾„</span><br><span class="line">D:\gitclonepackage\cloud&gt;curl http:&#x2F;&#x2F;localhost:10000&#x2F;hello&#x2F;huskyui</span><br><span class="line">hello, huskyui Mon Apr 13 17:25:28 CST 2020</span><br></pre></td></tr></table></figure><h5 id="CookieRoutePredicateFactory"><a href="#CookieRoutePredicateFactory" class="headerlink" title="CookieRoutePredicateFactory"></a>CookieRoutePredicateFactory</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> RouteLocator <span class="title">customerRouteLocator</span><span class="params">(RouteLocatorBuilder builder)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> builder.routes()</span><br><span class="line">            .route(r-&gt;r</span><br><span class="line">                    .cookie(<span class="string">"token"</span>,<span class="string">"kee.e"</span>)</span><br><span class="line">                    .uri(<span class="string">"http://localhost:9000"</span>).id(<span class="string">"first"</span>)</span><br><span class="line">            ).build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">D:\gitclonepackage\cloud&gt;curl http:&#x2F;&#x2F;localhost:10000&#x2F;hello&#x2F;huskyui</span><br><span class="line">&#123;&quot;timestamp&quot;:&quot;2020-04-13T10:03:43.548+0000&quot;,&quot;path&quot;:&quot;&#x2F;hello&#x2F;huskyui&quot;,&quot;status&quot;:404,&quot;error&quot;:&quot;Not Found&quot;,&quot;message&quot;:null,&quot;requestId&quot;:&quot;b330030a-1&quot;&#125;</span><br><span class="line">D:\gitclonepackage\cloud&gt;curl http:&#x2F;&#x2F;localhost:10000&#x2F;hello&#x2F;huskyui --cookie &quot;token&#x3D;keexe&quot;</span><br><span class="line">hello, huskyui Mon Apr 13 18:03:55 CST 2020</span><br><span class="line">D:\gitclonepackage\cloud&gt;curl http:&#x2F;&#x2F;localhost:10000&#x2F;hello&#x2F;huskyui --cookie &quot;token&#x3D;keeeee&quot;</span><br><span class="line">&#123;&quot;timestamp&quot;:&quot;2020-04-13T10:09:09.207+0000&quot;,&quot;path&quot;:&quot;&#x2F;hello&#x2F;huskyui&quot;,&quot;status&quot;:404,&quot;error&quot;:&quot;Not Found&quot;,&quot;message&quot;:null,&quot;requestId&quot;:&quot;23aba850-3&quot;&#125;</span><br></pre></td></tr></table></figure><h5 id="ç»„åˆä½¿ç”¨"><a href="#ç»„åˆä½¿ç”¨" class="headerlink" title="ç»„åˆä½¿ç”¨"></a>ç»„åˆä½¿ç”¨</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> RouteLocator <span class="title">customerRouteLocator</span><span class="params">(RouteLocatorBuilder builder)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> builder.routes()</span><br><span class="line">            .route(r-&gt;r</span><br><span class="line">                    .method(HttpMethod.POST)</span><br><span class="line">                    .and()</span><br><span class="line">                    .path(<span class="string">"/**"</span>)</span><br><span class="line">                    .and()</span><br><span class="line">                    .cookie(<span class="string">"token"</span>,<span class="string">"kee.e"</span>)</span><br><span class="line">                    .uri(<span class="string">"http://localhost:9000"</span>).id(<span class="string">"first"</span>)</span><br><span class="line">            ).build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">D:\gitclonepackage\cloud&gt;curl -X POST  http:&#x2F;&#x2F;localhost:10000&#x2F;hello&#x2F;huskyui --cookie &quot;token&#x3D;keeie&quot;</span><br><span class="line">hello, huskyui Mon Apr 13 18:13:54 CST 2020</span><br></pre></td></tr></table></figure><h6 id="è‡ªå®šä¹‰Predicate"><a href="#è‡ªå®šä¹‰Predicate" class="headerlink" title="è‡ªå®šä¹‰Predicate"></a>è‡ªå®šä¹‰Predicate</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æˆ‘ä»¬å…ˆå»çœ‹ä¸€ä¸‹cookieåˆ¤æ–­çš„æºç   CookieRoutePredicateFactory.java</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Predicate&lt;ServerWebExchange&gt; <span class="title">apply</span><span class="params">(Config config)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> GatewayPredicate() &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">test</span><span class="params">(ServerWebExchange exchange)</span> </span>&#123;</span><br><span class="line">List&lt;HttpCookie&gt; cookies = exchange.getRequest().getCookies()</span><br><span class="line">.get(config.name);</span><br><span class="line"><span class="keyword">if</span> (cookies == <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (HttpCookie cookie : cookies) &#123;</span><br><span class="line"><span class="keyword">if</span> (cookie.getValue().matches(config.regexp)) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> String.format(<span class="string">"Cookie: name=%s regexp=%s"</span>, config.name,</span><br><span class="line">config.regexp);</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å¾ˆå¥½ç†è§£çš„ä»£ç ï¼Œæˆ‘ä»¬å†™ä¸€ä¸²headeråˆ¤æ–­çš„</span></span><br><span class="line"> <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RouteLocator <span class="title">customerRouteLocator</span><span class="params">(RouteLocatorBuilder builder)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> builder.routes()</span><br><span class="line">                .route(r -&gt; r.predicate(t -&gt; &#123;</span><br><span class="line">                            List&lt;String&gt; values= t.getRequest().getHeaders().get(<span class="string">"token"</span>);</span><br><span class="line">                            <span class="keyword">if</span>(values==<span class="keyword">null</span> || values.isEmpty())&#123;</span><br><span class="line">                                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">return</span> values.stream().anyMatch(value-&gt;value.equals(<span class="string">"123456"</span>));</span><br><span class="line">                        &#125;)</span><br><span class="line">                                .uri(<span class="string">"lb://eureka-consumer"</span>).id(<span class="string">"first"</span>)</span><br><span class="line">                ).build();</span><br><span class="line">    &#125;</span><br><span class="line"> D:\gitclonepackage\cloud&gt;curl -X POST http:<span class="comment">//localhost:10000/hello/huskyui --header "token: 123456"</span></span><br><span class="line">hello, huskyui Thu Apr <span class="number">16</span> <span class="number">14</span>:<span class="number">58</span>:<span class="number">20</span> CST <span class="number">2020</span></span><br></pre></td></tr></table></figure><h4 id="ä»‹ç»filter"><a href="#ä»‹ç»filter" class="headerlink" title="ä»‹ç»filter"></a>ä»‹ç»filter</h4><p>Route filters allow the modification of the incoming HTTP request or outgoing HTTP response in some manner. Route filters are scoped to a particular route. Spring Cloud Gateway includes many built-in GatewayFilter Factories.</p><p>è·¯ç”±è¿‡æ»¤å™¨å¯ä»¥ä¿®æ”¹HTTPè¯·æ±‚å’ŒHTTPå“åº”ï¼Œè·¯ç”±è¿‡æ»¤å™¨çš„ä½œç”¨åŸŸæ˜¯ç‰¹å®šçš„è·¯ç”±ã€‚spring cloud gatewayæœ‰å¾ˆå¤šå†…ç½®çš„ç½‘å…³è¿‡æ»¤å™¨çš„å·¥å‚ã€‚</p><h5 id="ä½¿ç”¨PathRoutePredicateFactoryå’ŒStripPrefixGatewayFilterFactoryå®ç°å¯¹ç‰¹å®šé¡¹ç›®è®¿é—®"><a href="#ä½¿ç”¨PathRoutePredicateFactoryå’ŒStripPrefixGatewayFilterFactoryå®ç°å¯¹ç‰¹å®šé¡¹ç›®è®¿é—®" class="headerlink" title="ä½¿ç”¨PathRoutePredicateFactoryå’ŒStripPrefixGatewayFilterFactoryå®ç°å¯¹ç‰¹å®šé¡¹ç›®è®¿é—®"></a>ä½¿ç”¨PathRoutePredicateFactoryå’ŒStripPrefixGatewayFilterFactoryå®ç°å¯¹ç‰¹å®šé¡¹ç›®è®¿é—®</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RouteLocator <span class="title">customerRouteLocator</span><span class="params">(RouteLocatorBuilder builder)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> builder.routes()</span><br><span class="line">                .route(r -&gt; r.path(<span class="string">"/consumer/**"</span>)</span><br><span class="line">                        .filters(f-&gt;f.stripPrefix(<span class="number">1</span>))</span><br><span class="line">                                .uri(<span class="string">"lb://eureka-consumer"</span>).id(<span class="string">"first"</span>)</span><br><span class="line">                ).build();</span><br><span class="line">    &#125;</span><br><span class="line">D:\gitclonepackage\cloud&gt;curl -X POST http:<span class="comment">//localhost:10000/consumer/hello/huskyui</span></span><br><span class="line">hello, huskyui Thu Apr <span class="number">16</span> <span class="number">15</span>:<span class="number">16</span>:<span class="number">31</span> CST <span class="number">2020</span></span><br><span class="line"><span class="comment">// åœ¨è®¿é—®çš„æ—¶å€™ï¼Œç”±äºstripPrefixæ˜¯1ï¼Œä¼šå»é™¤/consumerè¿™ä¸€å±‚ï¼ŒçœŸæ­£çš„ä¼šè½¬å‘æˆ</span></span><br><span class="line">    <span class="comment">// lb://eureka-consumer/hello/huskyui</span></span><br></pre></td></tr></table></figure><h5 id="ä¿®æ”¹RequestBodyä¸­ä¿¡æ¯"><a href="#ä¿®æ”¹RequestBodyä¸­ä¿¡æ¯" class="headerlink" title="ä¿®æ”¹RequestBodyä¸­ä¿¡æ¯"></a>ä¿®æ”¹RequestBodyä¸­ä¿¡æ¯</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RouteLocator <span class="title">customerRouteLocator</span><span class="params">(RouteLocatorBuilder builder)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> builder.routes()</span><br><span class="line">                .route(r -&gt; r.path(<span class="string">"/producer/**"</span>)</span><br><span class="line">                        .filters(f -&gt; f.stripPrefix(<span class="number">1</span>)</span><br><span class="line">                                .modifyRequestBody(Map<span class="class">.<span class="keyword">class</span>, <span class="title">Map</span>.<span class="title">class</span>, <span class="title">MediaType</span>.<span class="title">APPLICATION_JSON_VALUE</span>, (<span class="title">serverWebExchange</span>, <span class="title">s</span>) -&gt; </span>&#123;</span><br><span class="line">                                    System.out.println(s);</span><br><span class="line">                                    s.put(<span class="string">"name"</span>,<span class="string">"adios"</span>);</span><br><span class="line">                                    <span class="keyword">return</span> Mono.just(s);</span><br><span class="line">                                &#125;))</span><br><span class="line">                        .uri(<span class="string">"lb://eureka-producer"</span>).id(<span class="string">"first"</span>)</span><br><span class="line">                ).build();</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// å¯ä»¥çœ‹åˆ°è¿™ä¸ªsçš„ç±»å‹æ˜¯Map.class,æˆ‘ä¿®æ”¹çš„å¯¹åº”nameçš„å€¼ï¼Œ</span></span><br><span class="line"></span><br><span class="line">POST http:<span class="comment">//localhost:10000/producer/hello</span></span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"><span class="string">"name"</span>: <span class="string">"huskyui"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">hello, adios Thu Apr <span class="number">16</span> <span class="number">18</span>:<span class="number">34</span>:<span class="number">56</span> CST <span class="number">2020</span></span><br><span class="line"><span class="comment">// å¯ä»¥çœ‹åˆ°æˆ‘ä¿®æ”¹å¯¹åº”çš„requestBodyçš„å€¼ï¼Œåœ¨æ§åˆ¶å°ä¹Ÿæ‰“å°äº†åˆå§‹RequestBodyè¯·æ±‚jsonï¼ˆä¸Šé¢è¯·æ±‚æ–¹å¼æ˜¯é€šè¿‡ideaé‡Œé¢å†…ç½®çš„è¯·æ±‚æ–¹å¼ï¼‰</span></span><br></pre></td></tr></table></figure><h4 id="å…¨å±€æ‹¦æˆªå™¨"><a href="#å…¨å±€æ‹¦æˆªå™¨" class="headerlink" title="å…¨å±€æ‹¦æˆªå™¨"></a>å…¨å±€æ‹¦æˆªå™¨</h4><p>The <code>GlobalFilter</code> interface has the same signature as <code>GatewayFilter</code>. These are special filters that are conditionally applied to all routes.</p><p>GlobalFilteræ¥å£å…·æœ‰ä¸gatewayFilterç›¸åŒçš„ç­¾åï¼Œè¿™äº›æ˜¯ç‰¹æ®Šè¿‡æ»¤å™¨ï¼Œæœ‰æ¡ä»¶åœ°åº”ç”¨äºæ‰€æœ‰è·¯ç”±ã€‚</p><h4 id="åç»­"><a href="#åç»­" class="headerlink" title="åç»­"></a>åç»­</h4><p>ä»ç°åœ¨å¼€å§‹ï¼Œæš‚åœæ›´æ–°spring cloud  gatewayç›¸å…³åšå®¢ï¼Œæˆ‘å…ˆå»å­¦ç‚¹åˆ«çš„äº†ã€‚å­¦ä¹ è¿™ç§å¹¶æ²¡æœ‰ä»€ä¹ˆç”¨ã€‚</p><h4 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h4><p><a href="http://www.ityouknow.com/spring-cloud.html" target="_blank" rel="noopener">çº¯æ´çš„å¾®ç¬‘å†™çš„spring cloudæ–‡æ¡£</a><br><a href="https://windmt.com/tags/API-Gateway/" target="_blank" rel="noopener">windmtå†™çš„æ–‡æ¡£</a><br><a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.2.RELEASE/reference/html/#gateway-starter" target="_blank" rel="noopener">spring cloud gatewayå®˜æ–¹æ–‡æ¡£</a><br><a href="https://github.com/spring-cloud/spring-cloud-gateway/tree/master/spring-cloud-gateway-sample/src/main/java/org/springframework/cloud/gateway/sample" target="_blank" rel="noopener">githubä¸Šspring cloud gatewayæä¾›çš„samples</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> SpringCloud </tag>
            
            <tag> Gateway </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringCloud-config</title>
      <link href="/2020/03/26/SpringCloud-config/"/>
      <url>/2020/03/26/SpringCloud-config/</url>
      
        <content type="html"><![CDATA[<h3 id="Spring-Cloud-Config"><a href="#Spring-Cloud-Config" class="headerlink" title="Spring Cloud Config"></a>Spring Cloud Config</h3><h4 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>Spring Cloud Config provides server-side and client-side support for externalized configuration in a distributed system. With the Config Server, you have a central place to manage external properties for applications across all environments. The concepts on both client and server map identically to the Spring <code>Environment</code> and <code>PropertySource</code> abstractions, so they fit very well with Spring applications but can be used with any application running in any language. As an application moves through the deployment pipeline from dev to test and into production, you can manage the configuration between those environments and be certain that applications have everything they need to run when they migrate. The default implementation of the server storage backend uses git, so it easily supports labelled versions of configuration environments as well as being accessible to a wide range of tooling for managing the content. It is easy to add alternative implementations and plug them in with Spring configuration.</p><p>Spring Cloud Configä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å¤–éƒ¨åŒ–é…ç½®æä¾›äº†æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯æ”¯æŒã€‚æœ‰äº†Config Serverï¼Œæ‚¨å°±æœ‰äº†ä¸€ä¸ªä¸­å¿ƒä½ç½®æ¥ç®¡ç†è·¨æ‰€æœ‰ç¯å¢ƒçš„åº”ç”¨ç¨‹åºçš„å¤–éƒ¨å±æ€§ã€‚å®¢æˆ·æœºå’ŒæœåŠ¡å™¨ä¸Šçš„æ¦‚å¿µä¸Springç¯å¢ƒå’ŒPropertySourceæŠ½è±¡å®Œå…¨ç›¸åŒï¼Œå› æ­¤å®ƒä»¬éå¸¸é€‚åˆSpringåº”ç”¨ç¨‹åºï¼Œä½†å¯ä»¥ç”¨äºä»¥ä»»ä½•è¯­è¨€è¿è¡Œçš„ä»»ä½•åº”ç”¨ç¨‹åº.å½“åº”ç”¨ç¨‹åºé€šè¿‡éƒ¨ç½²ç®¡é“ä»devè½¬ç§»åˆ°æµ‹è¯•å¹¶è¿›å…¥ç”Ÿäº§ç¯å¢ƒæ—¶ï¼Œæ‚¨å¯ä»¥åœ¨ä¸¤è€…ä¹‹é—´ç®¡ç†é…ç½®.æœåŠ¡å™¨å­˜å‚¨åç«¯é»˜è®¤çš„å®ç°ä½¿ç”¨gitï¼Œå› æ­¤å®ƒå¾ˆå®¹æ˜“æ”¯æŒé…ç½®ç¯å¢ƒçš„æ ‡è®°ç‰ˆæœ¬ï¼Œå¹¶ä¸”å¯ä»¥è®¿é—®å„ç§å„æ ·çš„å·¥å…·æ¥ç®¡ç†å†…å®¹ã€‚å¾ˆå®¹æ˜“æ·»åŠ æ›¿ä»£å®ç°å¹¶å°†å®ƒä»¬æ’å…¥Springé…ç½®ä¸­</p><h4 id="config-server"><a href="#config-server" class="headerlink" title="config-server"></a>config-server</h4><p><strong>åˆ›å»ºä¸€ä¸ªé…ç½®ä»“åº“</strong></p><p>å…·ä½“æ ·å¼ï¼Œå¯ä»¥çœ‹<a href="https://github.com/huskyui/config-repo" target="_blank" rel="noopener">https://github.com/huskyui/config-repo</a></p><p>åœ¨<code>spring-cloud</code>ä¸‹é¢æœ‰ä¸‰ä¸ªæ–‡ä»¶ï¼Œ<code>config-dev.yml</code>å’Œ<code>config-prod.yml</code>å’Œ<code>config-test.yml</code></p><p><strong>å¯¼å…¥pom</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-config-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--spring-cloud.version Hoxton.SR3 --&gt;</span></span><br></pre></td></tr></table></figure><p><strong>application.yml</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">config-server</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="attr">server:</span></span><br><span class="line">        <span class="attr">git:</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">https://github.com/huskyui/config-repo</span> <span class="comment"># uri</span></span><br><span class="line">          <span class="attr">search-paths:</span> <span class="string">spring-cloud</span> <span class="comment"># å±‚çº§</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">12000</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:7000/eureka/</span></span><br><span class="line"><span class="comment"># ä»Šå¤©å†™defalutZoneå†™é”™äº†ï¼Œå‘ç°åº”ç”¨åœ¨è¯·æ±‚loclahost:8761/eureka/,åŸæ¥é»˜è®¤å€¼æ˜¯è¿™ä¸ª</span></span><br></pre></td></tr></table></figure><p><strong>@EnableConfigServer</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableConfigServer</span></span><br><span class="line"><span class="comment">// å¼€å¯config-server</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CloudConfigServerApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(CloudConfigServerApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æµ‹è¯•</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl http:&#x2F;&#x2F;localhost:12000&#x2F;config-dev.yml</span><br><span class="line">currency:</span><br><span class="line">  name: huskyui-update-2020-03-24-----2</span><br></pre></td></tr></table></figure><h4 id="config-client"><a href="#config-client" class="headerlink" title="config-client"></a>config-client</h4><p><strong>pom</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--spring-cloud-version Hoxton.SR3--&gt;</span></span><br></pre></td></tr></table></figure><p><strong>bootstrap.yml</strong></p><p>bootstrap.ymlä¼˜å…ˆäºapplication.ymlé…ç½®</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="attr">label:</span> <span class="string">master</span> <span class="comment"># ç”¨äºæ‹‰å–è¿œç¨‹é…ç½®å±æ€§çš„æ ‡ç­¾åç§°ï¼Œåœ¨åŸºäºgitçš„æœåŠ¡å™¨ï¼Œé€šå¸¸æ˜¯master</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">config</span> <span class="comment"># Name of application used to fetch remote properties. å¯¹åº”config-dev.ymlä¸­çš„config</span></span><br><span class="line">      <span class="attr">profile:</span> <span class="string">dev</span> <span class="comment"># The default profile to use when fetching remote configuration</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment">#Flag to indicate that config server discovery is enabled</span></span><br><span class="line">        <span class="attr">service-id:</span> <span class="string">config-server</span> <span class="comment">#Service id to locate config server.ä¹Ÿå°±æ˜¯config-serveræ³¨å†Œåœ¨eurekaä¸­çš„application-name</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:7000/eureka/</span></span><br></pre></td></tr></table></figure><p><strong>application.yml</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">config-git</span> </span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">13000</span></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">refresh</span> <span class="comment"># æ”¾å¼€/actuator/refreshè·¯å¾„ï¼Œå…·ä½“æ˜¯ä»€ä¹ˆæ ·å¼çš„è¯·æ±‚ï¼Œè¿˜å¾—çœ‹æ–‡æ¡£</span></span><br></pre></td></tr></table></figure><p><strong>HelloController</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Convenience annotation to put a &lt;code&gt;<span class="doctag">@Bean</span>&lt;/code&gt; definition in</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> org.springframework.cloud.context.scope.refresh.RefreshScope refresh scope&#125;.</span></span><br><span class="line"><span class="comment"> * Beans annotated this way can be refreshed at runtime and any components that are using</span></span><br><span class="line"><span class="comment"> * them will get a new instance on the next method call, fully initialized and injected</span></span><br><span class="line"><span class="comment"> * with all dependencies.</span></span><br><span class="line"><span class="comment">   åœ¨è°ƒç”¨/actuator/refreshæ—¶ï¼Œè¿è¡ŒæœŸé—´ï¼Œè¿™ä¸ªbeanä¼šè¢«åˆ·æ–°</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@RefreshScope</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;currency.name:error&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/hello"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">name</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æµ‹è¯•</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">1.æµ‹è¯•å•ä¸ªåº”ç”¨åˆ·æ–°</span><br><span class="line">æ‰“åŒ…è¿è¡Œ</span><br><span class="line">æµ‹è¯•å½“å‰æ•°æ®é—®é¢˜</span><br><span class="line">curl localhost:13000&#x2F;hello</span><br><span class="line">huskyui-update-2020-03-24-----2</span><br><span class="line">æ›´æ–°æ•°æ®</span><br><span class="line">æ›´æ–°æ•°æ®config-devé‡Œé¢çš„æ•°æ®</span><br><span class="line">currency:</span><br><span class="line">  name: huskyui-update-2020-03-27</span><br><span class="line"> å¹¶æäº¤åˆ°è¿œç¨‹ä»“åº“</span><br><span class="line">è°ƒç”¨åˆ·æ–°æ¥å£</span><br><span class="line">curl -X POST localhost:13000&#x2F;actuator&#x2F;refresh</span><br><span class="line">[&quot;currency.name&quot;,&quot;config.client.version&quot;]</span><br><span class="line">curl localhost:13000&#x2F;hello</span><br><span class="line">huskyui-update-2020-03-27</span><br><span class="line">å¯ä»¥çœ‹åˆ°æ•°æ®åˆ·æ–°æˆåŠŸ</span><br><span class="line">2.æµ‹è¯•å¤šä¸ªåº”ç”¨åˆ·æ–°</span><br><span class="line">java -jar xxx.jar --server.port&#x3D;13000</span><br><span class="line">java -jar xxx.jar --server.port&#x3D;13001</span><br><span class="line">curl localhost:13000&#x2F;hello</span><br><span class="line">huskyui-update-2020-03-27</span><br><span class="line">curl localhost:13001&#x2F;hello</span><br><span class="line">huskyui-update-2020-03-27</span><br><span class="line">æ›´æ–°æ•°æ®config-dev.yml</span><br><span class="line">currency:</span><br><span class="line">  name: huskyui-update-2020-03-27-for-two-client-test2</span><br><span class="line">å¹¶æäº¤åˆ°è¿œç¨‹ä»“åº“</span><br><span class="line">curl localhost:13000&#x2F;hello</span><br><span class="line">huskyui-update-2020-03-27</span><br><span class="line">curl localhost:13001&#x2F;hello</span><br><span class="line">huskyui-update-2020-03-27</span><br><span class="line">ä¸‹é¢æ‰§è¡Œåˆ·æ–°æ“ä½œ</span><br><span class="line">curl -X POST localhost:13000&#x2F;actuator&#x2F;refresh</span><br><span class="line">[&quot;currency.name&quot;,&quot;config.client.version&quot;]</span><br><span class="line">curl localhost:12000&#x2F;config-dev.yml</span><br><span class="line">currency:</span><br><span class="line">  name: huskyui-update-2020-03-27-for-two-client-test2</span><br><span class="line">curl localhost:13000&#x2F;hello</span><br><span class="line">huskyui-update-2020-03-27-for-two-client-test2</span><br><span class="line">curl localhost:13001&#x2F;hello</span><br><span class="line">huskyui-update-2020-03-27</span><br><span class="line">curl -X POST localhost:13001&#x2F;actuator&#x2F;refresh</span><br><span class="line">[&quot;currency.name&quot;,&quot;config.client.version&quot;]</span><br><span class="line">curl -X POST localhost:13001&#x2F;hello</span><br><span class="line">huskyui-update-2020-03-27-for-two-client-test2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœé…ç½®æ–‡ä»¶æ›´æ–°æ—¶ï¼Œ&#x2F;actuator&#x2F;refreshåªæ˜¯é’ˆå¯¹å•ä¸ªåº”ç”¨çš„ï¼Œå¦‚æœéœ€è¦æ›´æ–°æ‰€æœ‰åº”ç”¨éœ€è¦åˆ†åˆ«æ˜¯å»åˆ·æ–°å¯¹åº”çš„åº”ç”¨</span><br></pre></td></tr></table></figure><h4 id="ä½¿ç”¨spring-cloud-buså®ç°ç¾¤ä½“åˆ·æ–°"><a href="#ä½¿ç”¨spring-cloud-buså®ç°ç¾¤ä½“åˆ·æ–°" class="headerlink" title="ä½¿ç”¨spring-cloud-buså®ç°ç¾¤ä½“åˆ·æ–°"></a>ä½¿ç”¨spring-cloud-buså®ç°ç¾¤ä½“åˆ·æ–°</h4><p><a href="https://imgchr.com/i/GmFm2n" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2020/03/30/GmFm2n.jpg" alt="GmFm2n.jpg"></a></p><p>ä»ä¸Šé¢çš„æ¶æ„å›¾ï¼Œæˆ‘ä»¬<code>config-server</code>å’Œ<code>config-client</code>éƒ½è®¢é˜…ä¸€ä¸‹RabbitMQ</p><p>æˆ‘ä»¬éœ€è¦ä¿®æ”¹åŸæ¥çš„<code>config-server</code></p><p><strong>POM</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-bus<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-stream-binder-rabbit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>application.ymlæ·»åŠ </strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">guest</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">guest</span>  <span class="comment">## ä¸Šè¿°æ˜¯RabbitMQç›¸å…³è¿æ¥å‚æ•°ï¼Œæ¼äº†ä¸€ä¸ªvhost</span></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">"*"</span> <span class="comment">## æ”¾å¼€/actuator/bus-refresh</span></span><br></pre></td></tr></table></figure><p><code>config-client</code>ä¿®æ”¹éƒ¨åˆ†ä¹Ÿå’Œä¸Šè¿°ä¸€æ ·</p><p>ä¿®æ”¹åï¼Œå¯åŠ¨config-server,å¹¶å¯åŠ¨ä¸¤å°config-client,ç«¯å£ä¸åŒï¼ˆâ€“server.port=different_portï¼‰</p><p>æˆ‘ä»¬è®¿é—®<code>http://localhost:15672/</code>è®¿é—®RabbitMQå®¢æˆ·ç«¯ï¼Œç‚¹å‡»exchange,å¯ä»¥çœ‹åˆ°æ˜¯</p><p><code>springCloudBus</code>,æ˜¯topicç±»å‹,ä¸‰ä¸ªç»‘å®šè¯¥exchangeçš„queueçš„routing keyéƒ½æ˜¯#ï¼Œä¹Ÿå°±æ˜¯ä¸å¤„ç†fanout</p><p><strong>æµ‹è¯•</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">é¦–å…ˆä¿®æ”¹config-repo,å¹¶æäº¤</span><br><span class="line">é¦–å…ˆæŸ¥çœ‹æ•°æ®</span><br><span class="line">D:\gitclonepackage\cloud&gt;curl localhost:13000&#x2F;hello</span><br><span class="line">huskyui-update-2020-03-30</span><br><span class="line">D:\gitclonepackage\cloud&gt;curl localhost:13001&#x2F;hello</span><br><span class="line">huskyui-update-2020-03-30</span><br><span class="line"></span><br><span class="line">è°ƒç”¨åˆ·æ–°æ“ä½œ</span><br><span class="line">curl -X POST localhost:12000&#x2F;actuator&#x2F;bus-refresh</span><br><span class="line">è¿™ä¸ªè¯·æ±‚çš„æ—¶å€™ï¼Œæ˜¯è¯·æ±‚config-server;å½“ç„¶ä¹Ÿå¯ä»¥è¯·æ±‚config-clientçš„bus-refresh</span><br><span class="line"></span><br><span class="line">D:\gitclonepackage\cloud&gt;curl localhost:13001&#x2F;hello</span><br><span class="line">huskyui-update-2020-03-30-last-commit</span><br><span class="line">D:\gitclonepackage\cloud&gt;curl localhost:13000&#x2F;hello</span><br><span class="line">huskyui-update-2020-03-30-last-commit</span><br></pre></td></tr></table></figure><p>æœ¬ç¯‡æ–‡ç« å‚è€ƒï¼š </p><p><a href="https://windmt.com/2018/04/19/spring-cloud-7-config-sample/" target="_blank" rel="noopener">Spring Cloudï¼ˆä¸ƒï¼‰ï¼šé…ç½®ä¸­å¿ƒï¼ˆGit ç‰ˆä¸åŠ¨æ€åˆ·æ–°ï¼‰</a><br><a href="https://windmt.com/2018/04/19/spring-cloud-8-config-with-eureka/" target="_blank" rel="noopener">Spring Cloudï¼ˆå…«ï¼‰ï¼šé…ç½®ä¸­å¿ƒï¼ˆæœåŠ¡åŒ–ä¸é«˜å¯ç”¨ï¼‰</a></p><p><a href="https://windmt.com/2018/04/19/spring-cloud-9-config-eureka-bus/" target="_blank" rel="noopener">Spring Cloudï¼ˆä¹ï¼‰ï¼šé…ç½®ä¸­å¿ƒï¼ˆæ¶ˆæ¯æ€»çº¿ï¼‰ã€Finchley ç‰ˆã€‘</a></p>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringCloud </tag>
            
            <tag> Eureka </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringCloud-Hystrix</title>
      <link href="/2020/03/23/SpringCloud-Hystrix/"/>
      <url>/2020/03/23/SpringCloud-Hystrix/</url>
      
        <content type="html"><![CDATA[<h3 id="Hystrix"><a href="#Hystrix" class="headerlink" title="Hystrix"></a>Hystrix</h3><p>Hystrix is a latency and fault tolerance library designed to isolate points of access to remote systems, services and 3rd party libraries, stop cascading failure and enable resilience in complex distributed systems where failure is inevitable.</p><p>Hystrixæ˜¯ä¸€ä¸ªå»¶è¿Ÿå’Œå®¹é”™åº“ï¼Œæ—¨åœ¨éš”ç¦»è¿œç¨‹ç³»ç»Ÿã€æœåŠ¡å’Œç¬¬ä¸‰æ–¹åº“çš„è®¿é—®ç‚¹ï¼Œåœæ­¢æ¬¡çº§æ•…éšœï¼Œå¹¶ä¸”ä¸å¯é¿å…çš„å¤æ‚åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å®ç°è‡ªæˆ‘æ¢å¤èƒ½åŠ›ã€‚</p><h4 id="é…ç½®hystrix"><a href="#é…ç½®hystrix" class="headerlink" title="é…ç½®hystrix"></a>é…ç½®hystrix</h4><p><strong>pom</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.67<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--web--&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--Eureka client --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!-- Hystrix --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!-- å£°æ˜æ€§RESTå®¢æˆ·ç«¯ï¼Œä½¿ç”¨æ³¨è§£ä¿®é¥°æ¥å£ï¼ŒåŠ¨æ€å®ç° --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--ä¸ºäº†åç»­æ”¾å¼€hystrix.streamè·¯å¾„--&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>application.yml</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">eureka-consumer-feign-hystrix</span></span><br><span class="line"><span class="comment"># å½“å‰åº”ç”¨åç§°</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:7000/eureka/</span></span><br><span class="line"> <span class="comment"># æ˜ å°„åˆ°Eureka serverçš„è·¯å¾„</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9001</span></span><br><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">hystrix:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="comment"># an OpenFeign client will be wrapped with a Hystrix circuit breaker</span></span><br><span class="line"><span class="comment"># ä¸€ä¸ªOpenFeignå®¢æˆ·ç«¯å°†åŒ…è£…æœ‰Hystrixæ–­è·¯å™¨</span></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">hystrix.stream</span></span><br><span class="line"><span class="comment"># ä¸ºäº†ç»™Hystrix Dashboardæä¾›ä½¿ç”¨</span></span><br></pre></td></tr></table></figure><p><strong>å¯åŠ¨ç±»é…ç½®</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="comment">//æ‰«æåŒ…ä¸‹è¢«@FeignClientæ³¨è§£çš„ï¼Œéœ€è¦å’Œ@ConfigurationåŒæ—¶ä½¿ç”¨</span></span><br><span class="line"><span class="meta">@EnableHystrix</span></span><br><span class="line"><span class="comment">//å¼€å¯æ–­è·¯å™¨ï¼Œå¹¶ä¸”è‡ªåŠ¨é…ç½®æ‰¾åˆ°Hystrixç±»ï¼ˆif they are availableï¼‰</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CloudConsumerFeignHystrixApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(CloudConsumerFeignHystrixApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è¿œç¨‹è°ƒç”¨</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="comment">// nameï¼š the service id with optional protocol prefix.å¸¦æœ‰å¯é€‰åè®®å‰ç¼€çš„æœåŠ¡ID</span></span><br><span class="line"><span class="comment">// fallbackï¼š æŒ‡å®šçš„Feignå®¢æˆ·ç«¯æ¥å£çš„åå¤‡ç±»ã€‚fallbackç±»å¿…é¡»å®ç°è¯¥æ¥å£å¹¶ä¸”æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„spring bean</span></span><br><span class="line"><span class="comment">//Fallback class for the specified Feign client interface. The fallback class must</span></span><br><span class="line"><span class="comment">// implement the interface annotated by this annotation and be a valid spring bean.</span></span><br><span class="line"><span class="meta">@FeignClient</span>(name = <span class="string">"eureka-producer"</span>,fallback = HelloRemoteHystrix<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">interface</span> <span class="title">HelloRemote</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/hello"</span>)</span><br><span class="line">    <span class="function">String <span class="title">hello</span><span class="params">(@RequestBody JSONObject requestJSON)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>fallbackç±»</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloRemoteHystrix</span> <span class="keyword">implements</span> <span class="title">HelloRemote</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">(JSONObject requestJSON)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"hello world"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>controller</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> HelloRemote helloRemote;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/hello/&#123;name&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">(@PathVariable(name = <span class="string">"name"</span>)</span>String name)</span>&#123;</span><br><span class="line">        JSONObject requestJSON = <span class="keyword">new</span> JSONObject();</span><br><span class="line">        requestJSON.put(<span class="string">"name"</span>,name);</span><br><span class="line">        <span class="keyword">return</span> helloRemote.hello(requestJSON);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æµ‹è¯•</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">å°†eureka-serverï¼Œproducerï¼Œfeign-hystrixä¸‰ä¸ªé¡¹ç›®å¯åŠ¨ï¼Œåœ¨eureka-serverä¸Šå¯ä»¥çœ‹åˆ°producerå’Œfeign-hystrixéƒ½å·²ç»æ³¨å†ŒæˆåŠŸã€‚</span><br><span class="line">è®¿é—®ï¼šlocalhost:9001&#x2F;hello&#x2F;huskyui</span><br><span class="line">hello, huskyui Tue Mar 24 14:34:44 CST 2020</span><br><span class="line">å°†producerå…³é—­</span><br><span class="line">è®¿é—®ï¼šlocalhost:9001&#x2F;hello&#x2F;huskyui</span><br><span class="line">hello world</span><br><span class="line">å†æ¬¡å°†producerå¯åŠ¨</span><br><span class="line">hello, huskyui Tue Mar 24 14:40:27 CST 2020</span><br><span class="line"></span><br><span class="line">è¿™è¾¹ï¼Œå¯ä»¥çœ‹åˆ°ç†”æ–­èƒ½åŠ›ï¼Œä»¥åŠè‡ªæˆ‘æ¢å¤èƒ½åŠ›</span><br></pre></td></tr></table></figure><h4 id="é…ç½®ä¸€ä¸ªHystrix-dashboard"><a href="#é…ç½®ä¸€ä¸ªHystrix-dashboard" class="headerlink" title="é…ç½®ä¸€ä¸ªHystrix dashboard"></a>é…ç½®ä¸€ä¸ªHystrix dashboard</h4><p><strong>pom</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix-dashboard<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>application.yml</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">hystrix-dashboard</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">11000</span></span><br></pre></td></tr></table></figure><p><strong>æ·»åŠ æ³¨è§£@EnableHystrixDashboard</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableHystrixDashboard</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CloudHystrixDashboardApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(CloudHystrixDashboardApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æµ‹è¯•</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">è¿è¡Œè¯¥é¡¹ç›®</span><br><span class="line">è®¿é—®ï¼š http:&#x2F;&#x2F;localhost:11000&#x2F;hystrix</span><br><span class="line">åœ¨å¯åŠ¨åè¾“å…¥http:&#x2F;&#x2F;localhost:9001&#x2F;actuator&#x2F;hystrix.stream</span><br><span class="line">9001æ˜¯feign-hystrixçš„é¡¹ç›®çš„ç«¯å£ï¼Œå½“æ—¶æˆ‘ä»¬å¼•å…¥äº†actuatorï¼Œå¼€æ”¾hystrix.stream</span><br><span class="line">å¯ä»¥çœ‹åˆ°dashboardç›¸å…³</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringCloud </tag>
            
            <tag> Hystrix </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringCloud-Eureka</title>
      <link href="/2020/03/20/SpringCloud-Eureka/"/>
      <url>/2020/03/20/SpringCloud-Eureka/</url>
      
        <content type="html"><![CDATA[<h3 id="Eurekaç®€ä»‹"><a href="#Eurekaç®€ä»‹" class="headerlink" title="Eurekaç®€ä»‹"></a>Eurekaç®€ä»‹</h3><p>Eurekaæ˜¯ä¸€ç§åŸºäºREST(Representational State Thransferè¡¨ç°å±‚çŠ¶æ€è½¬ç§»)çš„æœåŠ¡ï¼Œä¸»è¦ç”¨äºAWSçš„å®šä½æœåŠ¡ï¼Œä»¥ä¾¿å®ç°ä¸­é—´å±‚æœåŠ¡å™¨çš„è´Ÿè½½å‡è¡¡å’Œæ•…éšœè½¬ç§»ã€‚</p><h3 id="å•ä¸ªæ³¨å†Œä¸­å¿ƒæ•´åˆ"><a href="#å•ä¸ªæ³¨å†Œä¸­å¿ƒæ•´åˆ" class="headerlink" title="å•ä¸ªæ³¨å†Œä¸­å¿ƒæ•´åˆ"></a>å•ä¸ªæ³¨å†Œä¸­å¿ƒæ•´åˆ</h3><h4 id="pomé…ç½®"><a href="#pomé…ç½®" class="headerlink" title="pomé…ç½®"></a>pomé…ç½®</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="application-yml"><a href="#application-yml" class="headerlink" title="application.yml"></a>application.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">eureka-server</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">7000</span> <span class="comment"># Server HTTP port.</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">localhost</span> <span class="comment"># eurekaå®ä¾‹çš„hostname</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span> <span class="comment"># æŒ‡ç¤ºå½“å‰å®ä¾‹æ˜¯å¦åº”åœ¨eurekaæœåŠ¡å™¨ä¸Šæ³¨å†Œå…¶ä¿¡æ¯ä»¥ä¾›å‘ç°</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">false</span> <span class="comment"># æŒ‡ç¤ºå½“å‰å®ä¾‹æ˜¯å¦ä»eurekaæœåŠ¡å™¨è·å–æ³¨å†Œè¡¨ä¿¡æ¯</span></span><br><span class="line">    <span class="attr">service-url:</span> <span class="comment"># æ˜ å°„mapã€‚æ˜ å°„å…³äºeurekaæœåŠ¡å™¨çš„urlåˆ—è¡¨ï¼Œmapçš„valueå€¼å¯ä»¥æ˜¯å•ä¸ªurlï¼Œä¹Ÿå¯ä»¥æ˜¯ä»¥,åˆ†å‰²ç¬¦åˆ†å‰²çš„å¤šä¸ªurlï¼Œä¿®æ”¹ä¹‹åç”Ÿæ•ˆæ—¶é—´å°†åœ¨ä¸‹ä¸€ä¸ªå¾ªç¯ä¸­ï¼Œç”±eurekaServiceUrlPollIntervalSecondsæŒ‡å®š</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://$&#123;eureka.instance.hostname&#125;:$&#123;server.port&#125;/eureka/</span></span><br></pre></td></tr></table></figure><h4 id="æ³¨è§£-EnableEurekaServer"><a href="#æ³¨è§£-EnableEurekaServer" class="headerlink" title="æ³¨è§£@EnableEurekaServer"></a>æ³¨è§£@EnableEurekaServer</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableEurekaServer</span> <span class="comment">// Annotation to activate Eureka Server related configuration. æ¿€æ´»eurekaç›¸å…³é…ç½®çš„æ³¨è§£</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EurekaServerApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(EurekaServerApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ‰“åŒ…éƒ¨ç½²è¿è¡Œ"><a href="#æ‰“åŒ…éƒ¨ç½²è¿è¡Œ" class="headerlink" title="æ‰“åŒ…éƒ¨ç½²è¿è¡Œ"></a>æ‰“åŒ…éƒ¨ç½²è¿è¡Œ</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">mvn clean package -Dmaven.test.skip&#x3D;true</span><br><span class="line"></span><br><span class="line">java -jar xxx.jar</span><br><span class="line"></span><br><span class="line">è®¿é—® localhost:7000</span><br></pre></td></tr></table></figure><h3 id="æ³¨å†Œä¸¤ä¸ªæ³¨å†Œä¸­å¿ƒ"><a href="#æ³¨å†Œä¸¤ä¸ªæ³¨å†Œä¸­å¿ƒ" class="headerlink" title="æ³¨å†Œä¸¤ä¸ªæ³¨å†Œä¸­å¿ƒ"></a>æ³¨å†Œä¸¤ä¸ªæ³¨å†Œä¸­å¿ƒ</h3><h3 id="ä¿®æ”¹application-yamlé…ç½®æ–‡ä»¶"><a href="#ä¿®æ”¹application-yamlé…ç½®æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹application.yamlé…ç½®æ–‡ä»¶"></a>ä¿®æ”¹application.yamlé…ç½®æ–‡ä»¶</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## æ–°å¢ä¸¤ä¸ªé…ç½®æ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## application-peer1.yml</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">eureka-server</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">7001</span> <span class="comment"># Server HTTP port.</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">localhost</span> <span class="comment"># eurekaå®ä¾‹çš„hostname</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span> <span class="comment"># æŒ‡ç¤ºå½“å‰å®ä¾‹æ˜¯å¦åº”åœ¨eurekaæœåŠ¡å™¨ä¸Šæ³¨å†Œå…¶ä¿¡æ¯ä»¥ä¾›å‘ç°</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">true</span> <span class="comment"># æŒ‡ç¤ºå½“å‰å®ä¾‹æ˜¯å¦ä»eurekaæœåŠ¡å™¨è·å–æ³¨å†Œè¡¨ä¿¡æ¯</span></span><br><span class="line">    <span class="attr">service-url:</span> <span class="comment"># æ˜ å°„mapã€‚æ˜ å°„å…³äºeurekaæœåŠ¡å™¨çš„urlåˆ—è¡¨ï¼Œmapçš„valueå€¼å¯ä»¥æ˜¯å•ä¸ªurlï¼Œä¹Ÿå¯ä»¥æ˜¯ä»¥,åˆ†å‰²ç¬¦åˆ†å‰²çš„å¤šä¸ªurlï¼Œä¿®æ”¹ä¹‹åç”Ÿæ•ˆæ—¶é—´å°†åœ¨ä¸‹ä¸€ä¸ªå¾ªç¯ä¸­ï¼Œç”±eurekaServiceUrlPollIntervalSecondsæŒ‡å®š</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://127.0.0.1:7002/eureka/</span></span><br><span class="line"> <span class="comment">## application-peer2.yml</span></span><br><span class="line"> <span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">eureka-server</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">7002</span> <span class="comment"># Server HTTP port.</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">localhost</span> <span class="comment"># eurekaå®ä¾‹çš„hostname</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span> <span class="comment"># æŒ‡ç¤ºå½“å‰å®ä¾‹æ˜¯å¦åº”åœ¨eurekaæœåŠ¡å™¨ä¸Šæ³¨å†Œå…¶ä¿¡æ¯ä»¥ä¾›å‘ç°</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">true</span> <span class="comment"># æŒ‡ç¤ºå½“å‰å®ä¾‹æ˜¯å¦ä»eurekaæœåŠ¡å™¨è·å–æ³¨å†Œè¡¨ä¿¡æ¯</span></span><br><span class="line">    <span class="attr">service-url:</span> <span class="comment"># æ˜ å°„mapã€‚æ˜ å°„å…³äºeurekaæœåŠ¡å™¨çš„urlåˆ—è¡¨ï¼Œmapçš„valueå€¼å¯ä»¥æ˜¯å•ä¸ªurlï¼Œä¹Ÿå¯ä»¥æ˜¯ä»¥,åˆ†å‰²ç¬¦åˆ†å‰²çš„å¤šä¸ªurlï¼Œä¿®æ”¹ä¹‹åç”Ÿæ•ˆæ—¶é—´å°†åœ¨ä¸‹ä¸€ä¸ªå¾ªç¯ä¸­ï¼Œç”±eurekaServiceUrlPollIntervalSecondsæŒ‡å®š</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://127.0.0.1:7001/eureka/</span></span><br></pre></td></tr></table></figure><h4 id="æ‰“åŒ…éƒ¨ç½²"><a href="#æ‰“åŒ…éƒ¨ç½²" class="headerlink" title="æ‰“åŒ…éƒ¨ç½²"></a>æ‰“åŒ…éƒ¨ç½²</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; æ‰“åŒ…</span><br><span class="line">mvn clean package -Dmaven.test.skip&#x3D;true</span><br><span class="line">&#x2F;&#x2F; è¿è¡Œ</span><br><span class="line">java -jar xxx.jar --spring.profiles.active&#x3D;peer1</span><br><span class="line">java -jar xxx.jpg --spring.profiles.active&#x3D;peer2</span><br><span class="line">&#x2F;&#x2F; è®¿é—®</span><br><span class="line">localhost:7001</span><br><span class="line">localhost:7002</span><br></pre></td></tr></table></figure><h3 id="æœåŠ¡æä¾›å’Œè°ƒç”¨"><a href="#æœåŠ¡æä¾›å’Œè°ƒç”¨" class="headerlink" title="æœåŠ¡æä¾›å’Œè°ƒç”¨"></a>æœåŠ¡æä¾›å’Œè°ƒç”¨</h3><h4 id="ç”Ÿæˆè€…"><a href="#ç”Ÿæˆè€…" class="headerlink" title="ç”Ÿæˆè€…"></a>ç”Ÿæˆè€…</h4><h5 id="pom"><a href="#pom" class="headerlink" title="pom"></a>pom</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.alibaba/fastjson --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.67<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="application-yml-1"><a href="#application-yml-1" class="headerlink" title="application.yml"></a>application.yml</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">eureka-producer</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://127.0.0.1:7000/eureka/</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8000</span></span><br></pre></td></tr></table></figure><h5 id="å…·ä½“æ–¹æ³•"><a href="#å…·ä½“æ–¹æ³•" class="headerlink" title="å…·ä½“æ–¹æ³•"></a>å…·ä½“æ–¹æ³•</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/hello"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">(@RequestBody JSONObject requestJSON)</span> </span>&#123;</span><br><span class="line">        String name = requestJSON.getString(<span class="string">"name"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"hello, "</span> + name + <span class="string">" "</span> + <span class="keyword">new</span> Date();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="æ‰“åŒ…éƒ¨ç½²æµ‹è¯•"><a href="#æ‰“åŒ…éƒ¨ç½²æµ‹è¯•" class="headerlink" title="æ‰“åŒ…éƒ¨ç½²æµ‹è¯•"></a>æ‰“åŒ…éƒ¨ç½²æµ‹è¯•</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mvn clean package -Dmaven.test.skip&#x3D;true</span><br><span class="line">java -jar xxx.jar</span><br><span class="line">curl -H&#39;Content-Type: application&#x2F;json&#39; -d&#39;&#123;&quot;name&quot;:&quot;huskyui&quot;&#125;&#39; localhost:8000&#x2F;hello</span><br><span class="line">hello, huskyui Fri Mar 20 16:06:40 CST 2020</span><br></pre></td></tr></table></figure><h4 id="æ¶ˆè´¹è€…"><a href="#æ¶ˆè´¹è€…" class="headerlink" title="æ¶ˆè´¹è€…"></a>æ¶ˆè´¹è€…</h4><h5 id="pom-1"><a href="#pom-1" class="headerlink" title="pom"></a>pom</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.alibaba/fastjson --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.67<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="application-yml-2"><a href="#application-yml-2" class="headerlink" title="application.yml"></a>application.yml</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">eureka-consumer</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:7000/eureka/</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9000</span></span><br></pre></td></tr></table></figure><h5 id="æ·»åŠ -EnableFeignClients"><a href="#æ·»åŠ -EnableFeignClients" class="headerlink" title="æ·»åŠ @EnableFeignClients"></a>æ·»åŠ @EnableFeignClients</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CloudEurekaConsumerApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(CloudEurekaConsumerApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="å…·ä½“ä»£ç "><a href="#å…·ä½“ä»£ç " class="headerlink" title="å…·ä½“ä»£ç "></a>å…·ä½“ä»£ç </h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient</span>(name = <span class="string">"eureka-producer"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">HelloRemote</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/hello"</span>)</span><br><span class="line">    <span class="function">String <span class="title">hello</span><span class="params">(@RequestBody JSONObject requestJSON)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> HelloRemote helloRemote;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/hello/&#123;name&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">index</span><span class="params">(@PathVariable(<span class="string">"name"</span>)</span>String name)</span>&#123;</span><br><span class="line">        JSONObject requestJSon = <span class="keyword">new</span> JSONObject();</span><br><span class="line">        requestJSon.put(<span class="string">"name"</span>,name);</span><br><span class="line">        <span class="keyword">return</span> helloRemote.hello(requestJSon);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="æ‰“åŒ…éƒ¨ç½²æµ‹è¯•-1"><a href="#æ‰“åŒ…éƒ¨ç½²æµ‹è¯•-1" class="headerlink" title="æ‰“åŒ…éƒ¨ç½²æµ‹è¯•"></a>æ‰“åŒ…éƒ¨ç½²æµ‹è¯•</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mvn clean package -Dmaven.test.skip&#x3D;true</span><br><span class="line">java -jar xxx.jar</span><br><span class="line">curl localhost:9000&#x2F;hello&#x2F;huskyui</span><br><span class="line">hello, huskyui Fri Mar 20 16:11:59 CST 2020</span><br></pre></td></tr></table></figure><h4 id="è´Ÿè½½å‡è¡¡"><a href="#è´Ÿè½½å‡è¡¡" class="headerlink" title="è´Ÿè½½å‡è¡¡"></a>è´Ÿè½½å‡è¡¡</h4><p>å¯åŠ¨ä¸¤ä¸ªä¸åŒç«¯å£çš„ç”Ÿäº§è€…ï¼Œå¯åŠ¨ä¸€ä¸ªæ¶ˆè´¹è€…ä¼šå®ç°ç›¸å…³æ•ˆæœ</p>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringCloud </tag>
            
            <tag> Eureka </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBootæ•´åˆRabbitMQ</title>
      <link href="/2020/03/19/SpringBoot%E6%95%B4%E5%90%88RabbitMQ/"/>
      <url>/2020/03/19/SpringBoot%E6%95%B4%E5%90%88RabbitMQ/</url>
      
        <content type="html"><![CDATA[<h3 id="SpringBooté…ç½®RabbitMQ"><a href="#SpringBooté…ç½®RabbitMQ" class="headerlink" title="SpringBooté…ç½®RabbitMQ"></a>SpringBooté…ç½®RabbitMQ</h3><h4 id="é…ç½®maven"><a href="#é…ç½®maven" class="headerlink" title="é…ç½®maven"></a>é…ç½®maven</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="é…ç½®æ–‡ä»¶application-yml"><a href="#é…ç½®æ–‡ä»¶application-yml" class="headerlink" title="é…ç½®æ–‡ä»¶application.yml"></a>é…ç½®æ–‡ä»¶application.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">user_mmr</span> <span class="comment">#ç”¨æˆ·å</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123</span> <span class="comment">#å¯†ç </span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">localhost</span> <span class="comment"># ä½ è¦è¿æ¥çš„RabbitMQçš„host</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span> <span class="comment"># Rabbitçš„port</span></span><br><span class="line">    <span class="attr">virtual-host:</span> <span class="string">'/vhost_mmr'</span> <span class="comment">#virtual-host</span></span><br></pre></td></tr></table></figure><h3 id="RabbitMQæ•™ç¨‹"><a href="#RabbitMQæ•™ç¨‹" class="headerlink" title="RabbitMQæ•™ç¨‹"></a>RabbitMQæ•™ç¨‹</h3><p>ä»¥ä¸‹æ•™ç¨‹éƒ½å¯ä»¥åœ¨RabbitMQåœ¨githubçš„ä»“åº“<code>rabbitmq-tutorial</code>ä¸­æ‰¾åˆ°ï¼Œå…·ä½“springbootåœ¨<code>spring-amqp</code>æ¨¡å—ä¸­ã€‚åœ¨è¿™é‡Œé¢è¦è®²ä¸€ä¸‹å¦‚ä½•è¿è¡Œç›¸å…³ä»£ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">### æ‰“åŒ…é¡¹ç›®</span><br><span class="line">mvn clean package</span><br><span class="line"></span><br><span class="line">### è¿è¡Œé¡¹ç›®</span><br><span class="line">java -jar xxx.jar --spring.profiles.active&#x3D;tut1,sender</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### ä¸‹é¢æ”¾ä¸Šç›¸å…³è¿è¡Œå‘½ä»¤</span><br><span class="line">System.out.println(&quot;java -jar rabbit-tutorials.jar --spring.profiles.active&#x3D;hello-world,receiver&quot;);</span><br><span class="line">System.out.println(&quot;java -jar rabbit-tutorials.jar --spring.profiles.active&#x3D;hello-world,sender&quot;);</span><br><span class="line">System.out.println(&quot;java -jar rabbit-tutorials.jar --spring.profiles.active&#x3D;work-queues,receiver&quot;);</span><br><span class="line">System.out.println(&quot;java -jar rabbit-tutorials.jar --spring.profiles.active&#x3D;work-queues,sender&quot;);</span><br><span class="line">System.out.println(&quot;java -jar rabbit-tutorials.jar --spring.profiles.active&#x3D;pub-sub,receiver&quot;);</span><br><span class="line">System.out.println(&quot;java -jar rabbit-tutorials.jar --spring.profiles.active&#x3D;pub-sub,sender&quot;);</span><br><span class="line">System.out.println(&quot;java -jar rabbit-tutorials.jar --spring.profiles.active&#x3D;routing,receiver&quot;);</span><br><span class="line">System.out.println(&quot;java -jar rabbit-tutorials.jar --spring.profiles.active&#x3D;routing,sender&quot;);</span><br><span class="line">System.out.println(&quot;java -jar rabbit-tutorials.jar --spring.profiles.active&#x3D;topics,receiver&quot;);</span><br><span class="line">System.out.println(&quot;java -jar rabbit-tutorials.jar --spring.profiles.active&#x3D;topics,sender&quot;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### æ³¨æ„ï¼Œè¯¥é¡¹ç›®ä½¿ç”¨äº†å®šæ—¶ä»»åŠ¡</span><br><span class="line">ä½ éœ€è¦é…ç½®å…è®¸å®šæ—¶è°ƒåº¦çš„æ³¨è§£</span><br><span class="line">@EnableScheduling</span><br></pre></td></tr></table></figure><h4 id="helloworld"><a href="#helloworld" class="headerlink" title="helloworld"></a>helloworld</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Profile</span>(&#123;<span class="string">"tut1"</span>,<span class="string">"hello-world"</span>&#125;)</span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Tut1Config</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">hello</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Queue(<span class="string">"hello"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Profile</span>(<span class="string">"receiver"</span>)</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Tut1Receiver <span class="title">receiver</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Tut1Receiver();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Profile</span>(<span class="string">"sender"</span>)</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Tut1Sender <span class="title">sender</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Tut1Sender();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›‘å¬helloé˜Ÿåˆ— Annotation that marks a method to be the target of a Rabbit message listener on the</span></span><br><span class="line"><span class="comment">// specified queues()æˆ–è€…bindings(). </span></span><br><span class="line"><span class="meta">@RabbitListener</span>(queues = <span class="string">"hello"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Tut1Receiver</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(Tut1Receiver<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Annotation that marks a method to be the target of a Rabbit message</span></span><br><span class="line"> <span class="comment">// listener within a class that is annotated with &#123;@link RabbitListener&#125;</span></span><br><span class="line">    <span class="meta">@RabbitHandler</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receive</span><span class="params">(String in)</span> </span>&#123;</span><br><span class="line">        logger.info(<span class="string">"[x] Received:&#123;&#125; "</span>, in);</span><br><span class="line">        System.out.println(<span class="string">"[x] Received:&#123;&#125; "</span>+ in);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Tut1Sender</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> Logger logger = LoggerFactory.getLogger(Tut1Sender<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Queue queue;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Scheduled</span>(fixedDelay = <span class="number">1000</span>, initialDelay = <span class="number">500</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String msg = <span class="string">"hello world"</span>;</span><br><span class="line">        <span class="keyword">this</span>.rabbitTemplate.convertAndSend(queue.getName(), msg);</span><br><span class="line">        logger.info(<span class="string">"[x] sent :"</span> + msg);</span><br><span class="line">        System.out.println(<span class="string">"[x] sent :"</span> + msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// java -jar xxx.jar --spring.profiles.active=hello-world,receiver</span></span><br><span class="line"><span class="comment">// java -jar xxx.jar --spring.profiles.active=hello-world,sender</span></span><br></pre></td></tr></table></figure><h4 id="work-queues"><a href="#work-queues" class="headerlink" title="work-queues"></a>work-queues</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RabbitListener</span>(queues = <span class="string">"tut.hello"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Tut2Receiver</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> Logger logger = LoggerFactory.getLogger(Tut2Receiver<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> instance;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Tut2Receiver</span><span class="params">(<span class="keyword">int</span> i)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.instance = i;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitHandler</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receive</span><span class="params">(String in)</span> <span class="keyword">throws</span> InterruptedException</span>&#123;</span><br><span class="line">        StopWatch watch = <span class="keyword">new</span> StopWatch();</span><br><span class="line">        watch.start();</span><br><span class="line">        logger.info(<span class="string">"instance "</span> + <span class="keyword">this</span>.instance+<span class="string">"[x] recived"</span> + in);</span><br><span class="line">        doWork(in);</span><br><span class="line">        watch.stop();</span><br><span class="line">        logger.info(<span class="string">"instance "</span> + <span class="keyword">this</span>.instance +<span class="string">"[x] done"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">doWork</span><span class="params">(String in)</span> <span class="keyword">throws</span> InterruptedException</span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">char</span> ch:in.toCharArray())&#123;</span><br><span class="line">            <span class="keyword">if</span>(ch == <span class="string">'.'</span>)&#123;</span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Tut2Sender</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Logger logger = LoggerFactory.getLogger(Tut2Sender<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Queue queue;</span><br><span class="line"></span><br><span class="line">    AtomicInteger dots = <span class="keyword">new</span> AtomicInteger(<span class="number">0</span>);</span><br><span class="line">    AtomicInteger count = <span class="keyword">new</span> AtomicInteger(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Scheduled</span>(fixedDelay = <span class="number">1000</span>,initialDelay = <span class="number">500</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">()</span></span>&#123;</span><br><span class="line">        StringBuilder builder = <span class="keyword">new</span> StringBuilder(<span class="string">"hello"</span>);</span><br><span class="line">        <span class="keyword">if</span>(dots.getAndIncrement() == <span class="number">3</span>)&#123;</span><br><span class="line">            dots.set(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i&lt;dots.get();i++)&#123;</span><br><span class="line">            builder.append(<span class="string">"."</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        builder.append(count.incrementAndGet());</span><br><span class="line">        String msg = builder.toString();</span><br><span class="line">        rabbitTemplate.convertAndSend(queue.getName(),msg);</span><br><span class="line">        logger.info(<span class="string">"[x] sent &#123;&#125;"</span>,msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Profile</span>(&#123;<span class="string">"tut2"</span>,<span class="string">"work-queues"</span>&#125;)</span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Tut2Config</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">hello</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Queue(<span class="string">"tut.hello"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Profile</span>(<span class="string">"receiver"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ReceiverConfig</span></span>&#123;</span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Tut2Receiver <span class="title">receiver1</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Tut2Receiver(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Tut2Receiver <span class="title">receiver2</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Tut2Receiver(<span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Profile</span>(<span class="string">"sender"</span>)</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Tut2Sender <span class="title">sender</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Tut2Sender();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="pub-sub"><a href="#pub-sub" class="headerlink" title="pub-sub"></a>pub-sub</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Profile</span>(&#123;<span class="string">"tut3"</span>,<span class="string">"pub-sub"</span>,<span class="string">"publish-subscribe"</span>&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Tut3Config</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> FanoutExchange <span class="title">fanout</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> FanoutExchange(<span class="string">"tut.fanout"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Profile</span>(<span class="string">"receiver"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ReceiverConfig</span></span>&#123;</span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Queue <span class="title">autoDeleteQueue1</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> AnonymousQueue();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Queue <span class="title">autoDeleteQueue2</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> AnonymousQueue();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¿™ä¸ªåœ°æ–¹å¯èƒ½æ³¨å†Œä¸æˆåŠŸ</span></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Binding <span class="title">binding1</span><span class="params">(FanoutExchange fanout,Queue autoDeleteQueue1)</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> BindingBuilder.bind(autoDeleteQueue1).to(fanout);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Binding <span class="title">binding2</span><span class="params">(FanoutExchange fanout,Queue autoDeleteQueue2)</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> BindingBuilder.bind(autoDeleteQueue2).to(fanout);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Tut3Receiver <span class="title">receiver</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Tut3Receiver();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Profile</span>(<span class="string">"sender"</span>)</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Tut3Sender <span class="title">sender</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Tut3Sender();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Tut3Receiver</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener</span>(queues = <span class="string">"#&#123;autoDeleteQueue1.name&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receive1</span><span class="params">(String in)</span> <span class="keyword">throws</span> InterruptedException</span>&#123;</span><br><span class="line">        receive(in,<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener</span>(queues = <span class="string">"#&#123;autoDeleteQueue2.name&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receive2</span><span class="params">(String in)</span> <span class="keyword">throws</span> InterruptedException</span>&#123;</span><br><span class="line">        receive(in,<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receive</span><span class="params">(String in,<span class="keyword">int</span> receiver)</span> <span class="keyword">throws</span> InterruptedException</span>&#123;</span><br><span class="line">        StopWatch watch = <span class="keyword">new</span> StopWatch();</span><br><span class="line">        watch.start();</span><br><span class="line">        System.out.println(<span class="string">"instance "</span> + receiver + <span class="string">"[x] Received"</span> + in);</span><br><span class="line">        doWork(in);</span><br><span class="line">        watch.stop();</span><br><span class="line">        System.out.println(<span class="string">"instance"</span> + receiver + <span class="string">"[x] Done in"</span> + watch.getTotalTimeSeconds()+<span class="string">"s"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">doWork</span><span class="params">(String in)</span> <span class="keyword">throws</span> InterruptedException</span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">char</span> ch: in.toCharArray())&#123;</span><br><span class="line">            <span class="keyword">if</span>(ch == <span class="string">'.'</span>)&#123;</span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Tut3Sender</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> FanoutExchange fanout;</span><br><span class="line"></span><br><span class="line">    AtomicInteger dots = <span class="keyword">new</span> AtomicInteger(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    AtomicInteger count = <span class="keyword">new</span> AtomicInteger(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Scheduled</span>(fixedDelay = <span class="number">1000</span>,initialDelay = <span class="number">500</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">()</span></span>&#123;</span><br><span class="line">        StringBuilder builder = <span class="keyword">new</span> StringBuilder(<span class="string">"hello"</span>);</span><br><span class="line">        <span class="keyword">if</span>(dots.getAndIncrement() == <span class="number">3</span>)&#123;</span><br><span class="line">            dots.set(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; dots.get();i++)&#123;</span><br><span class="line">            builder.append(<span class="string">"."</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        builder.append(count.incrementAndGet());</span><br><span class="line">        String message = builder.toString();</span><br><span class="line">        rabbitTemplate.convertAndSend(fanout.getName(),<span class="string">""</span>,message);</span><br><span class="line">        System.out.println(<span class="string">"[x] sent"</span> +message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="direct"><a href="#direct" class="headerlink" title="direct"></a>direct</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Profile</span>(&#123;<span class="string">"tut4"</span>,<span class="string">"routing"</span>&#125;)</span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Tut4Config</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è®¾ç½®exchange</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DirectExchange <span class="title">direct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DirectExchange(<span class="string">"tut.direct"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Profile</span>(<span class="string">"receiver"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ReceiverConfig</span></span>&#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸¤ä¸ªåŒ¿åQueue  an anonymous, non-durable, exclusive, auto-delete queue</span></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Queue <span class="title">autoDeleteQueue1</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> AnonymousQueue();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Queue <span class="title">autoDeleteQueue2</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> AnonymousQueue();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç»‘å®šç›¸å…³æ•°æ®</span></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Binding <span class="title">binding1a</span><span class="params">(DirectExchange directExchange,Queue autoDeleteQueue1)</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> BindingBuilder.bind(autoDeleteQueue1).to(directExchange).with(<span class="string">"orange"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Binding <span class="title">binding1b</span><span class="params">(DirectExchange directExchange,Queue autoDeleteQueue1)</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> BindingBuilder.bind(autoDeleteQueue1).to(directExchange).with(<span class="string">"black"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Binding <span class="title">binding2a</span><span class="params">(DirectExchange directExchange,Queue autoDeleteQueue2)</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> BindingBuilder.bind(autoDeleteQueue2).to(directExchange).with(<span class="string">"green"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Binding <span class="title">binding2b</span><span class="params">(DirectExchange direct,Queue autoDeleteQueue2)</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> BindingBuilder.bind(autoDeleteQueue2).to(direct).with(<span class="string">"black"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Tut4Receiver <span class="title">receiver</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Tut4Receiver();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Profile</span>(<span class="string">"sender"</span>)</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Tut4Sender <span class="title">sender</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Tut4Sender();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Tut4Receiver</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RabbitListener</span>(queues = <span class="string">"#&#123;autoDeleteQueue1.name&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receive1</span><span class="params">(String in)</span> <span class="keyword">throws</span> InterruptedException</span>&#123;</span><br><span class="line">        receive(in,<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener</span>(queues = <span class="string">"#&#123;autoDeleteQueue2.name&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receive2</span><span class="params">(String in)</span> <span class="keyword">throws</span> InterruptedException</span>&#123;</span><br><span class="line">        receive(in,<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receive</span><span class="params">(String in,<span class="keyword">int</span> receiver)</span> <span class="keyword">throws</span> InterruptedException</span>&#123;</span><br><span class="line">        StopWatch watch = <span class="keyword">new</span> StopWatch();</span><br><span class="line">        watch.start();</span><br><span class="line">        System.out.println(<span class="string">"instance "</span> + receiver+<span class="string">"[x] received ' "</span> + in+ <span class="string">"'"</span>);</span><br><span class="line">        doWork(in);</span><br><span class="line">        watch.stop();</span><br><span class="line">        System.out.println(<span class="string">"instance "</span>+ receiver+<span class="string">"[x] Done in"</span> + watch.getTotalTimeSeconds()+<span class="string">"s"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">doWork</span><span class="params">(String in)</span> <span class="keyword">throws</span> InterruptedException</span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">char</span> ch: in.toCharArray())&#123;</span><br><span class="line">            <span class="keyword">if</span>(ch == <span class="string">'.'</span>)&#123;</span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Tut4Sender</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DirectExchange directExchange;</span><br><span class="line"></span><br><span class="line">    AtomicInteger index = <span class="keyword">new</span> AtomicInteger(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    AtomicInteger count = <span class="keyword">new</span> AtomicInteger(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String[] keys = &#123;<span class="string">"orange"</span>, <span class="string">"black"</span>, <span class="string">"green"</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Scheduled</span>(fixedDelay = <span class="number">1000</span>, initialDelay = <span class="number">500</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        StringBuilder builder = <span class="keyword">new</span> StringBuilder(<span class="string">"Hello to "</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.index.incrementAndGet() == <span class="number">3</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.index.set(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        String key = keys[<span class="keyword">this</span>.index.get()];</span><br><span class="line">        builder.append(key).append(<span class="string">' '</span>);</span><br><span class="line">        builder.append(<span class="keyword">this</span>.count.incrementAndGet());</span><br><span class="line">        String message = builder.toString();</span><br><span class="line">        rabbitTemplate.convertAndSend(directExchange.getName(), key, message);</span><br><span class="line">        System.out.println(<span class="string">"[X] sent '"</span> + message + <span class="string">"'"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="topic"><a href="#topic" class="headerlink" title="topic"></a>topic</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Profile</span>(&#123;<span class="string">"tut5"</span>,<span class="string">"topics"</span>&#125;)</span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Tut5Config</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> TopicExchange <span class="title">topicExchange</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> TopicExchange(<span class="string">"tut.topic"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Profile</span>(<span class="string">"receiver"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ReceiverConfig</span></span>&#123;</span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Tut5Receiver <span class="title">receiver</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Tut5Receiver();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Queue <span class="title">autoDeleteQueue1</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> AnonymousQueue();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Queue <span class="title">autoDeleteQueue2</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> AnonymousQueue();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Binding <span class="title">binding1a</span><span class="params">(TopicExchange topicExchange,Queue autoDeleteQueue1)</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> BindingBuilder.bind(autoDeleteQueue1).to(topicExchange).with(<span class="string">"*.orange.*"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Binding <span class="title">binding1b</span><span class="params">(TopicExchange topicExchange,Queue autoDeleteQueue1)</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> BindingBuilder.bind(autoDeleteQueue1).to(topicExchange).with(<span class="string">"*.*.rabbit"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Binding <span class="title">binding2a</span><span class="params">(TopicExchange topic,Queue autoDeleteQueue2)</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> BindingBuilder.bind(autoDeleteQueue2).to(topic).with(<span class="string">"lazy.#"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Profile</span>(<span class="string">"sender"</span>)</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Tut5Sender <span class="title">sender</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Tut5Sender();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Tut5Receiver</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RabbitListener</span>(queues = <span class="string">"#&#123;autoDeleteQueue1.name&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receive1</span><span class="params">(String in)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        receive(in, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener</span>(queues = <span class="string">"#&#123;autoDeleteQueue2.name&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receive2</span><span class="params">(String in)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        receive(in, <span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receive</span><span class="params">(String in, <span class="keyword">int</span> receiver)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        StopWatch watch = <span class="keyword">new</span> StopWatch();</span><br><span class="line">        watch.start();</span><br><span class="line">        System.out.println(<span class="string">"instance "</span> + receiver + <span class="string">" [X] received ' "</span> + in + <span class="string">" '"</span>);</span><br><span class="line">        doWork(in);</span><br><span class="line">        watch.stop();</span><br><span class="line">        System.out.println(<span class="string">"instance "</span> + receiver + <span class="string">" [X] Done in"</span> + watch.getTotalTimeSeconds() +<span class="string">"s"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">doWork</span><span class="params">(String in)</span> <span class="keyword">throws</span> InterruptedException</span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">char</span> ch : in.toCharArray())&#123;</span><br><span class="line">            <span class="keyword">if</span>(ch == <span class="string">'.'</span>)&#123;</span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Tut5Sender</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TopicExchange topicExchange;</span><br><span class="line"></span><br><span class="line">    AtomicInteger index = <span class="keyword">new</span> AtomicInteger(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    AtomicInteger count = <span class="keyword">new</span> AtomicInteger(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String[] keys = &#123;<span class="string">"quick.orange.rabbit"</span>, <span class="string">"lazy.orange.elephant"</span>, <span class="string">"quick.orange.fox"</span>,</span><br><span class="line">            <span class="string">"lazy.brown.fox"</span>, <span class="string">"lazy.pink.rabbit"</span>, <span class="string">"quick.brown.fox"</span>&#125;;</span><br><span class="line">    <span class="meta">@Scheduled</span>(fixedDelay = <span class="number">1000</span>,initialDelay = <span class="number">500</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">()</span></span>&#123;</span><br><span class="line">        StringBuilder builder = <span class="keyword">new</span> StringBuilder(<span class="string">"Hello to "</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.index.incrementAndGet() == keys.length)&#123;</span><br><span class="line">            <span class="keyword">this</span>.index.set(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        String key = keys[<span class="keyword">this</span>.index.get()];</span><br><span class="line">        builder.append(key).append(<span class="string">" "</span>);</span><br><span class="line">        builder.append(<span class="keyword">this</span>.count.incrementAndGet());</span><br><span class="line">        String message = builder.toString();</span><br><span class="line">        rabbitTemplate.convertAndSend(topicExchange.getName(),key,message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> rabbitmq </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RabbitMQ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RabbitMQ-topic</title>
      <link href="/2020/03/13/RabbitMQ-topic/"/>
      <url>/2020/03/13/RabbitMQ-topic/</url>
      
        <content type="html"><![CDATA[<h3 id="Topic"><a href="#Topic" class="headerlink" title="Topic"></a>Topic</h3><p>åœ¨ä¹‹å‰çš„ä¸€ç¯‡æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ”¹è¿›äº†æ—¥å¿—ç³»ç»Ÿã€‚æˆ‘ä»¬ä½¿ç”¨<code>direct</code>ç›´æ¥å¹¿æ’­ï¼Œè€Œä¸æ˜¯ä½¿ç”¨<code>fanout</code>,ä»è€Œè·å¾—äº†é€‰æ‹©æ€§æ¥æ”¶æ—¥å¿—çš„å¯èƒ½æ€§ã€‚</p><p>è™½ç„¶ä½¿ç”¨<code>direct exchange</code>æ”¹è¿›äº†æˆ‘ä»¬çš„ç³»ç»Ÿï¼Œä½†å®ƒä»»ç„¶æœ‰å±€é™æ€§â€“å®ƒä¸èƒ½åŸºäºå¤šä¸ªæ ‡å‡†è¿›è¡Œè·¯ç”±ã€‚</p><h3 id="Topic-exchange"><a href="#Topic-exchange" class="headerlink" title="Topic exchange"></a>Topic exchange</h3><p>æ¶ˆæ¯å‘é€åˆ°<code>topic exchange</code>ä¸èƒ½æ˜¯ä¸€ä¸ªéšæ„çš„<code>routing-key</code>ã€‚å®ƒå¿…é¡»æ˜¯ä¸€ä¸ªç”±<code>.</code>åˆ†å‰²å•çº¯åˆ—è¡¨ã€‚</p><p>ä¾‹å¦‚<code>stock.usd.nyse</code>ã€<code>nyse.vmw</code>ã€<code>quick.orange.rabbit</code>ç­‰ã€‚<code>routing-key</code>å¯ä»¥æœ‰å°½å¯èƒ½å¤šï¼Œä½†æ˜¯æœ€å¤š255å­—èŠ‚ã€‚</p><p>ç»‘å®šé”®å¿…é¡»é‡‡ç”¨ç›¸åŒçš„å½¢å¼ã€‚<code>topic exchange</code>å’Œ<code>direct exchange</code>ç±»ä¼¼-ä½¿ç”¨ç‰¹å®š<code>routig key</code>å‘é€çš„æ¶ˆæ¯ä¼šè¢«ä¼ é€’åˆ°åŒ¹é…<code>binding key</code>çš„é˜Ÿåˆ—é‡Œé¢ã€‚ä½†æ˜¯ï¼Œå¯¹äº<code>routing key</code>æœ‰ä¸¤ä¸ªç‰¹æ®Šæƒ…å†µ</p><ul><li><code>*</code> (starï¼‰å¯ä»¥æ›¿ä»£ä¸€ä¸ªå•è¯</li><li>`#``(hash) å¯ä»¥ä»£æ›¿0ä¸ªæˆ–å¤šä¸ªå•è¯</li></ul><blockquote><h3 id="Topic-exchange-1"><a href="#Topic-exchange-1" class="headerlink" title="Topic exchange"></a>Topic exchange</h3><p>Topic exchangeæ˜¯éå¸¸å‰å®³çš„å¹¶ä¸”å¯ä»¥è¡¨ç°å’Œå…¶ä»–exchangeä¸€æ ·çš„</p><p>å½“ä¸€ä¸ªé˜Ÿåˆ—æ˜¯ç”¨<code>#</code>ç»‘å®šï¼Œé‚£ä¹ˆå°±ä¼šæ¥å—åˆ°æ‰€æœ‰ä¿¡æ¯ï¼Œä¸ç®¡routing-keyæ˜¯ä»€ä¹ˆï¼Œå°±åƒfanout</p><p>å½“ç»‘å®šä¸­ä¸ä½¿ç”¨<code>*</code>å’Œ<code>#</code>ç­‰ç‰¹æ®Šå­—ç¬¦ï¼Œtopic exchangeå°±ä¼šåƒdirect exchange</p></blockquote><h3 id="Sender-java"><a href="#Sender-java" class="headerlink" title="Sender.java"></a>Sender.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Send</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String EXCHANGE_NAME = <span class="string">"test_exchange_topic"</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException </span>&#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºè¿æ¥</span></span><br><span class="line">        Connection connection = ConnectionUtils.getConnection();</span><br><span class="line">        Channel channel = connection.createChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å£°æ˜exchange</span></span><br><span class="line">        channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.TOPIC);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ¶ˆæ¯å†…å®¹</span></span><br><span class="line">        String msg = <span class="string">"hello world!"</span>;</span><br><span class="line">        channel.basicPublish(EXCHANGE_NAME,<span class="string">"routekey1.1"</span>,<span class="keyword">null</span>,msg.getBytes());</span><br><span class="line">        channel.close();</span><br><span class="line">        connection.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="rece1-java"><a href="#rece1-java" class="headerlink" title="rece1.java"></a>rece1.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Rece1</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String EXCHANGE_NAME = <span class="string">"test_exchange_topic"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException </span>&#123;</span><br><span class="line">        Connection connection = ConnectionUtils.getConnection();</span><br><span class="line">        Channel channel = connection.createChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        String queueName = channel.queueDeclare().getQueue();</span><br><span class="line"><span class="comment">//        // å£°æ˜é˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">//        channel.queueDeclare(queueName,false,false,false,null);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç»‘å®šé˜Ÿåˆ—åˆ°äº¤æ¢æœºä¸Š</span></span><br><span class="line">        channel.queueBind(queueName,EXCHANGE_NAME,<span class="string">"routekey.*"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åŒä¸€æ—¶åˆ»æœåŠ¡å™¨åªå‘é€ä¸€æ¡æ¶ˆæ¯</span></span><br><span class="line">        channel.basicQos(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        Consumer consumer  = <span class="keyword">new</span> DefaultConsumer(channel)&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, <span class="keyword">byte</span>[] body)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">                String msg = <span class="keyword">new</span> String(body,<span class="string">"utf-8"</span>);</span><br><span class="line">                System.out.println(<span class="string">"rece1 :"</span> + msg);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">"rece1 done"</span>);</span><br><span class="line">                    channel.basicAck(envelope.getDeliveryTag(),<span class="keyword">false</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        channel.basicConsume(queueName,<span class="keyword">false</span>,consumer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="rece2-java"><a href="#rece2-java" class="headerlink" title="rece2.java"></a>rece2.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Rece2</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String QUEUE_NAME = <span class="string">"test_queue_topic_work_2"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String EXCHANGE_NAME = <span class="string">"test_exchange_topic"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException </span>&#123;</span><br><span class="line">        Connection connection = ConnectionUtils.getConnection();</span><br><span class="line">        Channel channel = connection.createChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å£°æ˜é˜Ÿåˆ—</span></span><br><span class="line">        channel.queueDeclare(QUEUE_NAME,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç»‘å®šé˜Ÿåˆ—åˆ°äº¤æ¢æœºä¸Š</span></span><br><span class="line">        channel.queueBind(QUEUE_NAME,EXCHANGE_NAME,<span class="string">"*.*"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åŒä¸€æ—¶åˆ»æœåŠ¡å™¨åªå‘é€ä¸€æ¡æ¶ˆæ¯</span></span><br><span class="line">        channel.basicQos(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        Consumer consumer  = <span class="keyword">new</span> DefaultConsumer(channel)&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, <span class="keyword">byte</span>[] body)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">                String msg = <span class="keyword">new</span> String(body,<span class="string">"utf-8"</span>);</span><br><span class="line">                System.out.println(<span class="string">"rece1 :"</span> + msg);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">"rece1 done"</span>);</span><br><span class="line">                    channel.basicAck(envelope.getDeliveryTag(),<span class="keyword">false</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        channel.basicConsume(QUEUE_NAME,<span class="keyword">false</span>,consumer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> rabbitmq </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RabbitMQ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RabbitMQ-routing</title>
      <link href="/2020/03/09/RabbitMQ-routing/"/>
      <url>/2020/03/09/RabbitMQ-routing/</url>
      
        <content type="html"><![CDATA[<h3 id="routing"><a href="#routing" class="headerlink" title="routing"></a>routing</h3><p>åœ¨ä¹‹å‰çš„å¯¼èˆªä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•æ—¥å¿—ç³»ç»Ÿï¼Œæˆ‘ä»¬èƒ½å¤Ÿå°†æ—¥å¿—ä¿¡æ¯å¹¿æ’­åˆ°å¾ˆå¤šæ¥å—è€…ã€‚</p><p>åœ¨æœ¬ç¯‡å¯¼èˆªä¸­ï¼Œæˆ‘ä»¬å°†ä¸ºå…¶æ·»åŠ ä¸€ä¸ªç‰¹æ€§-æˆ‘ä»¬å°†ä½¿è®¢é˜…æ¶ˆæ¯çš„ä¸€ä¸ªå­é›†æˆä¸ºå¯èƒ½ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå°†é”™è¯¯ä¿¡æ¯å®šå‘å†™å…¥é”™è¯¯æ—¥å¿—æ–‡ä»¶ï¼ŒåŒæ—¶èƒ½å¤Ÿåœ¨æ§åˆ¶å°æ‰“å°æ‰€æœ‰ä¿¡æ¯ã€‚</p><h3 id="binding"><a href="#binding" class="headerlink" title="binding"></a>binding</h3><p>åœ¨ä¹‹å‰çš„ä¾‹å­ä¸­æˆ‘ä»¬èƒ½å¤Ÿåˆ›å»ºç»‘å®šï¼Œä½ å¯èƒ½ä¼šå›æƒ³èµ·è¿™æ ·çš„ä»£ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">channel.queueBind(queueName, EXCHANGE_NAME, &quot;&quot;);</span><br></pre></td></tr></table></figure><p>ç»‘å®šæ˜¯äº¤æ¢å’Œé˜Ÿåˆ—ä¹‹é—´çš„å…³ç³»ã€‚è¿™å¯ä»¥ç®€å•åœ°ç†è§£ï¼šé˜Ÿåˆ—å¯¹æ¥è‡ªè¿™ä¸ªäº¤æ¢çš„æ¶ˆæ¯æ„Ÿå…´è¶£ã€‚</p><p>ç»‘å®šå¯ä»¥ä½¿ç”¨é¢å¤–çš„routingKeyå‚æ•°ã€‚ä¸ºäº†é¿å…ä¸åŸºæœ¬çš„å‘å¸ƒå‚æ•°æ··æ·†ï¼Œæˆ‘ä»¬å°†å…¶ç§°ä¸ºç»‘å®šé”®ã€‚è¿™å°±æ˜¯æˆ‘ä»¬å¦‚ä½•é”®åˆ›å»ºç»‘å®šçš„æ–¹æ³•ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">channel.queueBind(queueName, EXCHANGE_NAME, &quot;black&quot;);</span><br></pre></td></tr></table></figure><p>ç»‘å®šé”®çš„æ„ä¹‰å–å†³äºäº¤æ¢ç±»å‹ã€‚æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨çš„<code>fanout</code>äº¤æ¢æœºå®Œå…¨å¿½ç•¥äº†å®ƒçš„ä»·å€¼ã€‚</p><h3 id="Direct-exchange"><a href="#Direct-exchange" class="headerlink" title="Direct exchange"></a>Direct exchange</h3><p>æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨çš„<code>fanout</code>exchange,è¿™å¹¶æ²¡æœ‰ç»™æˆ‘ä»¬å¤šå¤§çš„çµæ´»æ€§â€”â€”å®ƒåªèƒ½è¿›è¡Œä¸éœ€è¦åŠ¨è„‘ç­‹çš„å¹¿æ’­ã€‚æˆ‘ä»¬å°†ç”¨<code>direct</code>exchange.æ¶ˆæ¯å¯ä»¥ä¼ é€’åˆ°å…¶ç»‘å®šé”®<code>bindingKey</code>ä¸æ¶ˆæ¯çš„è·¯ç”±é”®<code>routingkey</code>å®Œå…¨åŒ¹é…çš„é˜Ÿåˆ—</p><p><img src="https://www.rabbitmq.com/img/tutorials/python-four.png" alt="directå½¢å¼exchange"></p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œé¢errorå¯ä»¥å‘é€åˆ°<code>amqp.gen-S9b...</code>å’Œ<code>amqp.gen-Ag1...</code>é˜Ÿåˆ—ä¸­,è€Œinfoå’Œwaringåªèƒ½å‘é€åˆ°<code>amqp.gen-Ag1...</code>é˜Ÿåˆ—ä¸­</p><p>Send.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Send</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String EXCHANGE_NAME = <span class="string">"test_exchange_direct"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException </span>&#123;</span><br><span class="line">        Connection connection = ConnectionUtils.getConnection();</span><br><span class="line">        <span class="comment">// åˆ›å»ºchannle</span></span><br><span class="line">        Channel channel = connection.createChannel();</span><br><span class="line">        <span class="comment">// å£°æ˜exchange</span></span><br><span class="line">        channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.DIRECT);</span><br><span class="line">        String msg = <span class="string">"hello exchange direct"</span>;</span><br><span class="line">        String routingKey = <span class="string">"error"</span>;</span><br><span class="line">        channel.basicPublish(EXCHANGE_NAME, routingKey, <span class="keyword">null</span>, msg.getBytes());</span><br><span class="line"></span><br><span class="line">        channel.close();</span><br><span class="line">        connection.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Rece1.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Rece1</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String EXCHANGE_NAME = <span class="string">"test_exchange_direct"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String QUEUE_NAME = <span class="string">"test_queue_direct1"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException </span>&#123;</span><br><span class="line">        Connection connection = ConnectionUtils.getConnection();</span><br><span class="line">        Channel channel = connection.createChannel();</span><br><span class="line">        channel.queueDeclare(QUEUE_NAME,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">null</span>);</span><br><span class="line">        channel.queueBind(QUEUE_NAME,EXCHANGE_NAME,<span class="string">"error"</span>);</span><br><span class="line"></span><br><span class="line">        channel.basicQos(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        Consumer consumer = <span class="keyword">new</span> DefaultConsumer(channel)&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, <span class="keyword">byte</span>[] body)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">                String msg = <span class="keyword">new</span> String(body,<span class="string">"utf-8"</span>);</span><br><span class="line">                System.out.println(<span class="string">"rece1 recieve msg :"</span> + msg);</span><br><span class="line">                <span class="keyword">try</span>&#123;</span><br><span class="line">                    TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">"rece1 done"</span>);</span><br><span class="line">                    channel.basicAck(envelope.getDeliveryTag(),<span class="keyword">false</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        channel.basicConsume(QUEUE_NAME,<span class="keyword">false</span>,consumer);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Rece2.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Rece1</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String EXCHANGE_NAME = <span class="string">"test_exchange_direct"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String QUEUE_NAME = <span class="string">"test_queue_direct1"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException </span>&#123;</span><br><span class="line">        Connection connection = ConnectionUtils.getConnection();</span><br><span class="line">        Channel channel = connection.createChannel();</span><br><span class="line">        channel.queueDeclare(QUEUE_NAME,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">null</span>);</span><br><span class="line">        channel.queueBind(QUEUE_NAME,EXCHANGE_NAME,<span class="string">"error"</span>);</span><br><span class="line"></span><br><span class="line">        channel.basicQos(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        Consumer consumer = <span class="keyword">new</span> DefaultConsumer(channel)&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, <span class="keyword">byte</span>[] body)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">                String msg = <span class="keyword">new</span> String(body,<span class="string">"utf-8"</span>);</span><br><span class="line">                System.out.println(<span class="string">"rece1 recieve msg :"</span> + msg);</span><br><span class="line">                <span class="keyword">try</span>&#123;</span><br><span class="line">                    TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">"rece1 done"</span>);</span><br><span class="line">                    channel.basicAck(envelope.getDeliveryTag(),<span class="keyword">false</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        channel.basicConsume(QUEUE_NAME,<span class="keyword">false</span>,consumer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¶å°”æŠ¥é”™"><a href="#å¶å°”æŠ¥é”™" class="headerlink" title="å¶å°”æŠ¥é”™"></a>å¶å°”æŠ¥é”™</h3><p>é˜Ÿåˆ—ç»‘å®šäº¤æ¢æœºæ—¶ï¼ŒroutingKeyæ˜¯å…·æœ‰ç¼“å­˜æœºåˆ¶çš„ã€‚æˆ‘åœ¨å†™ä»£ç çš„æ—¶å€™ï¼Œè¯¯æ“ä½œäº†å°†é˜Ÿåˆ—éƒ½ç»‘å®šäº†<code>error</code>ï¼Œ<code>info</code>,<code>warning</code>.æˆ‘å‘ç°æ— æ³•å®ç°ä¸Šè¿°çš„æ•ˆæœï¼Œæ”¹äº†ä»£ç ï¼Œä½†æ˜¯è¿˜æ˜¯æ— æ³•è§£å†³ã€‚æœ€åç™»å½•äº†RabbitMQæŸ¥çœ‹ç›¸å…³ç»‘å®šã€‚å¹¶ä½¿ç”¨çš„unbindåŠŸèƒ½ã€‚</p><p><a href="https://imgchr.com/i/8AFtBT" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2020/03/11/8AFtBT.md.png" alt="8AFtBT.md.png"></a></p>]]></content>
      
      
      <categories>
          
          <category> rabbitmq </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RabbitMQ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RabbitMQ-å‘å¸ƒ/è®¢é˜…</title>
      <link href="/2020/03/01/RabbitMQ-%E5%8F%91%E5%B8%83-%E8%AE%A2%E9%98%85/"/>
      <url>/2020/03/01/RabbitMQ-%E5%8F%91%E5%B8%83-%E8%AE%A2%E9%98%85/</url>
      
        <content type="html"><![CDATA[<h3 id="å‘å¸ƒä¸è®¢é˜…"><a href="#å‘å¸ƒä¸è®¢é˜…" class="headerlink" title="å‘å¸ƒä¸è®¢é˜…"></a>å‘å¸ƒä¸è®¢é˜…</h3><p>åœ¨ä¸Šä¸€ä¸ªæ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå·¥ä½œé˜Ÿåˆ—ï¼Œæˆ‘ä»¬å°†æ¯ä¸ªäººç‰©ï¼Œæœ€ç»ˆæ°å¥½åˆ†é…åˆ°ä¸€ä¸ªå·¥äººã€‚ç„¶è€Œï¼Œåœ¨è¿™ä¸ªéƒ¨åˆ†ï¼Œæˆ‘ä»¬å¸Œæœ›æ¯ä¸ªæ¶ˆæ¯èƒ½åˆ†é…ç»™å¤šä¸ªæ¶ˆè´¹è€…ã€‚è¿™ç§å«å‘å¸ƒè®¢é˜…æ¨¡å¼ã€‚ä¸¾ä¾‹ï¼Œæ³¨å†Œæ—¶éœ€è¦åŒæ—¶å‘é€çŸ­ä¿¡å’Œå‘é€email,æˆ‘ä»¬ä¼šå°†ç”¨æˆ·æ³¨å†Œçš„ä¿¡æ¯å‘ç»™ä¸¤ä¸ªæ¶ˆè´¹è€…ï¼Œä¸€ä¸ªä¸“é—¨å‘é€çŸ­ä¿¡æ¶ˆè´¹è€…ï¼Œä¸€ä¸ªä¸“é—¨å‘é€emailæ¶ˆè´¹è€…ã€‚</p><p>RabbitMQæ¶ˆæ¯ä¼ é€’æ¨¡å‹çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œç”Ÿäº§è€…ä¸ç›´æ¥æƒ³æ¶ˆæ¯é˜Ÿåˆ—å‘é€ä¿¡æ¯ã€‚å®é™…ä¸Šï¼Œç”Ÿäº§è€…å¹¶ä¸çŸ¥é“æ¶ˆæ¯æ˜¯å¦ä¼šè¢«ä¼ é€’åˆ°ä»»ä½•é˜Ÿåˆ—ä¸Šã€‚</p><h4 id="äº¤æ¢æœº"><a href="#äº¤æ¢æœº" class="headerlink" title="äº¤æ¢æœº"></a>äº¤æ¢æœº</h4><p>è¿™é‡Œå°±è®²åˆ°ä¸€ä¸ªæ–°å‹æ¦‚å¿µï¼Œäº¤æ¢æœºï¼ˆexchangeï¼‰,ä¸€æ–¹é¢æ¥æ”¶ç”Ÿäº§è€…çš„ä¿¡æ¯ï¼Œä¸€æ–¹é¢æ¨é€ç»™é˜Ÿåˆ—ã€‚äº¤æ¢å™¨å¿…é¡»ç¡®åˆ‡åœ°çŸ¥é“å¦‚ä½•å¤„ç†å®ƒæ¥æ”¶åˆ°çš„æ¶ˆæ¯ã€‚å®ƒåº”è¯¥è¢«é™„åŠ åˆ°ä¸€ä¸ªç‰¹å®šçš„é˜Ÿåˆ—å—?å®ƒåº”è¯¥è¢«æ·»åŠ åˆ°è®¸å¤šé˜Ÿåˆ—ä¸­å—?æˆ–è€…å®ƒåº”è¯¥è¢«ä¸¢å¼ƒã€‚è¿™äº›è§„åˆ™ç”±exchangeç±»å‹å®šä¹‰ã€‚æœ‰å‡ ç§å¯ç”¨çš„äº¤æ¢ç±»å‹:directã€topicã€headerså’Œfanoutã€‚ä¸‹é¢è®²ï¼šfanoutï¼Œæ˜¯ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„ç±»å‹ã€‚åªæ˜¯å°†æ¶ˆæ¯å¹¿æ’­åˆ°å®ƒçŸ¥é“çš„æ‰€æœ‰é˜Ÿåˆ—ä¸­å»ã€‚ä¸‹å›¾ä¸­Xå°±æ˜¯äº¤æ¢æœºã€‚</p><p><img src="https://www.rabbitmq.com/img/tutorials/exchanges.png" alt="exchangeæ¨¡å‹å›¾"></p><h3 id="ç”Ÿäº§è€…"><a href="#ç”Ÿäº§è€…" class="headerlink" title="ç”Ÿäº§è€…"></a>ç”Ÿäº§è€…</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">public class Send &#123;</span><br><span class="line">    private final static String EXCHANGE_NAME &#x3D; &quot;test_exchange_fanout&quot;;</span><br><span class="line">    public static void main(String[] args) throws IOException, TimeoutException &#123;</span><br><span class="line">        Connection connection &#x3D; ConnectionUtils.getConnection() ;</span><br><span class="line">        Channel channel &#x3D; connection.createChannel();</span><br><span class="line">        &#x2F;&#x2F; å£°æ˜é˜Ÿåˆ—</span><br><span class="line">        channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.FANOUT);&#x2F;&#x2F;åˆ†å‘ç±»å‹fanout</span><br><span class="line">        String msg &#x3D; &quot;hello world ps&quot;;</span><br><span class="line">        &#x2F;&#x2F; å‘é€ä¿¡æ¯</span><br><span class="line">        channel.basicPublish(EXCHANGE_NAME,&quot;&quot;,null,msg.getBytes());</span><br><span class="line">        System.out.println(&quot;send success&quot;);</span><br><span class="line">        &#x2F;&#x2F; å…³é—­æµ</span><br><span class="line">        channel.close();</span><br><span class="line">        connection.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ¶ˆè´¹è€…"><a href="#æ¶ˆè´¹è€…" class="headerlink" title="æ¶ˆè´¹è€…"></a>æ¶ˆè´¹è€…</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">public class Rece1 &#123;</span><br><span class="line">    private final static String QUEUE_NAME &#x3D; &quot;test_queu_email&quot;;</span><br><span class="line">    private final static String EXCHANGE_NAME &#x3D; &quot;test_exchange_fanout&quot;;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws IOException, TimeoutException &#123;</span><br><span class="line">        Connection connection &#x3D; ConnectionUtils.getConnection();</span><br><span class="line">        Channel channel &#x3D; connection.createChannel();</span><br><span class="line">        &#x2F;&#x2F; ç»‘å®šé˜Ÿåˆ—</span><br><span class="line">        channel.queueDeclare(QUEUE_NAME, false, false, false, null);</span><br><span class="line">        &#x2F;&#x2F; ç»‘å®šé˜Ÿåˆ—åˆ°äº¤æ¢æœºä¸Š</span><br><span class="line">        channel.queueBind(QUEUE_NAME, EXCHANGE_NAME, &quot;&quot;);</span><br><span class="line">        &#x2F;&#x2F;qos&#x3D;1</span><br><span class="line">        channel.basicQos(1);</span><br><span class="line">        DefaultConsumer consumer &#x3D; new DefaultConsumer(channel) &#123;</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException &#123;</span><br><span class="line">                System.out.println(&quot;send email &quot; + new String(body, Charset.defaultCharset()));</span><br><span class="line">                channel.basicAck(envelope.getDeliveryTag(), false);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        boolean autoAck &#x3D; false;</span><br><span class="line">        channel.basicConsume(QUEUE_NAME, autoAck, consumer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public class Rece2 &#123;</span><br><span class="line">    private final static String QUEUE_NAME &#x3D; &quot;test_queu_msg&quot;;</span><br><span class="line">    private final static String EXCHANGE_NAME &#x3D; &quot;test_exchange_fanout&quot;;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws IOException, TimeoutException &#123;</span><br><span class="line">        Connection connection &#x3D; ConnectionUtils.getConnection();</span><br><span class="line">        Channel channel &#x3D; connection.createChannel();</span><br><span class="line">        &#x2F;&#x2F; ç»‘å®šé˜Ÿåˆ—</span><br><span class="line">        channel.queueDeclare(QUEUE_NAME, false, false, false, null);</span><br><span class="line">        &#x2F;&#x2F; ç»‘å®šé˜Ÿåˆ—åˆ°äº¤æ¢æœºä¸Š</span><br><span class="line">        channel.queueBind(QUEUE_NAME, EXCHANGE_NAME, &quot;&quot;);</span><br><span class="line">        &#x2F;&#x2F;qos&#x3D;1</span><br><span class="line">        channel.basicQos(1);</span><br><span class="line">        DefaultConsumer consumer &#x3D; new DefaultConsumer(channel) &#123;</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException &#123;</span><br><span class="line">                System.out.println(&quot;send msg &quot; + new String(body, Charset.defaultCharset()));</span><br><span class="line">                channel.basicAck(envelope.getDeliveryTag(), false);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        boolean autoAck &#x3D; false;</span><br><span class="line">        channel.basicConsume(QUEUE_NAME, autoAck, consumer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å®˜æ–¹æ¨èçš„queue-name"><a href="#å®˜æ–¹æ¨èçš„queue-name" class="headerlink" title="å®˜æ–¹æ¨èçš„queue_name"></a>å®˜æ–¹æ¨èçš„queue_name</h4><p>å®˜æ–¹å¸Œæœ›èƒ½å¤Ÿå®ç°ï¼Œç”Ÿæˆå”¯ä¸€åç§°queue_name,å¹¶ä¸”ä¸€æ—¦æ–­å¼€ç”Ÿäº§è€…è¿æ¥ï¼Œé˜Ÿåˆ—è‡ªåŠ¨åˆ é™¤ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String queueName &#x3D; channel.queueDeclare().getQueue();</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> rabbitmq </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RabbitMQ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å·¥ä½œé˜Ÿåˆ—</title>
      <link href="/2020/02/20/%E5%B7%A5%E4%BD%9C%E9%98%9F%E5%88%97/"/>
      <url>/2020/02/20/%E5%B7%A5%E4%BD%9C%E9%98%9F%E5%88%97/</url>
      
        <content type="html"><![CDATA[<h3 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><p>RabbitMQæ˜¯æ¶ˆæ¯ä»£ç†ã€‚å®ƒæ¥æ”¶ä¿¡æ¯å’Œè½¬å‘ä¿¡æ¯ã€‚ä½ å¯ä»¥æŠŠä»–è€ƒè™‘æˆä¸€ä¸ªé‚®å±€ã€‚å½“ä½ è®²é‚®å¯„çš„ä¿¡æ”¾åœ¨é‚®å±€æ—¶ï¼Œä½ å¯ä»¥ç¡®å®šé‚®å·®å…ˆç”Ÿæˆ–è€…å¥³å£«ä¼šæŠŠé‚®ä»¶æœ€ç»ˆé€åˆ°ä½ çš„æ”¶ä»¶äººæ‰‹ä¸­ã€‚å½“ç„¶é‚®å±€å’ŒRabbitMQæœ€å¤§çš„åŒºåˆ«ï¼ŒRabbitMqä¸æ¥å—çº¸å¼ ï¼Œå®ƒåªæ¥æ”¶ï¼Œå­˜å‚¨ï¼Œè½¬å‘äºŒè¿›åˆ¶çš„æ•°æ®æ¶ˆæ¯å¿«ã€‚</p><p>ä¸‹é¢è®²ä¸€äº›RabbitMQä¸­çš„æœ¯è¯­ï¼š</p><ul><li><p>Producer</p><p>ç”Ÿæˆåªä¸è¿‡æ„å‘³ç€å‘é€ä¿¡æ¯ã€‚å‘é€ä¿¡æ¯çš„ç¨‹åºæ˜¯ç”Ÿäº§è€…</p></li><li><p>Queue</p><p>é˜Ÿåˆ—æ˜¯é©»ç•™åœ¨RabbitMQå†…çš„é‚®ç®±çš„åç§°ã€‚å°½ç®¡æ¶ˆæ¯flow RabbitMQå’Œä½ çš„ç¨‹åºï¼Œä½†æ˜¯ä»–ä»¬åªèƒ½å­˜å‚¨åœ¨é˜Ÿåˆ—ä¸­ã€‚ä¸€ä¸ªé˜Ÿåˆ—åªå—ä¸»æœºçš„å†…å­˜å’Œç£ç›˜é™åˆ¶ï¼Œå®ƒçš„æœ¬è´¨æ˜¯ä¸€ä¸ªå¤§çš„æ¶ˆæ¯ç¼“å†²åŒºã€‚è®¸å¤šæ¶ˆè´¹è€…å¯ä»¥å°†æ¶ˆæ¯å‘é€åˆ°ä¸€ä¸ªé˜Ÿåˆ—ï¼Œè®¸å¤šæ¶ˆè´¹è€…å¯ä»¥å°è¯•ä»ä¸€ä¸ªé˜Ÿåˆ—æ¥æ”¶æ•°æ®ï¼Œè¿™å°±æˆ‘ä»¬è¡¨ç¤ºé˜Ÿåˆ—çš„æ–¹å¼ã€‚</p></li><li><p>Consumer</p><p>æ¶ˆè´¹å’Œæ¥æ”¶æœ‰ç›¸åŒçš„æ„ä¹‰ã€‚æ¶ˆè´¹è€…æ˜¯ä¸€ä¸ªä¸»è¦æ¥æ”¶æ¶ˆæ¯çš„ç¨‹åº</p></li></ul><p>æ³¨æ„ï¼šç”Ÿäº§è€…ã€æ¶ˆè´¹è€…å’Œä»£ç†ä¸å¿…éƒ½åœ¨åŒä¸€ä¸»æœºä¸Šï¼›å®é™…ä¸Šï¼Œåœ¨å¤§å¤šæ•°åº”ç”¨ç¨‹åºä¸­ï¼Œå®ƒä»¬å¹¶æ²¡æœ‰è¿™æ ·åšã€‚åº”ç”¨ç¨‹åºæ—¢å¯ä»¥æ˜¯ç”Ÿæˆè€…ä¹Ÿå¯ä»¥æ˜¯æ¶ˆè´¹è€…ã€‚</p><h3 id="ç®€å•é˜Ÿåˆ—"><a href="#ç®€å•é˜Ÿåˆ—" class="headerlink" title="ç®€å•é˜Ÿåˆ—"></a>ç®€å•é˜Ÿåˆ—</h3><p>ç®€å•é˜Ÿåˆ—ï¼Œå°±æ˜¯å‘é€å•ä¸ªæ¶ˆæ¯çš„æ¶ˆè´¹è€…å’Œæ¥æ”¶ä¿¡æ¯å¹¶å°†å…¶æ‰“å°å‡ºæ¥çš„ä½¿ç”¨è€…ï¼ˆæ¶ˆè´¹è€…ï¼‰ï¼Œä¸å¤šå™è¿°ã€‚</p><h3 id="å·¥ä½œé˜Ÿåˆ—"><a href="#å·¥ä½œé˜Ÿåˆ—" class="headerlink" title="å·¥ä½œé˜Ÿåˆ—"></a>å·¥ä½œé˜Ÿåˆ—</h3><p>å·¥ä½œé˜Ÿåˆ—ä¸»è¦æ˜¯é¿å…çŸ­æ—¶é—´å†…æ‰§è¡Œå¯†é›†ä»»åŠ¡ï¼Œå¹¶ä¸”å¿…é¡»ç­‰å¾…å®ƒå®Œæˆã€‚æˆ‘ä»¬å°†ä»»åŠ¡æ”¾åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œå¯åŠ¨å¤šä¸ªæ¶ˆè´¹è€…ï¼Œä»»åŠ¡åœ¨ä»–ä»¬ä¸­æ˜¯å…±äº«çš„ã€‚</p><p>è®¾è®¡åˆ°å·¥ä½œé˜Ÿåˆ—ï¼Œå½“ç„¶ä¼šæœ‰ä¸åŒæ–¹å¼çš„å·¥ä½œé˜Ÿåˆ—</p><h4 id="ack"><a href="#ack" class="headerlink" title="ack"></a>ack</h4><p>å…³äº<code>ack</code>è¿™è¾¹å¤šè®²ä¸€ç‚¹ï¼Œ<code>message acknowledgment</code>æ˜¯æ¶ˆæ¯ç¡®è®¤ï¼Œè®¾ç½®<code>autoack=true</code>ä¹‹åï¼Œconsumerè¿”å›ä¸€ä¸ªackï¼ˆnowledgementï¼‰,å‘Šè¯‰<code>rabbitMQ</code>å·²ç»æ¥å—ä¿¡æ¯ï¼Œå¤„ç†äº†ç‰¹å®šçš„æ¶ˆæ¯ï¼Œ<code>RabbitMQ</code>å¯ä»¥è‡ªç”±åœ°åˆ é™¤å®ƒã€‚</p><h4 id="è½®è¯¢é˜Ÿåˆ—ï¼ˆRound-robin-dispatchingï¼‰"><a href="#è½®è¯¢é˜Ÿåˆ—ï¼ˆRound-robin-dispatchingï¼‰" class="headerlink" title="è½®è¯¢é˜Ÿåˆ—ï¼ˆRound-robin dispatchingï¼‰"></a>è½®è¯¢é˜Ÿåˆ—ï¼ˆRound-robin dispatchingï¼‰</h4><p>å°†<code>autoAck</code>è®¾ç½®ä¸º<code>true</code>,é»˜è®¤æƒ…å†µä¸‹ï¼ŒRabbitMQä¼šå‘é€æ¯æ¡ä¿¡æ¯ç»™å¦ä¸€ä¸ªæ¶ˆè´¹è€…ã€‚æ¯ä¸ªæ¶ˆè´¹è€…éƒ½ä¼šè·å–ç›¸åŒæ•°é‡çš„ã€‚å¹¶ä¸”æ˜¯é—´éš”å½¢å¼çš„ã€‚å¦‚æœ‰c1,c2æ¶ˆè´¹è€…ï¼Œ10æ¡æ¶ˆæ¯ï¼Œc1æ˜¯0,2,4,6,8ï¼Œc2æ˜¯1,3,5,7,9ã€‚å½“ç„¶ï¼Œåœ¨æˆ‘æ‰“æ–­ç‚¹æ—¶ï¼Œå‘ç°å¯¹åº”çš„æ•°æ®ä¼šéƒ½ä¸€æ¬¡æ€§å‘é€åˆ°c1ï¼Œå’Œc2ï¼Œc1å’Œc2å¤„ç†ä¿¡æ¯æ—¶ï¼Œå¹¶ä¸å½±å“å½¼æ­¤ã€‚</p><h4 id="å…¬å¹³é˜Ÿåˆ—"><a href="#å…¬å¹³é˜Ÿåˆ—" class="headerlink" title="å…¬å¹³é˜Ÿåˆ—"></a>å…¬å¹³é˜Ÿåˆ—</h4><p>åœ¨<code>RabbitMQ</code>åˆ†å‘ä¿¡æ¯çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šå‘ç°ï¼Œä¸€ä¸ªconsumerå¾ˆå¿™ï¼Œå¦ä¸€ä¸ªä¸€ç‚¹ä¹Ÿä¸å¿™ã€‚å› ä¸º<code>RabbitMQ</code>å¯¹æ­¤ä¸€æ— æ‰€çŸ¥ï¼Œåªæ˜¯å°†ç¬¬Næ¡ä¿¡æ¯ï¼Œå‘é€ç»™ç¬¬Nconsumer.</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªï¼Œæˆ‘ä»¬å°†basicQosæ–¹æ³•å’ŒprefetechCount=1è®¾ç½®ä¸€èµ·ç”¨ã€‚æ¢å¥è¯è¯´ï¼Œåœ¨å¤„ç†å¹¶ç¡®è®¤ä¸Šä¸€æ¡ä¿¡æ¯ä¹‹å‰ï¼Œä¸è¦å°†æ–°ä¿¡æ¯å‘é€ç»™å·¥äººã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> prefetchCount = <span class="number">1</span>;</span><br><span class="line">channel.basicQos(prefetchCount);</span><br></pre></td></tr></table></figure><p>å¹¶ä¸”ï¼Œæˆ‘ä»¬éœ€è¦å°†autoAckè®¾ä¸ºfalseå’Œå¤„ç†å®Œä¸€æ¡æ¶ˆæ¯åå‘é€ackç»™<code>RabbitMQ</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">DefaultConsumer defaultConsumer = <span class="keyword">new</span> DefaultConsumer(channel)&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, <span class="keyword">byte</span>[] body)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">                String msg = <span class="keyword">new</span> String(body, <span class="string">"utf-8"</span>);</span><br><span class="line">                System.out.println(<span class="string">"receive1 : "</span> + msg);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">                    channel.basicAck(envelope.getDeliveryTag(),<span class="keyword">false</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">boolean</span> autoack = <span class="keyword">false</span>;</span><br><span class="line">        channel.basicConsume(QUEUE_NAME,autoack,defaultConsumer);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> rabbitmq </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RabbitMQ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>0109 ä»€ä¹ˆæ˜¯å¾®æœåŠ¡</title>
      <link href="/2020/01/10/0109-%E4%BB%80%E4%B9%88%E6%98%AF%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
      <url>/2020/01/10/0109-%E4%BB%80%E4%B9%88%E6%98%AF%E5%BE%AE%E6%9C%8D%E5%8A%A1/</url>
      
        <content type="html"><![CDATA[<p>å¾®æœåŠ¡æ¶æ„é£æ ¼ï¼Œå°±åƒæ˜¯æŠŠä¸€ä¸ªå•ç‹¬çš„åº”ç”¨ç¨‹åºå¼€å‘ä¸ºä¸€å¥—å°æœåŠ¡ï¼Œæ¯ä¸ªå°æœåŠ¡è¿è¡Œåœ¨è‡ªå·±çš„è¿›ç¨‹ä¸­ï¼Œå¹¶ä½¿ç”¨è½»é‡çº§æœºåˆ¶é€šä¿¡ï¼Œé€šå¸¸æ˜¯HTTP API.è¿™äº›æœåŠ¡å›´ç»•ä¸šåŠ¡èƒ½åŠ›æ¥æ„å»ºï¼Œå¹¶é€šè¿‡å®Œå…¨è‡ªåŠ¨åŒ–éƒ¨ç½²æœºåˆ¶æ¥ç‹¬ç«‹éƒ¨ç½²ã€‚è¿™äº›æœåŠ¡ä½¿ç”¨ä¸åŒçš„ç¼–ç¨‹è¯­è¨€ä¹¦å†™ï¼Œä»¥åŠä¸åŒæ•°æ®å­˜å‚¨æŠ€æœ¯ï¼Œå¹¶ä¿æŒæœ€ä½é™åº¦çš„é›†ä¸­å¼ç®¡ç†ã€‚</p><a id="more"></a><h4 id="å¾®æœåŠ¡ä¸ºä»€ä¹ˆè¦ä½¿ç”¨Spring-Cloud"><a href="#å¾®æœåŠ¡ä¸ºä»€ä¹ˆè¦ä½¿ç”¨Spring-Cloud" class="headerlink" title="å¾®æœåŠ¡ä¸ºä»€ä¹ˆè¦ä½¿ç”¨Spring Cloud"></a>å¾®æœåŠ¡ä¸ºä»€ä¹ˆè¦ä½¿ç”¨Spring Cloud</h4><h4 id="ä»ä½¿ç”¨nginxè¯´èµ·"><a href="#ä»ä½¿ç”¨nginxè¯´èµ·" class="headerlink" title="ä»ä½¿ç”¨nginxè¯´èµ·"></a>ä»ä½¿ç”¨nginxè¯´èµ·</h4><p>æœ€åˆçš„æœåŠ¡åŒ–è§£å†³æ–¹æ¡ˆæ˜¯ç»™æä¾›ç›¸åŒæœåŠ¡æä¾›ä¸€ä¸ªç»Ÿä¸€çš„åŸŸåï¼Œç„¶åæœåŠ¡è°ƒç”¨è€…å‘è¿™ä¸ªåŸŸåå‘é€HTTPè¯·æ±‚ï¼Œç”±Nginxè´Ÿè´£è¯·æ±‚çš„åˆ†å‘å’Œè·³è½¬</p><p><img src="https://s2.ax1x.com/2020/01/10/lhuml9.jpg" alt="nginxç¤ºæ„å›¾lhuml9.jpg"></p><p>ä½†æ˜¯è¿™æ ·æœ‰ä¸å°‘ç¼ºç‚¹:</p><ul><li><p>Nginxä½œä¸ºä¸­é—´å±‚ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­è€¦åˆäº†æœåŠ¡è°ƒç”¨çš„é€»è¾‘ï¼Œè¿™å‰Šå¼±äº†å¾®æœåŠ¡çš„å®Œæ•´æ€§ï¼Œä¹Ÿä½¿å¾—Nginxåœ¨ä¸€å®šç¨‹åº¦ä¸Šå˜æˆäº†ä¸€ä¸ªé‡é‡çº§çš„ESB.</p></li><li><p>æœåŠ¡çš„ä¿¡æ¯åˆ†æ•£åœ¨å„ä¸ªç³»ç»Ÿï¼Œæ— æ³•ç»Ÿä¸€ç®¡ç†å’Œç»´æŠ¤ã€‚æ¯ä¸€æ¬¡çš„æœåŠ¡è°ƒç”¨éƒ½æ˜¯ä¸€æ¬¡å°è¯•ï¼ŒæœåŠ¡æ¶ˆè´¹è€…å¹¶ä¸çŸ¥é“æœ‰å“ªäº›å®ä¾‹åœ¨ç»™ä»–ä»¬æä¾›æœåŠ¡ã€‚è¿™ä¸ç¬¦åˆDevOpsçš„ç†å¿µã€‚</p></li><li><p>æ— æ³•ç›´è§‚çš„çœ‹åˆ°æœåŠ¡æä¾›è€…å’ŒæœåŠ¡æ¶ˆè´¹è€…å½“å‰çš„è¿è¡Œå’Œé€šä¿¡é¢‘ç‡ã€‚è¿™ä¹Ÿä¸ç¬¦åˆDevOpsçš„ç†å¿µã€‚</p></li><li><p>æ¶ˆè´¹è€…çš„å¤±è´¥é‡å‘ï¼Œè´Ÿè½½å‡è¡¡ç­‰éƒ½æ²¡æœ‰ç»Ÿä¸€ç­–ç•¥ï¼Œè¿™åŠ å¤§äº†å¼€å‘æ¯ä¸ªæœåŠ¡çš„éš¾åº¦ï¼Œä¸åˆ©äºå¿«ç†Ÿæ¼”åŒ–ã€‚</p></li></ul><p>ä¸ºäº†è§£å†³ä¸Šé¢çš„é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªç°æˆçš„ä¸­å¿ƒåŒ–ç»„ä»¶å¯¹æœåŠ¡è¿›è¡Œæ•´åˆï¼Œå°†æ¯ä¸ªæœåŠ¡çš„ä¿¡æ¯æ•´åˆï¼ŒåŒ…æ‹¬æœåŠ¡çš„ç»„ä»¶åç§°ã€åœ°å€ã€æ•°é‡ç­‰ã€‚æœåŠ¡çš„è°ƒç”¨æ–¹åœ¨è¯·æ±‚æ¯é¡¹æœåŠ¡æ—¶é¦–å…ˆé€šè¿‡ä¸­å¿ƒç»„ä»¶è·å–æä¾›è¿™é¡¹æœåŠ¡çš„å®ä¾‹çš„ä¿¡æ¯ï¼ˆIPã€ç«¯å£ç­‰ï¼‰ï¼Œå†é€šè¿‡é»˜è®¤æˆ–è‡ªå®šä¹‰çš„ç­–ç•¥é€‰æ‹©è¯¥æœåŠ¡çš„æŸä¸€æä¾›è€…ç›´æ¥è¿›è¡Œè®¿é—®ï¼Œæ‰€ä»¥æˆ‘ä»¬å¼•å…¥äº†Dubboã€‚</p><h4 id="åŸºäºDubboå®ç°å¾®æœåŠ¡"><a href="#åŸºäºDubboå®ç°å¾®æœåŠ¡" class="headerlink" title="åŸºäºDubboå®ç°å¾®æœåŠ¡"></a>åŸºäºDubboå®ç°å¾®æœåŠ¡</h4><p>Dubboæ˜¯é˜¿é‡Œå¼€æºçš„ä¸€ä¸ªSOAæœåŠ¡æ²»ç†è§£å†³æ–¹æ¡ˆï¼Œæ–‡æ¡£ä¸°å¯Œï¼Œåœ¨å›½å†…çš„ä½¿ç”¨åº¦éå¸¸é«˜ã€‚</p><p><img src="https://s2.ax1x.com/2020/01/10/lhKc4O.jpg" alt="DubbolhKc4O.jpg"></p><p>ä½¿ç”¨Dubboæ„å»ºçš„å¾®æœåŠ¡ï¼Œå·²ç»æ¯”è¾ƒå¥½åœ°è§£å†³ä¸Šé¢æåˆ°çš„é—®é¢˜ï¼š</p><ul><li>è°ƒç”¨ä¸­é—´å±‚å˜æˆäº†å¯é€‰ç»„ä»¶ï¼Œæ¶ˆè´¹è€…å¯ä»¥ç›´æ¥è®¿é—®æœåŠ¡æä¾›è€…</li><li>æœåŠ¡ä¿¡æ¯è¢«é›†ä¸­åˆ°Registryä¸­ï¼Œå½¢æˆäº†æœåŠ¡æ²»ç†çš„ä¸­å¿ƒç»„ä»¶ã€‚</li><li>é€šè¿‡Monitorç›‘æ§ç³»ç»Ÿï¼Œå¯ä»¥ç›´è§‚åœ°å±•ç¤ºæœåŠ¡è°ƒç”¨çš„ç»Ÿè®¡ä¿¡æ¯ã€‚</li><li>Consumerå¯ä»¥è¿›è¡Œè´Ÿè½½å‡è¡¡ã€æœåŠ¡é™çº§çš„é€‰æ‹©</li></ul><p>ä½†æ˜¯å¯¹äºå¾®æœåŠ¡æ¶æ„è€Œè¨€ï¼ŒDubboä¹Ÿå¹¶ä¸æ˜¯åå…¨åç¾çš„ï¼š</p><ul><li>Registryä¸¥é‡ä¾èµ–ç¬¬ä¸‰æ–¹ç»„ä»¶ï¼ˆZookeeperæˆ–è€…redisï¼‰ï¼Œå½“è¿™äº›ç»„ä»¶å‡ºç°é—®é¢˜ï¼ŒæœåŠ¡è°ƒç”¨å¾ˆå¿«å°±ä¼šä¸­æ–­ï¼ˆå½“ç„¶ï¼Œæˆ‘ä¹‹å‰ä¹Ÿè¯•è¿‡ä¸­æ–­æ—¶ï¼Œä¼šæœ‰ç¼“å­˜è¿˜æ˜¯å¯ä»¥è°ƒç”¨ï¼‰</li><li>Dubboåªæ”¯æŒRPCè°ƒç”¨ã€‚ä½¿å¾—æœåŠ¡æä¾›æ–¹ä¸è°ƒç”¨æ–¹åœ¨ä»£ç ä¸Šäº§ç”Ÿäº†å¼ºä¾èµ–ï¼ŒæœåŠ¡æä¾›è€…éœ€è¦ä¸æ–­å°†åŒ…å«å…¬å…±ä»£ç çš„jaråŒ…æ‰“åŒ…å‡ºæ¥ä¾›æ¶ˆè´¹è€…ä½¿ç”¨ã€‚ä¸€æ—¦æ‰“åŒ…å‡ºç°é—®é¢˜ï¼Œå°±ä¼šå¯¼è‡´æœåŠ¡è°ƒç”¨å‡ºç°é—®é¢˜ï¼ˆå…¬å…±ä»£ç æ˜¯æŒ‡ åŒ…å«å…¬å…±é…ç½®ï¼šDO(å’Œæ•°æ®åº“åŒæ­¥ï¼Œç”¨äºæŒä¹…åŒ–å¯¹è±¡)ï¼ŒVO(ä¼ è¾“æ•°æ®)ï¼Œå·¥å…·åŒ…ï¼Œæ¥å£ç­‰ï¼‰</li></ul><h4 id="æ–°çš„é€‰æ‹©â€“Spring-cloud"><a href="#æ–°çš„é€‰æ‹©â€“Spring-cloud" class="headerlink" title="æ–°çš„é€‰æ‹©â€“Spring cloud"></a>æ–°çš„é€‰æ‹©â€“Spring cloud</h4><p>dubboå’Œspring cloud åŒºåˆ«</p><table><thead><tr><th align="left">Dubbo</th><th align="left">Spring Cloud</th><th></th></tr></thead><tbody><tr><td align="left">æœåŠ¡æ³¨å†Œä¸­å¿ƒ</td><td align="left">Zookeeper</td><td>Spring Cloud Netflix Eureka</td></tr><tr><td align="left">æœåŠ¡è°ƒç”¨æ–¹å¼</td><td align="left">RPC</td><td>REST API</td></tr><tr><td align="left">æœåŠ¡ç›‘æ§</td><td align="left">Dubbo-monitor</td><td>Spring Boot Admin</td></tr><tr><td align="left">æ–­è·¯å™¨</td><td align="left">ä¸å®Œå–„</td><td>Spring Cloud Netflix Hystrix</td></tr><tr><td align="left">æœåŠ¡ç½‘å…³</td><td align="left">æ— </td><td>Spring Cloud Netflix Zuul</td></tr><tr><td align="left">åˆ†å¸ƒå¼é…ç½®</td><td align="left">æ— </td><td>Spring Cloud Config</td></tr><tr><td align="left">æœåŠ¡è·Ÿè¸ª</td><td align="left">æ— </td><td>Spring Cloud Sleuth</td></tr><tr><td align="left">æ¶ˆæ¯æ€»çº¿</td><td align="left">æ— </td><td>Spring Cloud Bus</td></tr><tr><td align="left">æ•°æ®æµ</td><td align="left">æ— </td><td>Spring Cloud Stream</td></tr><tr><td align="left">æ‰¹é‡ä»»åŠ¡</td><td align="left">æ— </td><td>Spring Cloud Task</td></tr></tbody></table><blockquote><p>æœåŠ¡è°ƒç”¨æ–¹å¼ï¼šSpring Cloud æŠ›å¼ƒäº†Dubboçš„RPCé€šä¿¡ï¼Œé‡‡ç”¨çš„æ˜¯åŸºäºHTTPçš„RESTæ–¹å¼ã€‚ä¸¥æ ¼æ¥è¯´ï¼Œè¿™ä¸¤ç§å„æœ‰ä¼˜åŠ£ã€‚è™½ç„¶ä»ä¸€å®šç¨‹åº¦ä¸Šæ¥è¯´ï¼Œåè€…ç‰ºç‰²äº†æœåŠ¡è°ƒç”¨çš„æ€§èƒ½ï¼Œä½†ä¹Ÿé¿å…äº†ä¸Šé¢æåˆ°çš„åŸç”ŸRPCå¸¦æ¥çš„é—®é¢˜ã€‚è€Œä¸”RESTç›¸æ¯”RPCæ›´ä¸ºçµæ´»ï¼ŒæœåŠ¡æä¾›æ–¹å’Œè°ƒç”¨çš„ä¾èµ–åªä¾èµ–ä¸€çº¸å¥‘çº¦ï¼Œä¸å­˜åœ¨ä»£ç çº§åˆ«çš„å¼ºä¾èµ–ï¼Œè¿™åœ¨å¼ºè°ƒå¿«é€Ÿæ¼”åŒ–çš„å¾®æœåŠ¡ç¯å¢ƒä¸‹ï¼Œæ˜¾å¾—æ›´åŠ åˆé€‚ã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Spring cloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring cloud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexoå¤§è‡´æ•™ç¨‹</title>
      <link href="/2020/01/10/hexo/"/>
      <url>/2020/01/10/hexo/</url>
      
        <content type="html"><![CDATA[<h3 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h3><ul><li><p>å®‰è£…npm,å¹¶é…ç½®æ·˜å®é•œåƒ</p></li><li><p>ä¸‹è½½hexo</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install -g hexo-cli</span><br></pre></td></tr></table></figure><ul><li>ä¿®æ”¹theme</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æ•™ç¨‹ https:&#x2F;&#x2F;xaoxuu.com&#x2F;wiki&#x2F;material-x&#x2F;index.html</span><br><span class="line">å®Œæˆåï¼š ä¿®æ”¹_config.ymlä¸­çš„themeé…ç½®</span><br></pre></td></tr></table></figure><ul><li>éƒ¨ç½²åˆ°<code>ç”¨æˆ·å.github.io</code></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">å¤§è‡´æ•™ç¨‹ï¼š https:&#x2F;&#x2F;www.bilibili.com&#x2F;read&#x2F;cv2204874&#x2F;</span><br><span class="line">æ–°å»ºmdï¼š hexo new æ–‡ä»¶å</span><br><span class="line">ä¼šåœ¨&#x2F;source&#x2F;_posts&#x2F;æ–‡ä»¶å.md</span><br><span class="line"></span><br><span class="line">hexo d -g</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2020/01/10/hello-world/"/>
      <url>/2020/01/10/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
