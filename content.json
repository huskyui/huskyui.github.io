{"meta":{"title":"huskyui","subtitle":"","description":"","author":"huskyui","url":"http://yoursite.com","root":"/"},"pages":[],"posts":[{"title":"leetcode-22æ‹¬å·ç”Ÿæˆ","slug":"leetcode-22æ‹¬å·ç”Ÿæˆ","date":"2020-11-14T09:00:33.378Z","updated":"2020-11-14T08:57:50.429Z","comments":true,"path":"2020/11/14/leetcode-22æ‹¬å·ç”Ÿæˆ/","link":"","permalink":"http://yoursite.com/2020/11/14/leetcode-22%E6%8B%AC%E5%8F%B7%E7%94%9F%E6%88%90/","excerpt":"","text":"//æ•°å­— n ä»£è¡¨ç”Ÿæˆæ‹¬å·çš„å¯¹æ•°ï¼Œè¯·ä½ è®¾è®¡ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºèƒ½å¤Ÿç”Ÿæˆæ‰€æœ‰å¯èƒ½çš„å¹¶ä¸” æœ‰æ•ˆçš„ æ‹¬å·ç»„åˆã€‚ // // // // ç¤ºä¾‹ï¼š // // è¾“å…¥ï¼šn = 3 //è¾“å‡ºï¼š[ // &quot;((()))&quot;, // &quot;(()())&quot;, // &quot;(())()&quot;, // &quot;()(())&quot;, // &quot;()()()&quot; // ] // // Related Topics å­—ç¬¦ä¸² å›æº¯ç®—æ³• // ğŸ‘ 1356 ğŸ‘ 0 import java.util.ArrayList; import java.util.List; //leetcode submit region begin(Prohibit modification and deletion) class Solution { // å…¨å±€å˜é‡ private List&lt;String&gt; list = new ArrayList&lt;&gt;(); public List&lt;String&gt; generateParenthesis(int n) { // ç”Ÿæˆé¢˜ç›®å½“ç„¶ä¸èƒ½æ˜¯forå¾ªç¯ç”Ÿæˆ dfs(0, 0, n, &quot;&quot;); return list; } public void dfs(int left, int right, int n, String path) { // æ’é™¤æ‰ æ‹¬å·æ•°é‡å¤ªå¤šçš„é€‰æ‰‹ if (left &gt; n || right &gt; n) { return; } // å¦‚æœå³è¾¹å¤§äºå·¦è¾¹ï¼Œé‚£ä¹ˆå°±åˆ é™¤å½“å‰é€‰æ‰‹ if (right&gt;left) { return; } // final champion if (left + right == 2 * n) { list.add(path); return; } dfs(left + 1, right, n, path + &quot;(&quot;); dfs(left, right + 1, n, path + &quot;)&quot;); } } //leetcode submit region end(Prohibit modification and deletion)","categories":[],"tags":[]},{"title":"zookeeper-2","slug":"zookeeper-2","date":"2020-04-24T10:13:11.000Z","updated":"2020-04-28T10:15:53.050Z","comments":true,"path":"2020/04/24/zookeeper-2/","link":"","permalink":"http://yoursite.com/2020/04/24/zookeeper-2/","excerpt":"","text":"javaè¿æ¥pom 123456789101112131415161718192021222324252627282930 &lt;dependency&gt; &lt;groupId&gt;junit&lt;/groupId&gt; &lt;artifactId&gt;junit&lt;/artifactId&gt; &lt;version&gt;4.11&lt;/version&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt;&lt;!-- åœ¨æäº¤åˆ°githubçš„æ—¶å€™ï¼Œæç¤ºè®©ä½¿ç”¨3.4.14ä»¥åçš„ç‰ˆæœ¬ --&gt;&lt;!-- &lt;version&gt;[3.4.14,)&lt;/version&gt; --&gt; &lt;!-- https://mvnrepository.com/artifact/org.apache.zookeeper/zookeeper --&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt; &lt;artifactId&gt;zookeeper&lt;/artifactId&gt; &lt;version&gt;3.4.14&lt;/version&gt; &lt;/dependency&gt; &lt;!-- https://mvnrepository.com/artifact/log4j/log4j --&gt; &lt;dependency&gt; &lt;groupId&gt;log4j&lt;/groupId&gt; &lt;artifactId&gt;log4j&lt;/artifactId&gt; &lt;version&gt;1.2.16&lt;/version&gt; &lt;/dependency&gt; &lt;!-- https://mvnrepository.com/artifact/org.slf4j/slf4j-api --&gt; &lt;dependency&gt; &lt;groupId&gt;org.slf4j&lt;/groupId&gt; &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt; &lt;version&gt;1.6.1&lt;/version&gt; &lt;/dependency&gt;","categories":[],"tags":[]},{"title":"zookeeper-1","slug":"zookeeper-1","date":"2020-04-20T09:16:27.000Z","updated":"2020-04-24T10:11:55.584Z","comments":true,"path":"2020/04/20/zookeeper-1/","link":"","permalink":"http://yoursite.com/2020/04/20/zookeeper-1/","excerpt":"","text":"ç®€ä»‹123456789101112131415161718192021222324252627282930313233343536373839404142434445464748ZooKeeper: A Distributed Coordination Service for Distributed ApplicationszooKeeper:ä¸€ä¸ªåˆ†å¸ƒå¼åº”ç”¨çš„åˆ†å¸ƒå¼åè°ƒæœåŠ¡ZooKeeper is a distributed, open-source coordination service for distributed applications. It exposes a simple set of primitives that distributed applications can build upon to implement higher level services for synchronization, configuration maintenance, and groups and naming. It is designed to be easy to program to, and uses a data model styled after the familiar directory tree structure of file systems. It runs in Java and has bindings for both Java and C.zooKeeperæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼åº”ç”¨çš„åˆ†å¸ƒå¼ï¼Œå¼€æºï¼Œåè°ƒæœåŠ¡ã€‚å®ƒæä¾›äº†ä¸€ç»„ç®€å•çš„åŸè¯­ï¼Œåˆ†å¸ƒå¼åº”ç”¨å¯ä»¥åœ¨è¿™äº›åŸè¯­åŸºç¡€ä¸Šå®ç°æ›´é«˜çº§çš„æœåŠ¡ï¼Œç”¨äºåŒæ­¥ï¼Œé…ç½®ç»´æŠ¤ï¼Œç»„åˆå‘½åã€‚å®ƒè¢«è®¾è®¡æ˜“äºä½¿ç”¨ï¼Œå¹¶ä½¿ç”¨äº†é£æ ¼å’Œæ–‡ä»¶ç³»ç»Ÿç›¸ä¼¼çš„æ•°æ®æ¨¡å‹ã€‚å®ƒåœ¨javaè¿è¡Œï¼Œå¹¶å…·æœ‰javaå’Œcç»‘å®šã€‚Coordination services are notoriously hard to get right. They are especially prone to errors such as race conditions and deadlock. The motivation behind ZooKeeper is to relieve distributed applications the responsibility of implementing coordination services from scratch.åè°ƒæœåŠ¡æ˜¯å‡ºäº†åçš„éš¾å†™ã€‚ä»–ä»¬ç‰¹åˆ«å®¹æ˜“å‡ºç°ç«äº‰æ¡ä»¶å’Œæ­»é”é”™è¯¯ã€‚zookeeperèƒŒåçš„åŠ¨æœºæ˜¯ä¸ºäº†å‡å°‘åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºä»å¤´å®ç°åè°ƒæœåŠ¡çš„è´£ä»»ã€‚Design GoalsZooKeeper is simple. ZooKeeper allows distributed processes to coordinate with each other through a shared hierarchical namespace which is organized similarly to a standard file system. The namespace consists of data registers - called znodes, in ZooKeeper parlance - and these are similar to files and directories. Unlike a typical file system, which is designed for storage, ZooKeeper data is kept in-memory, which means ZooKeeper can achieve high throughput and low latency numbers.zooKeeperæ˜¯ç®€å•çš„ã€‚zooKeeperå…è®¸åˆ†å¸ƒå¼è¿›ç¨‹é€šè¿‡å…±äº«çš„å±‚æ¬¡å‘½åç©ºé—´ç›¸äº’åè°ƒï¼Œè¯¥å‘½åç©ºé—´ç±»ä¼¼äºæ ‡å‡†æ–‡ä»¶ç³»ç»Ÿã€‚å‘½åç©ºé—´ç”±æ•°æ®å¯„å­˜å™¨æ³¨å†Œï¼Œç”¨zooKeeperçš„è¯è¯´å«znodesï¼Œç±»ä¼¼äºæ–‡ä»¶ç³»ç»Ÿä¸­çš„ç›®å½•å’Œæ–‡ä»¶ã€‚ä¸åƒå…¸å‹çš„æ–‡ä»¶ç³»ç»Ÿï¼Œzookeeperæ˜¯è®¾è®¡ç”¨äºä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œæ„å‘³ç€zooKeeperå¯ä»¥å®ç°é«˜ååé‡å’Œä½å»¶è¿Ÿç‡ã€‚The ZooKeeper implementation puts a premium on high performance, highly available, strictly ordered access. The performance aspects of ZooKeeper means it can be used in large, distributed systems. The reliability aspects keep it from being a single point of failure. The strict ordering means that sophisticated synchronization primitives can be implemented at the client.ZooKeeperå®æ–½å¯¹é«˜æ€§èƒ½ï¼Œé«˜å¯ç”¨æ€§ï¼Œä¸¥æ ¼æœ‰åºè®¿é—®åŠ ä»¥é‡è§†ã€‚ ZooKeeperçš„æ€§èƒ½æ–¹é¢æ„å‘³ç€å®ƒå¯ä»¥åœ¨å¤§å‹çš„åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ä½¿ç”¨ã€‚ å¯é æ€§æ–¹é¢ä½¿å®ƒä¸ä¼šæˆä¸ºå•ç‚¹æ•…éšœã€‚ ä¸¥æ ¼æ’åºæ„å‘³ç€å¯ä»¥åœ¨å®¢æˆ·ç«¯ä¸Šå®ç°å¤æ‚çš„åŒæ­¥åŸè¯­ã€‚ZooKeeper is replicated. Like the distributed processes it coordinates, ZooKeeper itself is intended to be replicated over a set of hosts called an ensemble.ZooKeeperæ˜¯å¤åˆ¶çš„ã€‚ä¸å®ƒæ‰€åè°ƒçš„åˆ†å¸ƒå¼è¿›ç¨‹ä¸€æ ·ï¼ŒZooKeeperæœ¬èº«ä¹Ÿæ‰“ç®—åœ¨ä¸€ç»„ç§°ä¸ºé›†åˆçš„ä¸»æœºä¸Šè¿›è¡Œå¤åˆ¶ã€‚The servers that make up the ZooKeeper service must all know about each other. They maintain an in-memory image of state, along with a transaction logs and snapshots in a persistent store. As long as a majority of the servers are available, the ZooKeeper service will be available.ç»„æˆZooKeeperæœåŠ¡çš„æœåŠ¡å™¨å¿…é¡»ç›¸äº’äº†è§£ã€‚å®ƒä»¬åœ¨å†…å­˜ä¸­ç»´æŠ¤çŠ¶æ€æ˜ åƒï¼Œä»¥åŠæŒä¹…å­˜å‚¨ä¸­çš„äº‹åŠ¡æ—¥å¿—å’Œå¿«ç…§ã€‚åªè¦å¤§å¤šæ•°æœåŠ¡å™¨å¯ç”¨ï¼ŒZooKeeperæœåŠ¡å°±å¯ç”¨ã€‚Clients connect to a single ZooKeeper server. The client maintains a TCP connection through which it sends requests, gets responses, gets watch events, and sends heart beats. If the TCP connection to the server breaks, the client will connect to a different server.å®¢æˆ·ç«¯è¿æ¥åˆ°å•ä¸ªZooKeeperæœåŠ¡å™¨ã€‚å®¢æˆ·ç«¯ç»´æŠ¤ä¸€ä¸ªTCPè¿æ¥ï¼Œé€šè¿‡å®ƒå‘é€è¯·æ±‚ã€è·å–å“åº”ã€è·å–ç›‘è§†äº‹ä»¶å’Œå‘é€å¿ƒè·³ã€‚å¦‚æœåˆ°æœåŠ¡å™¨çš„TCPè¿æ¥ä¸­æ–­ï¼Œå®¢æˆ·æœºå°†è¿æ¥åˆ°å¦ä¸€å°æœåŠ¡å™¨ã€‚ZooKeeper is ordered. ZooKeeper stamps each update with a number that reflects the order of all ZooKeeper transactions. Subsequent operations can use the order to implement higher-level abstractions, such as synchronization primitives.Zookeeperæ˜¯æœ‰åºçš„ã€‚ZooKeeperç”¨ä¸€ä¸ªæ•°å­—æ¥æ ‡è®°æ¯ä¸ªæ›´æ–°ï¼Œè¿™ä¸ªæ•°å­—åæ˜ äº†æ‰€æœ‰ZooKeeperäº‹åŠ¡çš„é¡ºåºã€‚åç»­æ“ä½œå¯ä»¥ä½¿ç”¨è¯¥é¡ºåºå®ç°æ›´é«˜çº§åˆ«çš„æŠ½è±¡ï¼Œæ¯”å¦‚åŒæ­¥åŸè¯­ã€‚ZooKeeper is fast. It is especially fast in &quot;read-dominant&quot; workloads. ZooKeeper applications run on thousands of machines, and it performs best where reads are more common than writes, at ratios of around 10:1.ZooKeeperå¾ˆå¿«ã€‚åœ¨â€œä»¥è¯»å–ä¸ºä¸»â€çš„å·¥ä½œè´Ÿè½½ä¸­ï¼Œå®ƒçš„é€Ÿåº¦ç‰¹åˆ«å¿«ã€‚ZooKeeperåº”ç”¨ç¨‹åºè¿è¡Œåœ¨æ•°åƒå°æœºå™¨ä¸Šï¼Œå½“è¯»æ“ä½œæ¯”å†™æ“ä½œæ›´å¸¸è§æ—¶ï¼Œå®ƒçš„æ€§èƒ½æœ€å¥½ï¼Œæ¯”ç‡çº¦ä¸º10:1ã€‚Data model and the hierarchical namespaceThe namespace provided by ZooKeeper is much like that of a standard file system. A name is a sequence of path elements separated by a slash (&#x2F;). Every node in ZooKeeper&#39;s namespace is identified by a path.æ•°æ®æ¨¡å‹å’Œåˆ†å±‚åç§°ç©ºé—´ZooKeeperæä¾›çš„åç§°ç©ºé—´ä¸æ ‡å‡†æ–‡ä»¶ç³»ç»Ÿçš„åç§°ç©ºé—´éå¸¸ç›¸ä¼¼ã€‚ åç§°æ˜¯ç”±æ–œæ ï¼ˆ&#x2F;ï¼‰åˆ†éš”çš„ä¸€ç³»åˆ—è·¯å¾„å…ƒç´ ã€‚ ZooKeeperå‘½åç©ºé—´ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½ç”±è·¯å¾„æ ‡è¯†ã€‚Nodes and ephemeral nodesUnlike standard file systems, each node in a ZooKeeper namespace can have data associated with it as well as children. It is like having a file-system that allows a file to also be a directory. (ZooKeeper was designed to store coordination data: status information, configuration, location information, etc., so the data stored at each node is usually small, in the byte to kilobyte range.) We use the term znode to make it clear that we are talking about ZooKeeper data nodes.Znodes maintain a stat structure that includes version numbers for data changes, ACL changes, and timestamps, to allow cache validations and coordinated updates. Each time a znode&#39;s data changes, the version number increases. For instance, whenever a client retrieves data it also receives the version of the data.The data stored at each znode in a namespace is read and written atomically. Reads get all the data bytes associated with a znode and a write replaces all the data. Each node has an Access Control List (ACL) that restricts who can do what.ZooKeeper also has the notion of ephemeral nodes. These znodes exists as long as the session that created the znode is active. When the session ends the znode is deleted.èŠ‚ç‚¹å’ŒçŸ­æš‚èŠ‚ç‚¹ä¸æ ‡å‡†æ–‡ä»¶ç³»ç»Ÿä¸åŒï¼ŒZooKeeperå‘½åç©ºé—´ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥å…·æœ‰ä¸å…¶å…³è”çš„æ•°æ®ä»¥åŠå­èŠ‚ç‚¹ã€‚ å°±åƒæ‹¥æœ‰ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿä¸€æ ·ï¼Œè¯¥æ–‡ä»¶ç³»ç»Ÿä¹Ÿå…è®¸æ–‡ä»¶æˆä¸ºç›®å½•ã€‚ ï¼ˆZooKeeperæ—¨åœ¨å­˜å‚¨åè°ƒæ•°æ®ï¼šçŠ¶æ€ä¿¡æ¯ï¼Œé…ç½®ï¼Œä½ç½®ä¿¡æ¯ç­‰ï¼Œå› æ­¤å­˜å‚¨åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„æ•°æ®é€šå¸¸å¾ˆå°ï¼Œåœ¨å­—èŠ‚åˆ°åƒå­—èŠ‚èŒƒå›´å†…ã€‚ï¼‰æˆ‘ä»¬ä½¿ç”¨æœ¯è¯­znodeæ¥æ˜ç¡®è¡¨ç¤º åœ¨è°ˆè®ºZooKeeperæ•°æ®èŠ‚ç‚¹ã€‚Znodesç»´æŠ¤ä¸€ä¸ªç»Ÿè®¡ä¿¡æ¯ç»“æ„ï¼Œå…¶ä¸­åŒ…æ‹¬ç”¨äºæ•°æ®æ›´æ”¹ï¼ŒACLæ›´æ”¹å’Œæ—¶é—´æˆ³çš„ç‰ˆæœ¬å·ï¼Œä»¥å…è®¸è¿›è¡Œç¼“å­˜éªŒè¯å’Œåè°ƒæ›´æ–°ã€‚ znodeçš„æ•°æ®æ¯æ¬¡æ›´æ”¹æ—¶ï¼Œç‰ˆæœ¬å·éƒ½ä¼šå¢åŠ ã€‚ ä¾‹å¦‚ï¼Œæ¯å½“å®¢æˆ·ç«¯æ£€ç´¢æ•°æ®æ—¶ï¼Œå®ƒä¹Ÿæ¥æ”¶æ•°æ®çš„ç‰ˆæœ¬ã€‚åŸå­åœ°è¯»å–å’Œå†™å…¥å­˜å‚¨åœ¨åç§°ç©ºé—´ä¸­æ¯ä¸ªznodeä¸Šçš„æ•°æ®ã€‚ è¯»å–å°†è·å–ä¸znodeå…³è”çš„æ‰€æœ‰æ•°æ®å­—èŠ‚ï¼Œè€Œå†™å…¥å°†æ›¿æ¢æ‰€æœ‰æ•°æ®ã€‚ æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªè®¿é—®æ§åˆ¶åˆ—è¡¨ï¼ˆACLï¼‰ï¼Œç”¨äºé™åˆ¶è°å¯ä»¥æ‰§è¡Œæ“ä½œã€‚ZooKeeperè¿˜å…·æœ‰çŸ­æš‚èŠ‚ç‚¹çš„æ¦‚å¿µã€‚ åªè¦åˆ›å»ºznodeçš„ä¼šè¯å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œè¿™äº›znodeå°±å­˜åœ¨ã€‚ ä¼šè¯ç»“æŸæ—¶ï¼Œå°†åˆ é™¤znodeã€‚Conditional updates and watchesZooKeeper supports the concept of watches. Clients can set a watch on a znode. A watch will be triggered and removed when the znode changes. When a watch is triggered, the client receives a packet saying that the znode has changed. If the connection between the client and one of the ZooKeeper servers is broken, the client will receive a local notification.æ¡ä»¶æ›´æ–°å’Œæ‰‹è¡¨ZooKeeperæ”¯æŒæ‰‹è¡¨çš„æ¦‚å¿µã€‚å®¢æˆ·ç«¯å¯ä»¥åœ¨znodeä¸Šè®¾ç½®æ‰‹è¡¨ã€‚å½“znodeå‘ç”Ÿå˜åŒ–æ—¶ï¼Œå°†è§¦å‘å¹¶åˆ é™¤ä¸€ä¸ªæ‰‹è¡¨ã€‚å½“ä¸€ä¸ªæ‰‹è¡¨è¢«è§¦å‘æ—¶ï¼Œå®¢æˆ·ç«¯ä¼šæ”¶åˆ°ä¸€ä¸ªæ•°æ®åŒ…ï¼Œè¯´znodeå·²ç»æ”¹å˜äº†ã€‚å¦‚æœå®¢æˆ·ç«¯å’Œä¸€ä¸ªZooKeeperæœåŠ¡å™¨ä¹‹é—´çš„è¿æ¥æ–­å¼€ï¼Œå®¢æˆ·ç«¯å°†æ”¶åˆ°ä¸€ä¸ªæœ¬åœ°é€šçŸ¥ã€‚ å®‰è£…zookeeperStandalone Operation 123456789101112131.ä¸‹è½½zookeeperï¼Œé€šè¿‡fileZileä¸Šä¼ ä¸Šå»tar -zxvf apache-zookeeper-3.6.0-bin.tar.gz2.å®‰è£…java3.å°†è§£å‹åçš„æ–‡ä»¶åé‡å‘½åmv apache-zookeeper-3.6.0-bin zookeeperå¹¶ç§»åŠ¨è‡³&#x2F;usr&#x2F;libmv &#x2F;tmp&#x2F;zookeeper&#x2F; &#x2F;usr&#x2F;libStandalone Operationå•å‡»æ¼”ç¤º4.ç”Ÿæˆä¸€ä¸ªzoo.cfgvi conf zoo.cfgâ€‹ tickTime=2000dataDir=/var/lib/zookeeperclientPort=2181â€‹```å¯åŠ¨sh bin/zkServer.sh start5.æµ‹è¯•sh bin/zkCli.sh -server 127.0.0.1:2181ls /[ zookeeper]Next, create a new znode by running create /zk_test my_data. This creates a new znode and associates the string â€œmy_dataâ€ with the node. You should see:[zkshell: 9] create /zk_test my_dataCreated /zk_test[zk: 127.0.0.1:2181(CONNECTED) 0] ls /[zk_test, zookeeper][zk: 127.0.0.1:2181(CONNECTED) 3] get /zk_testmy_data [zk: 127.0.0.1:2181(CONNECTED) 5] get -s /zk_testmy_datacZxid = 0x3ctime = Wed Apr 22 18:33:23 CST 2020mZxid = 0x3mtime = Wed Apr 22 18:33:23 CST 2020pZxid = 0x3cversion = 0dataVersion = 0aclVersion = 0ephemeralOwner = 0x0dataLength = 7numChildren = 0[zk: 127.0.0.1:2181(CONNECTED) 6] set /zk_test junk[zk: 127.0.0.1:2181(CONNECTED) 7] get -s /zk_testjunkcZxid = 0x3ctime = Wed Apr 22 18:33:23 CST 2020mZxid = 0x7mtime = Fri Apr 24 17:48:13 CST 2020pZxid = 0x3cversion = 0dataVersion = 1aclVersion = 0ephemeralOwner = 0x0dataLength = 4numChildren = 0å¯ä»¥çœ‹åˆ°mTimeè¢«æ”¹å˜äº†ï¼Œä»¥åŠznodeçš„å€¼[zk: 127.0.0.1:2181(CONNECTED) 8] delete /zk_teståˆ é™¤/zk_test[zk: 127.0.0.1:2181(CONNECTED) 9] get -s /zk_testorg.apache.zookeeper.KeeperException$NoNodeException: KeeperErrorCode = NoNode for /zk_test é›†ç¾¤æ¨¡å¼ åç»­å†ä»‹ç»","categories":[],"tags":[]},{"title":"springcloud-gateway","slug":"springcloud-gateway","date":"2020-04-08T06:59:29.000Z","updated":"2020-04-17T02:33:28.728Z","comments":true,"path":"2020/04/08/springcloud-gateway/","link":"","permalink":"http://yoursite.com/2020/04/08/springcloud-gateway/","excerpt":"","text":"åœ¨å†™ä¹‹å‰ï¼Œæƒ³å†™ä¸€ä¸‹æ„Ÿå—ï¼Œä¹‹å‰æœ‰å¯¹æ¥è¿‡springcloudçš„é¡¹ç›®ï¼Œæœ‰ä»¥ä¸‹å‡ ä¸ªæ„Ÿå— 1.æˆ‘ä»¬è¯·æ±‚æ‰€æœ‰æ¥å£ï¼Œéƒ½æ˜¯è¯·æ±‚åŒä¸€ä¸ªç«¯å£ï¼Œè·¯å¾„ä¸åŒï¼Œéƒ½ä¼šåŠ ä¸€ä¸ªtokenæ¥éªŒè¯æƒé™ æˆ‘æ„Ÿè§‰æ˜¯è¿™ä¹ˆå®ç°çš„ï¼ŒæœåŠ¡å™¨å¯¹å¤–è®¿é—®åªå¼€æ”¾gatewayé¡¹ç›®ç«¯å£ï¼Œç„¶ååŠ ä¸€ä¸ªtokenæ¥å…¨å±€filter å½“ç„¶ï¼Œæˆ‘ä¸æ˜¯è¿™ä¸ªé¡¹ç›®çš„è®¾è®¡å¸ˆï¼Œè¿™æ˜¯å‡­ç©ºæƒ³è±¡è€Œå·²ã€‚ ç®€ä»‹This project provides an API Gateway built on top of the Spring Ecosystem, including: Spring 5, Spring Boot 2 and Project Reactor. Spring Cloud Gateway aims to provide a simple, yet effective way to route to APIs and provide cross cutting concerns to them such as: security, monitoring/metrics, and resiliency. è¯¥é¡¹ç›®æä¾›äº†ä¸€ä¸ªåœ¨springç”Ÿæ€ç³»ç»Ÿä¸Šæ„å»ºçš„apiç½‘å…³ï¼ŒåŒ…æ‹¬spring 5,spring boot2å’Œproject reactor.spring cloud gatewayæ—¨åœ¨æä¾›ä¸€ä¸ªç®€å•æœ‰æ•ˆçš„è·¯ç”±åˆ°apiså¹¶ä¸”æä¾›è·¨é¢†åŸŸçš„å…³æ³¨ç‚¹å¦‚ï¼šå®‰å…¨ï¼Œæ£€æµ‹ã€æŒ‡æ ‡å’Œå¼¹æ€§ã€‚ æœ¯è¯­ Route: The basic building block of the gateway. It is defined by an ID, a destination URI, a collection of predicates, and a collection of filters. A route is matched if the aggregate predicate is true.â€”-Routeæ˜¯gatewayä¸­æœ€åŸºæœ¬å—ï¼Œå¦‚æœæ‰€æœ‰predicateæ˜¯trueï¼Œé‚£ä¹ˆrouteä¼šè¢«åŒ¹é… Predicate: This is a Java 8 Function Predicate. The input type is a Spring Framework ServerWebExchange. This lets you match on anything from the HTTP request, such as headers or parameters.é€šè¿‡java8æä¾›çš„Predicateï¼Œæˆ‘ä»¬å¯ä»¥åŒ¹é…HttpRequestä¸­çš„ï¼Œheadersæˆ–è€…parameters Filter: These are instances of Spring Framework GatewayFilter that have been constructed with a specific factory. Here, you can modify requests and responses before or after sending the downstream request.æˆ‘ä»¬å¯ä»¥åœ¨å‘é€ç»™ä¸‹æ¸¸ä¹‹å‰ä¿®æ”¹è¯·æ±‚æˆ–è€…ä¹‹åä¿®æ”¹è¿”å›å›æ¥çš„å“åº”ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬ç”¨ä¸‹é¢ä¸€å¼ å›¾æ¥è§£é‡Š â€‹ ä»å›¾ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ³¨æ„åˆ°Filterä¸­æ˜¯æ”¯æŒè¯·æ±‚å‰ï¼Œå’Œå“åº”åçš„å¤„ç†çš„ è£…é…spring cloud gateway pom 1234567891011 &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-gateway&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--æš‚æ—¶å…ˆæ³¨é‡Š &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt; &lt;/dependency&gt;--&gt; &lt;!--spring cloud version :Hoxton.SR3--&gt; application.yml 123456789101112131415161718management: endpoints: web: exposure: include: \"*\"server: port: 10000#spring: æ­¤å¤„æ³¨é‡Šæ”¹ä¸ºjavaæ³¨å…¥# cloud:# gateway:# routes:# - id: first# uri: http://localhost:9000# predicates:# - Path=/**logging: level: org.springframework.cloud.gateway: debug javaæ³¨å…¥ 1234567@Beanpublic RouteLocator customerRouteLocator(RouteLocatorBuilder builder)&#123; return builder.routes() .route(r-&gt;r.path(\"/**\") .uri(\"http://localhost:9000\").id(\"first\") ).build();&#125; æµ‹è¯• 12D:\\gitclonepackage\\cloud&gt;curl http:&#x2F;&#x2F;localhost:10000&#x2F;hello&#x2F;huskyui hello, huskyui Mon Apr 13 17:25:28 CST 2020 ä»‹ç»predicate1234java8ä¸­çš„predicate,å°±æ˜¯filteré‡Œé¢çš„å‡½æ•°ã€‚è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒç›´è§‚çš„ä¾‹å­List&lt;Integer&gt; list &#x3D; new ArrayList&lt;&gt;(Arrays.asList(1,2,3,4,5,6,7,8,9));list.stream().filter(t-&gt;t&lt;5).forEach(System.out::println);è¾“å‡º 1,2,3,4 PathRoutePredicateFactory1234567@Beanpublic RouteLocator customerRouteLocator(RouteLocatorBuilder builder)&#123; return builder.routes() .route(r-&gt;r.path(\"/**\") .uri(\"http://localhost:9000\").id(\"first\") ).build();&#125; 123æ”¾å¼€äº†&#x2F;**,ä¹Ÿå°±æ˜¯æ”¾å¼€äº†æ‰€æœ‰http:&#x2F;&#x2F;localhost:9000æ‰€æœ‰è·¯å¾„D:\\gitclonepackage\\cloud&gt;curl http:&#x2F;&#x2F;localhost:10000&#x2F;hello&#x2F;huskyuihello, huskyui Mon Apr 13 17:25:28 CST 2020 CookieRoutePredicateFactory12345678@Beanpublic RouteLocator customerRouteLocator(RouteLocatorBuilder builder)&#123; return builder.routes() .route(r-&gt;r .cookie(\"token\",\"kee.e\") .uri(\"http://localhost:9000\").id(\"first\") ).build();&#125; 123456D:\\gitclonepackage\\cloud&gt;curl http:&#x2F;&#x2F;localhost:10000&#x2F;hello&#x2F;huskyui&#123;&quot;timestamp&quot;:&quot;2020-04-13T10:03:43.548+0000&quot;,&quot;path&quot;:&quot;&#x2F;hello&#x2F;huskyui&quot;,&quot;status&quot;:404,&quot;error&quot;:&quot;Not Found&quot;,&quot;message&quot;:null,&quot;requestId&quot;:&quot;b330030a-1&quot;&#125;D:\\gitclonepackage\\cloud&gt;curl http:&#x2F;&#x2F;localhost:10000&#x2F;hello&#x2F;huskyui --cookie &quot;token&#x3D;keexe&quot;hello, huskyui Mon Apr 13 18:03:55 CST 2020D:\\gitclonepackage\\cloud&gt;curl http:&#x2F;&#x2F;localhost:10000&#x2F;hello&#x2F;huskyui --cookie &quot;token&#x3D;keeeee&quot;&#123;&quot;timestamp&quot;:&quot;2020-04-13T10:09:09.207+0000&quot;,&quot;path&quot;:&quot;&#x2F;hello&#x2F;huskyui&quot;,&quot;status&quot;:404,&quot;error&quot;:&quot;Not Found&quot;,&quot;message&quot;:null,&quot;requestId&quot;:&quot;23aba850-3&quot;&#125; ç»„åˆä½¿ç”¨123456789101112@Beanpublic RouteLocator customerRouteLocator(RouteLocatorBuilder builder)&#123; return builder.routes() .route(r-&gt;r .method(HttpMethod.POST) .and() .path(\"/**\") .and() .cookie(\"token\",\"kee.e\") .uri(\"http://localhost:9000\").id(\"first\") ).build();&#125; 12D:\\gitclonepackage\\cloud&gt;curl -X POST http:&#x2F;&#x2F;localhost:10000&#x2F;hello&#x2F;huskyui --cookie &quot;token&#x3D;keeie&quot;hello, huskyui Mon Apr 13 18:13:54 CST 2020 è‡ªå®šä¹‰Predicate123456789101112131415161718192021222324252627282930313233343536373839404142// æˆ‘ä»¬å…ˆå»çœ‹ä¸€ä¸‹cookieåˆ¤æ–­çš„æºç  CookieRoutePredicateFactory.java @Override public Predicate&lt;ServerWebExchange&gt; apply(Config config) &#123; return new GatewayPredicate() &#123; @Override public boolean test(ServerWebExchange exchange) &#123; List&lt;HttpCookie&gt; cookies = exchange.getRequest().getCookies() .get(config.name); if (cookies == null) &#123; return false; &#125; for (HttpCookie cookie : cookies) &#123; if (cookie.getValue().matches(config.regexp)) &#123; return true; &#125; &#125; return false; &#125; @Override public String toString() &#123; return String.format(\"Cookie: name=%s regexp=%s\", config.name, config.regexp); &#125; &#125;; &#125;// å¾ˆå¥½ç†è§£çš„ä»£ç ï¼Œæˆ‘ä»¬å†™ä¸€ä¸²headeråˆ¤æ–­çš„ @Bean public RouteLocator customerRouteLocator(RouteLocatorBuilder builder) &#123; return builder.routes() .route(r -&gt; r.predicate(t -&gt; &#123; List&lt;String&gt; values= t.getRequest().getHeaders().get(\"token\"); if(values==null || values.isEmpty())&#123; return false; &#125; return values.stream().anyMatch(value-&gt;value.equals(\"123456\")); &#125;) .uri(\"lb://eureka-consumer\").id(\"first\") ).build(); &#125; D:\\gitclonepackage\\cloud&gt;curl -X POST http://localhost:10000/hello/huskyui --header \"token: 123456\"hello, huskyui Thu Apr 16 14:58:20 CST 2020 ä»‹ç»filterRoute filters allow the modification of the incoming HTTP request or outgoing HTTP response in some manner. Route filters are scoped to a particular route. Spring Cloud Gateway includes many built-in GatewayFilter Factories. è·¯ç”±è¿‡æ»¤å™¨å¯ä»¥ä¿®æ”¹HTTPè¯·æ±‚å’ŒHTTPå“åº”ï¼Œè·¯ç”±è¿‡æ»¤å™¨çš„ä½œç”¨åŸŸæ˜¯ç‰¹å®šçš„è·¯ç”±ã€‚spring cloud gatewayæœ‰å¾ˆå¤šå†…ç½®çš„ç½‘å…³è¿‡æ»¤å™¨çš„å·¥å‚ã€‚ ä½¿ç”¨PathRoutePredicateFactoryå’ŒStripPrefixGatewayFilterFactoryå®ç°å¯¹ç‰¹å®šé¡¹ç›®è®¿é—®123456789101112 @Bean public RouteLocator customerRouteLocator(RouteLocatorBuilder builder) &#123; return builder.routes() .route(r -&gt; r.path(\"/consumer/**\") .filters(f-&gt;f.stripPrefix(1)) .uri(\"lb://eureka-consumer\").id(\"first\") ).build(); &#125;D:\\gitclonepackage\\cloud&gt;curl -X POST http://localhost:10000/consumer/hello/huskyuihello, huskyui Thu Apr 16 15:16:31 CST 2020// åœ¨è®¿é—®çš„æ—¶å€™ï¼Œç”±äºstripPrefixæ˜¯1ï¼Œä¼šå»é™¤/consumerè¿™ä¸€å±‚ï¼ŒçœŸæ­£çš„ä¼šè½¬å‘æˆ // lb://eureka-consumer/hello/huskyui ä¿®æ”¹RequestBodyä¸­ä¿¡æ¯12345678910111213141516171819202122232425 @Bean public RouteLocator customerRouteLocator(RouteLocatorBuilder builder) &#123; return builder.routes() .route(r -&gt; r.path(\"/producer/**\") .filters(f -&gt; f.stripPrefix(1) .modifyRequestBody(Map.class, Map.class, MediaType.APPLICATION_JSON_VALUE, (serverWebExchange, s) -&gt; &#123; System.out.println(s); s.put(\"name\",\"adios\"); return Mono.just(s); &#125;)) .uri(\"lb://eureka-producer\").id(\"first\") ).build(); &#125;// å¯ä»¥çœ‹åˆ°è¿™ä¸ªsçš„ç±»å‹æ˜¯Map.class,æˆ‘ä¿®æ”¹çš„å¯¹åº”nameçš„å€¼ï¼ŒPOST http://localhost:10000/producer/helloContent-Type: application/json&#123;\"name\": \"huskyui\"&#125;hello, adios Thu Apr 16 18:34:56 CST 2020// å¯ä»¥çœ‹åˆ°æˆ‘ä¿®æ”¹å¯¹åº”çš„requestBodyçš„å€¼ï¼Œåœ¨æ§åˆ¶å°ä¹Ÿæ‰“å°äº†åˆå§‹RequestBodyè¯·æ±‚jsonï¼ˆä¸Šé¢è¯·æ±‚æ–¹å¼æ˜¯é€šè¿‡ideaé‡Œé¢å†…ç½®çš„è¯·æ±‚æ–¹å¼ï¼‰ å…¨å±€æ‹¦æˆªå™¨The GlobalFilter interface has the same signature as GatewayFilter. These are special filters that are conditionally applied to all routes. GlobalFilteræ¥å£å…·æœ‰ä¸gatewayFilterç›¸åŒçš„ç­¾åï¼Œè¿™äº›æ˜¯ç‰¹æ®Šè¿‡æ»¤å™¨ï¼Œæœ‰æ¡ä»¶åœ°åº”ç”¨äºæ‰€æœ‰è·¯ç”±ã€‚ åç»­ä»ç°åœ¨å¼€å§‹ï¼Œæš‚åœæ›´æ–°spring cloud gatewayç›¸å…³åšå®¢ï¼Œæˆ‘å…ˆå»å­¦ç‚¹åˆ«çš„äº†ã€‚å­¦ä¹ è¿™ç§å¹¶æ²¡æœ‰ä»€ä¹ˆç”¨ã€‚ å‚è€ƒçº¯æ´çš„å¾®ç¬‘å†™çš„spring cloudæ–‡æ¡£windmtå†™çš„æ–‡æ¡£spring cloud gatewayå®˜æ–¹æ–‡æ¡£githubä¸Šspring cloud gatewayæä¾›çš„samples","categories":[],"tags":[{"name":"SpringCloud","slug":"SpringCloud","permalink":"http://yoursite.com/tags/SpringCloud/"},{"name":"Gateway","slug":"Gateway","permalink":"http://yoursite.com/tags/Gateway/"}]},{"title":"SpringCloud-config","slug":"SpringCloud-config","date":"2020-03-26T08:42:05.000Z","updated":"2020-03-30T07:55:24.609Z","comments":true,"path":"2020/03/26/SpringCloud-config/","link":"","permalink":"http://yoursite.com/2020/03/26/SpringCloud-config/","excerpt":"","text":"Spring Cloud Configç®€ä»‹Spring Cloud Config provides server-side and client-side support for externalized configuration in a distributed system. With the Config Server, you have a central place to manage external properties for applications across all environments. The concepts on both client and server map identically to the Spring Environment and PropertySource abstractions, so they fit very well with Spring applications but can be used with any application running in any language. As an application moves through the deployment pipeline from dev to test and into production, you can manage the configuration between those environments and be certain that applications have everything they need to run when they migrate. The default implementation of the server storage backend uses git, so it easily supports labelled versions of configuration environments as well as being accessible to a wide range of tooling for managing the content. It is easy to add alternative implementations and plug them in with Spring configuration. Spring Cloud Configä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å¤–éƒ¨åŒ–é…ç½®æä¾›äº†æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯æ”¯æŒã€‚æœ‰äº†Config Serverï¼Œæ‚¨å°±æœ‰äº†ä¸€ä¸ªä¸­å¿ƒä½ç½®æ¥ç®¡ç†è·¨æ‰€æœ‰ç¯å¢ƒçš„åº”ç”¨ç¨‹åºçš„å¤–éƒ¨å±æ€§ã€‚å®¢æˆ·æœºå’ŒæœåŠ¡å™¨ä¸Šçš„æ¦‚å¿µä¸Springç¯å¢ƒå’ŒPropertySourceæŠ½è±¡å®Œå…¨ç›¸åŒï¼Œå› æ­¤å®ƒä»¬éå¸¸é€‚åˆSpringåº”ç”¨ç¨‹åºï¼Œä½†å¯ä»¥ç”¨äºä»¥ä»»ä½•è¯­è¨€è¿è¡Œçš„ä»»ä½•åº”ç”¨ç¨‹åº.å½“åº”ç”¨ç¨‹åºé€šè¿‡éƒ¨ç½²ç®¡é“ä»devè½¬ç§»åˆ°æµ‹è¯•å¹¶è¿›å…¥ç”Ÿäº§ç¯å¢ƒæ—¶ï¼Œæ‚¨å¯ä»¥åœ¨ä¸¤è€…ä¹‹é—´ç®¡ç†é…ç½®.æœåŠ¡å™¨å­˜å‚¨åç«¯é»˜è®¤çš„å®ç°ä½¿ç”¨gitï¼Œå› æ­¤å®ƒå¾ˆå®¹æ˜“æ”¯æŒé…ç½®ç¯å¢ƒçš„æ ‡è®°ç‰ˆæœ¬ï¼Œå¹¶ä¸”å¯ä»¥è®¿é—®å„ç§å„æ ·çš„å·¥å…·æ¥ç®¡ç†å†…å®¹ã€‚å¾ˆå®¹æ˜“æ·»åŠ æ›¿ä»£å®ç°å¹¶å°†å®ƒä»¬æ’å…¥Springé…ç½®ä¸­ config-serveråˆ›å»ºä¸€ä¸ªé…ç½®ä»“åº“ å…·ä½“æ ·å¼ï¼Œå¯ä»¥çœ‹https://github.com/huskyui/config-repo åœ¨spring-cloudä¸‹é¢æœ‰ä¸‰ä¸ªæ–‡ä»¶ï¼Œconfig-dev.ymlå’Œconfig-prod.ymlå’Œconfig-test.yml å¯¼å…¥pom 12345678910&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-config-server&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt; &lt;/dependency&gt;&lt;!--spring-cloud.version Hoxton.SR3 --&gt; application.yml 12345678910111213141516spring: application: name: config-server cloud: config: server: git: uri: https://github.com/huskyui/config-repo # uri search-paths: spring-cloud # å±‚çº§server: port: 12000eureka: client: service-url: defaultZone: http://localhost:7000/eureka/# ä»Šå¤©å†™defalutZoneå†™é”™äº†ï¼Œå‘ç°åº”ç”¨åœ¨è¯·æ±‚loclahost:8761/eureka/,åŸæ¥é»˜è®¤å€¼æ˜¯è¿™ä¸ª @EnableConfigServer 12345678910@SpringBootApplication@EnableConfigServer// å¼€å¯config-serverpublic class CloudConfigServerApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(CloudConfigServerApplication.class, args); &#125;&#125; æµ‹è¯• 123curl http:&#x2F;&#x2F;localhost:12000&#x2F;config-dev.ymlcurrency: name: huskyui-update-2020-03-24-----2 config-clientpom 1234567891011121314151617&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-config&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt; &lt;/dependency&gt;&lt;!--spring-cloud-version Hoxton.SR3--&gt; bootstrap.yml bootstrap.ymlä¼˜å…ˆäºapplication.ymlé…ç½® 12345678910111213spring: cloud: config: label: master # ç”¨äºæ‹‰å–è¿œç¨‹é…ç½®å±æ€§çš„æ ‡ç­¾åç§°ï¼Œåœ¨åŸºäºgitçš„æœåŠ¡å™¨ï¼Œé€šå¸¸æ˜¯master name: config # Name of application used to fetch remote properties. å¯¹åº”config-dev.ymlä¸­çš„config profile: dev # The default profile to use when fetching remote configuration discovery: enabled: true #Flag to indicate that config server discovery is enabled service-id: config-server #Service id to locate config server.ä¹Ÿå°±æ˜¯config-serveræ³¨å†Œåœ¨eurekaä¸­çš„application-nameeureka: client: service-url: defaultZone: http://localhost:7000/eureka/ application.yml 12345678910spring: application: name: config-git server: port: 13000management: endpoints: web: exposure: include: refresh # æ”¾å¼€/actuator/refreshè·¯å¾„ï¼Œå…·ä½“æ˜¯ä»€ä¹ˆæ ·å¼çš„è¯·æ±‚ï¼Œè¿˜å¾—çœ‹æ–‡æ¡£ HelloController 1234567891011121314151617181920@RestController/** * Convenience annotation to put a &lt;code&gt;@Bean&lt;/code&gt; definition in * &#123;@link org.springframework.cloud.context.scope.refresh.RefreshScope refresh scope&#125;. * Beans annotated this way can be refreshed at runtime and any components that are using * them will get a new instance on the next method call, fully initialized and injected * with all dependencies. åœ¨è°ƒç”¨/actuator/refreshæ—¶ï¼Œè¿è¡ŒæœŸé—´ï¼Œè¿™ä¸ªbeanä¼šè¢«åˆ·æ–°*/@RefreshScopepublic class HelloController &#123; @Value(\"$&#123;currency.name:error&#125;\") private String name; @RequestMapping(\"/hello\") public String name()&#123; return name; &#125;&#125; æµ‹è¯• 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849501.æµ‹è¯•å•ä¸ªåº”ç”¨åˆ·æ–°æ‰“åŒ…è¿è¡Œæµ‹è¯•å½“å‰æ•°æ®é—®é¢˜curl localhost:13000&#x2F;hellohuskyui-update-2020-03-24-----2æ›´æ–°æ•°æ®æ›´æ–°æ•°æ®config-devé‡Œé¢çš„æ•°æ®currency: name: huskyui-update-2020-03-27 å¹¶æäº¤åˆ°è¿œç¨‹ä»“åº“è°ƒç”¨åˆ·æ–°æ¥å£curl -X POST localhost:13000&#x2F;actuator&#x2F;refresh[&quot;currency.name&quot;,&quot;config.client.version&quot;]curl localhost:13000&#x2F;hellohuskyui-update-2020-03-27å¯ä»¥çœ‹åˆ°æ•°æ®åˆ·æ–°æˆåŠŸ2.æµ‹è¯•å¤šä¸ªåº”ç”¨åˆ·æ–°java -jar xxx.jar --server.port&#x3D;13000java -jar xxx.jar --server.port&#x3D;13001curl localhost:13000&#x2F;hellohuskyui-update-2020-03-27curl localhost:13001&#x2F;hellohuskyui-update-2020-03-27æ›´æ–°æ•°æ®config-dev.ymlcurrency: name: huskyui-update-2020-03-27-for-two-client-test2å¹¶æäº¤åˆ°è¿œç¨‹ä»“åº“curl localhost:13000&#x2F;hellohuskyui-update-2020-03-27curl localhost:13001&#x2F;hellohuskyui-update-2020-03-27ä¸‹é¢æ‰§è¡Œåˆ·æ–°æ“ä½œcurl -X POST localhost:13000&#x2F;actuator&#x2F;refresh[&quot;currency.name&quot;,&quot;config.client.version&quot;]curl localhost:12000&#x2F;config-dev.ymlcurrency: name: huskyui-update-2020-03-27-for-two-client-test2curl localhost:13000&#x2F;hellohuskyui-update-2020-03-27-for-two-client-test2curl localhost:13001&#x2F;hellohuskyui-update-2020-03-27curl -X POST localhost:13001&#x2F;actuator&#x2F;refresh[&quot;currency.name&quot;,&quot;config.client.version&quot;]curl -X POST localhost:13001&#x2F;hellohuskyui-update-2020-03-27-for-two-client-test2å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœé…ç½®æ–‡ä»¶æ›´æ–°æ—¶ï¼Œ&#x2F;actuator&#x2F;refreshåªæ˜¯é’ˆå¯¹å•ä¸ªåº”ç”¨çš„ï¼Œå¦‚æœéœ€è¦æ›´æ–°æ‰€æœ‰åº”ç”¨éœ€è¦åˆ†åˆ«æ˜¯å»åˆ·æ–°å¯¹åº”çš„åº”ç”¨ ä½¿ç”¨spring-cloud-buså®ç°ç¾¤ä½“åˆ·æ–° ä»ä¸Šé¢çš„æ¶æ„å›¾ï¼Œæˆ‘ä»¬config-serverå’Œconfig-clientéƒ½è®¢é˜…ä¸€ä¸‹RabbitMQ æˆ‘ä»¬éœ€è¦ä¿®æ”¹åŸæ¥çš„config-server POM 123456789101112&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-bus&lt;/artifactId&gt;&lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-stream-binder-rabbit&lt;/artifactId&gt;&lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;&lt;/dependency&gt; application.ymlæ·»åŠ  1234567891011spring: rabbitmq: host: localhost port: 5672 username: guest password: guest ## ä¸Šè¿°æ˜¯RabbitMQç›¸å…³è¿æ¥å‚æ•°ï¼Œæ¼äº†ä¸€ä¸ªvhostmanagement: endpoints: web: exposure: include: \"*\" ## æ”¾å¼€/actuator/bus-refresh config-clientä¿®æ”¹éƒ¨åˆ†ä¹Ÿå’Œä¸Šè¿°ä¸€æ · ä¿®æ”¹åï¼Œå¯åŠ¨config-server,å¹¶å¯åŠ¨ä¸¤å°config-client,ç«¯å£ä¸åŒï¼ˆâ€“server.port=different_portï¼‰ æˆ‘ä»¬è®¿é—®http://localhost:15672/è®¿é—®RabbitMQå®¢æˆ·ç«¯ï¼Œç‚¹å‡»exchange,å¯ä»¥çœ‹åˆ°æ˜¯ springCloudBus,æ˜¯topicç±»å‹,ä¸‰ä¸ªç»‘å®šè¯¥exchangeçš„queueçš„routing keyéƒ½æ˜¯#ï¼Œä¹Ÿå°±æ˜¯ä¸å¤„ç†fanout æµ‹è¯• 123456789101112131415é¦–å…ˆä¿®æ”¹config-repo,å¹¶æäº¤é¦–å…ˆæŸ¥çœ‹æ•°æ®D:\\gitclonepackage\\cloud&gt;curl localhost:13000&#x2F;hellohuskyui-update-2020-03-30D:\\gitclonepackage\\cloud&gt;curl localhost:13001&#x2F;hellohuskyui-update-2020-03-30è°ƒç”¨åˆ·æ–°æ“ä½œcurl -X POST localhost:12000&#x2F;actuator&#x2F;bus-refreshè¿™ä¸ªè¯·æ±‚çš„æ—¶å€™ï¼Œæ˜¯è¯·æ±‚config-server;å½“ç„¶ä¹Ÿå¯ä»¥è¯·æ±‚config-clientçš„bus-refreshD:\\gitclonepackage\\cloud&gt;curl localhost:13001&#x2F;hellohuskyui-update-2020-03-30-last-commitD:\\gitclonepackage\\cloud&gt;curl localhost:13000&#x2F;hellohuskyui-update-2020-03-30-last-commit æœ¬ç¯‡æ–‡ç« å‚è€ƒï¼š Spring Cloudï¼ˆä¸ƒï¼‰ï¼šé…ç½®ä¸­å¿ƒï¼ˆGit ç‰ˆä¸åŠ¨æ€åˆ·æ–°ï¼‰Spring Cloudï¼ˆå…«ï¼‰ï¼šé…ç½®ä¸­å¿ƒï¼ˆæœåŠ¡åŒ–ä¸é«˜å¯ç”¨ï¼‰ Spring Cloudï¼ˆä¹ï¼‰ï¼šé…ç½®ä¸­å¿ƒï¼ˆæ¶ˆæ¯æ€»çº¿ï¼‰ã€Finchley ç‰ˆã€‘","categories":[{"name":"springcloud","slug":"springcloud","permalink":"http://yoursite.com/categories/springcloud/"}],"tags":[{"name":"SpringCloud","slug":"SpringCloud","permalink":"http://yoursite.com/tags/SpringCloud/"},{"name":"Eureka","slug":"Eureka","permalink":"http://yoursite.com/tags/Eureka/"}]},{"title":"SpringCloud-Hystrix","slug":"SpringCloud-Hystrix","date":"2020-03-23T10:09:49.000Z","updated":"2020-03-24T07:20:07.545Z","comments":true,"path":"2020/03/23/SpringCloud-Hystrix/","link":"","permalink":"http://yoursite.com/2020/03/23/SpringCloud-Hystrix/","excerpt":"","text":"HystrixHystrix is a latency and fault tolerance library designed to isolate points of access to remote systems, services and 3rd party libraries, stop cascading failure and enable resilience in complex distributed systems where failure is inevitable. Hystrixæ˜¯ä¸€ä¸ªå»¶è¿Ÿå’Œå®¹é”™åº“ï¼Œæ—¨åœ¨éš”ç¦»è¿œç¨‹ç³»ç»Ÿã€æœåŠ¡å’Œç¬¬ä¸‰æ–¹åº“çš„è®¿é—®ç‚¹ï¼Œåœæ­¢æ¬¡çº§æ•…éšœï¼Œå¹¶ä¸”ä¸å¯é¿å…çš„å¤æ‚åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å®ç°è‡ªæˆ‘æ¢å¤èƒ½åŠ›ã€‚ é…ç½®hystrixpom 123456789101112131415161718192021222324252627282930 &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;fastjson&lt;/artifactId&gt; &lt;version&gt;1.2.67&lt;/version&gt; &lt;/dependency&gt;&lt;!--web--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--Eureka client --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- Hystrix --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- å£°æ˜æ€§RESTå®¢æˆ·ç«¯ï¼Œä½¿ç”¨æ³¨è§£ä¿®é¥°æ¥å£ï¼ŒåŠ¨æ€å®ç° --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--ä¸ºäº†åç»­æ”¾å¼€hystrix.streamè·¯å¾„--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; application.yml 12345678910111213141516171819202122spring: application: name: eureka-consumer-feign-hystrix# å½“å‰åº”ç”¨åç§°eureka: client: service-url: defaultZone: http://localhost:7000/eureka/ # æ˜ å°„åˆ°Eureka serverçš„è·¯å¾„server: port: 9001feign: hystrix: enabled: true# an OpenFeign client will be wrapped with a Hystrix circuit breaker# ä¸€ä¸ªOpenFeignå®¢æˆ·ç«¯å°†åŒ…è£…æœ‰Hystrixæ–­è·¯å™¨management: endpoints: web: exposure: include: hystrix.stream# ä¸ºäº†ç»™Hystrix Dashboardæä¾›ä½¿ç”¨ å¯åŠ¨ç±»é…ç½® 1234567891011@EnableFeignClients//æ‰«æåŒ…ä¸‹è¢«@FeignClientæ³¨è§£çš„ï¼Œéœ€è¦å’Œ@ConfigurationåŒæ—¶ä½¿ç”¨@EnableHystrix//å¼€å¯æ–­è·¯å™¨ï¼Œå¹¶ä¸”è‡ªåŠ¨é…ç½®æ‰¾åˆ°Hystrixç±»ï¼ˆif they are availableï¼‰@SpringBootApplicationpublic class CloudConsumerFeignHystrixApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(CloudConsumerFeignHystrixApplication.class, args); &#125;&#125; è¿œç¨‹è°ƒç”¨ 1234567891011@Component// nameï¼š the service id with optional protocol prefix.å¸¦æœ‰å¯é€‰åè®®å‰ç¼€çš„æœåŠ¡ID// fallbackï¼š æŒ‡å®šçš„Feignå®¢æˆ·ç«¯æ¥å£çš„åå¤‡ç±»ã€‚fallbackç±»å¿…é¡»å®ç°è¯¥æ¥å£å¹¶ä¸”æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„spring bean//Fallback class for the specified Feign client interface. The fallback class must// implement the interface annotated by this annotation and be a valid spring bean.@FeignClient(name = \"eureka-producer\",fallback = HelloRemoteHystrix.class)public interface HelloRemote &#123; @RequestMapping(\"/hello\") String hello(@RequestBody JSONObject requestJSON);&#125; fallbackç±» 1234567@Componentpublic class HelloRemoteHystrix implements HelloRemote &#123; @Override public String hello(JSONObject requestJSON) &#123; return \"hello world\"; &#125;&#125; controller 1234567891011121314@RestControllerpublic class HelloController &#123; @Resource private HelloRemote helloRemote; @RequestMapping(\"/hello/&#123;name&#125;\") public String hello(@PathVariable(name = \"name\")String name)&#123; JSONObject requestJSON = new JSONObject(); requestJSON.put(\"name\",name); return helloRemote.hello(requestJSON); &#125;&#125; æµ‹è¯• 12345678910å°†eureka-serverï¼Œproducerï¼Œfeign-hystrixä¸‰ä¸ªé¡¹ç›®å¯åŠ¨ï¼Œåœ¨eureka-serverä¸Šå¯ä»¥çœ‹åˆ°producerå’Œfeign-hystrixéƒ½å·²ç»æ³¨å†ŒæˆåŠŸã€‚è®¿é—®ï¼šlocalhost:9001&#x2F;hello&#x2F;huskyuihello, huskyui Tue Mar 24 14:34:44 CST 2020å°†producerå…³é—­è®¿é—®ï¼šlocalhost:9001&#x2F;hello&#x2F;huskyuihello worldå†æ¬¡å°†producerå¯åŠ¨hello, huskyui Tue Mar 24 14:40:27 CST 2020è¿™è¾¹ï¼Œå¯ä»¥çœ‹åˆ°ç†”æ–­èƒ½åŠ›ï¼Œä»¥åŠè‡ªæˆ‘æ¢å¤èƒ½åŠ› é…ç½®ä¸€ä¸ªHystrix dashboardpom 12345678&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix-dashboard&lt;/artifactId&gt;&lt;/dependency&gt; application.yml 12345spring: application: name: hystrix-dashboardserver: port: 11000 æ·»åŠ æ³¨è§£@EnableHystrixDashboard 123456789@SpringBootApplication@EnableHystrixDashboardpublic class CloudHystrixDashboardApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(CloudHystrixDashboardApplication.class, args); &#125;&#125; æµ‹è¯• 12345è¿è¡Œè¯¥é¡¹ç›®è®¿é—®ï¼š http:&#x2F;&#x2F;localhost:11000&#x2F;hystrixåœ¨å¯åŠ¨åè¾“å…¥http:&#x2F;&#x2F;localhost:9001&#x2F;actuator&#x2F;hystrix.stream9001æ˜¯feign-hystrixçš„é¡¹ç›®çš„ç«¯å£ï¼Œå½“æ—¶æˆ‘ä»¬å¼•å…¥äº†actuatorï¼Œå¼€æ”¾hystrix.streamå¯ä»¥çœ‹åˆ°dashboardç›¸å…³","categories":[{"name":"springcloud","slug":"springcloud","permalink":"http://yoursite.com/categories/springcloud/"}],"tags":[{"name":"SpringCloud","slug":"SpringCloud","permalink":"http://yoursite.com/tags/SpringCloud/"},{"name":"Hystrix","slug":"Hystrix","permalink":"http://yoursite.com/tags/Hystrix/"}]},{"title":"SpringCloud-Eureka","slug":"SpringCloud-Eureka","date":"2020-03-20T03:09:02.000Z","updated":"2020-03-20T08:42:54.373Z","comments":true,"path":"2020/03/20/SpringCloud-Eureka/","link":"","permalink":"http://yoursite.com/2020/03/20/SpringCloud-Eureka/","excerpt":"","text":"Eurekaç®€ä»‹Eurekaæ˜¯ä¸€ç§åŸºäºREST(Representational State Thransferè¡¨ç°å±‚çŠ¶æ€è½¬ç§»)çš„æœåŠ¡ï¼Œä¸»è¦ç”¨äºAWSçš„å®šä½æœåŠ¡ï¼Œä»¥ä¾¿å®ç°ä¸­é—´å±‚æœåŠ¡å™¨çš„è´Ÿè½½å‡è¡¡å’Œæ•…éšœè½¬ç§»ã€‚ å•ä¸ªæ³¨å†Œä¸­å¿ƒæ•´åˆpomé…ç½®1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-server&lt;/artifactId&gt;&lt;/dependency&gt; application.yml12345678910111213spring: application: name: eureka-serverserver: port: 7000 # Server HTTP port.eureka: instance: hostname: localhost # eurekaå®ä¾‹çš„hostname client: register-with-eureka: false # æŒ‡ç¤ºå½“å‰å®ä¾‹æ˜¯å¦åº”åœ¨eurekaæœåŠ¡å™¨ä¸Šæ³¨å†Œå…¶ä¿¡æ¯ä»¥ä¾›å‘ç° fetch-registry: false # æŒ‡ç¤ºå½“å‰å®ä¾‹æ˜¯å¦ä»eurekaæœåŠ¡å™¨è·å–æ³¨å†Œè¡¨ä¿¡æ¯ service-url: # æ˜ å°„mapã€‚æ˜ å°„å…³äºeurekaæœåŠ¡å™¨çš„urlåˆ—è¡¨ï¼Œmapçš„valueå€¼å¯ä»¥æ˜¯å•ä¸ªurlï¼Œä¹Ÿå¯ä»¥æ˜¯ä»¥,åˆ†å‰²ç¬¦åˆ†å‰²çš„å¤šä¸ªurlï¼Œä¿®æ”¹ä¹‹åç”Ÿæ•ˆæ—¶é—´å°†åœ¨ä¸‹ä¸€ä¸ªå¾ªç¯ä¸­ï¼Œç”±eurekaServiceUrlPollIntervalSecondsæŒ‡å®š defaultZone: http://$&#123;eureka.instance.hostname&#125;:$&#123;server.port&#125;/eureka/ æ³¨è§£@EnableEurekaServer123456789@EnableEurekaServer // Annotation to activate Eureka Server related configuration. æ¿€æ´»eurekaç›¸å…³é…ç½®çš„æ³¨è§£@SpringBootApplicationpublic class EurekaServerApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(EurekaServerApplication.class, args); &#125;&#125; æ‰“åŒ…éƒ¨ç½²è¿è¡Œ123456mvn clean package -Dmaven.test.skip&#x3D;truejava -jar xxx.jarè®¿é—® localhost:7000 æ³¨å†Œä¸¤ä¸ªæ³¨å†Œä¸­å¿ƒä¿®æ”¹application.yamlé…ç½®æ–‡ä»¶123456789101112131415161718192021222324252627282930## æ–°å¢ä¸¤ä¸ªé…ç½®æ–‡ä»¶## application-peer1.ymlspring: application: name: eureka-serverserver: port: 7001 # Server HTTP port.eureka: instance: hostname: localhost # eurekaå®ä¾‹çš„hostname client: register-with-eureka: true # æŒ‡ç¤ºå½“å‰å®ä¾‹æ˜¯å¦åº”åœ¨eurekaæœåŠ¡å™¨ä¸Šæ³¨å†Œå…¶ä¿¡æ¯ä»¥ä¾›å‘ç° fetch-registry: true # æŒ‡ç¤ºå½“å‰å®ä¾‹æ˜¯å¦ä»eurekaæœåŠ¡å™¨è·å–æ³¨å†Œè¡¨ä¿¡æ¯ service-url: # æ˜ å°„mapã€‚æ˜ å°„å…³äºeurekaæœåŠ¡å™¨çš„urlåˆ—è¡¨ï¼Œmapçš„valueå€¼å¯ä»¥æ˜¯å•ä¸ªurlï¼Œä¹Ÿå¯ä»¥æ˜¯ä»¥,åˆ†å‰²ç¬¦åˆ†å‰²çš„å¤šä¸ªurlï¼Œä¿®æ”¹ä¹‹åç”Ÿæ•ˆæ—¶é—´å°†åœ¨ä¸‹ä¸€ä¸ªå¾ªç¯ä¸­ï¼Œç”±eurekaServiceUrlPollIntervalSecondsæŒ‡å®š defaultZone: http://127.0.0.1:7002/eureka/ ## application-peer2.yml spring: application: name: eureka-serverserver: port: 7002 # Server HTTP port.eureka: instance: hostname: localhost # eurekaå®ä¾‹çš„hostname client: register-with-eureka: true # æŒ‡ç¤ºå½“å‰å®ä¾‹æ˜¯å¦åº”åœ¨eurekaæœåŠ¡å™¨ä¸Šæ³¨å†Œå…¶ä¿¡æ¯ä»¥ä¾›å‘ç° fetch-registry: true # æŒ‡ç¤ºå½“å‰å®ä¾‹æ˜¯å¦ä»eurekaæœåŠ¡å™¨è·å–æ³¨å†Œè¡¨ä¿¡æ¯ service-url: # æ˜ å°„mapã€‚æ˜ å°„å…³äºeurekaæœåŠ¡å™¨çš„urlåˆ—è¡¨ï¼Œmapçš„valueå€¼å¯ä»¥æ˜¯å•ä¸ªurlï¼Œä¹Ÿå¯ä»¥æ˜¯ä»¥,åˆ†å‰²ç¬¦åˆ†å‰²çš„å¤šä¸ªurlï¼Œä¿®æ”¹ä¹‹åç”Ÿæ•ˆæ—¶é—´å°†åœ¨ä¸‹ä¸€ä¸ªå¾ªç¯ä¸­ï¼Œç”±eurekaServiceUrlPollIntervalSecondsæŒ‡å®š defaultZone: http://127.0.0.1:7001/eureka/ æ‰“åŒ…éƒ¨ç½²12345678&#x2F;&#x2F; æ‰“åŒ…mvn clean package -Dmaven.test.skip&#x3D;true&#x2F;&#x2F; è¿è¡Œjava -jar xxx.jar --spring.profiles.active&#x3D;peer1java -jar xxx.jpg --spring.profiles.active&#x3D;peer2&#x2F;&#x2F; è®¿é—®localhost:7001localhost:7002 æœåŠ¡æä¾›å’Œè°ƒç”¨ç”Ÿæˆè€…pom12345678910111213141516&lt;!-- https://mvnrepository.com/artifact/com.alibaba/fastjson --&gt;&lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;fastjson&lt;/artifactId&gt; &lt;version&gt;1.2.67&lt;/version&gt;&lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;&lt;/dependency&gt; application.yml123456789spring: application: name: eureka-producereureka: client: service-url: defaultZone: http://127.0.0.1:7000/eureka/server: port: 8000 å…·ä½“æ–¹æ³•12345678@RestControllerpublic class HelloController &#123; @RequestMapping(\"/hello\") public String hello(@RequestBody JSONObject requestJSON) &#123; String name = requestJSON.getString(\"name\"); return \"hello, \" + name + \" \" + new Date(); &#125;&#125; æ‰“åŒ…éƒ¨ç½²æµ‹è¯•1234mvn clean package -Dmaven.test.skip&#x3D;truejava -jar xxx.jarcurl -H&#39;Content-Type: application&#x2F;json&#39; -d&#39;&#123;&quot;name&quot;:&quot;huskyui&quot;&#125;&#39; localhost:8000&#x2F;hellohello, huskyui Fri Mar 20 16:06:40 CST 2020 æ¶ˆè´¹è€…pom123456789101112131415161718&lt;!-- https://mvnrepository.com/artifact/com.alibaba/fastjson --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;fastjson&lt;/artifactId&gt; &lt;version&gt;1.2.67&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt; &lt;/dependency&gt; application.yml123456789spring: application: name: eureka-consumereureka: client: service-url: defaultZone: http://localhost:7000/eureka/server: port: 9000 æ·»åŠ @EnableFeignClients123456789@EnableFeignClients@SpringBootApplicationpublic class CloudEurekaConsumerApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(CloudEurekaConsumerApplication.class, args); &#125;&#125; å…·ä½“ä»£ç 12345678910111213141516171819@FeignClient(name = \"eureka-producer\")public interface HelloRemote &#123; @RequestMapping(\"/hello\") String hello(@RequestBody JSONObject requestJSON);&#125;@RestControllerpublic class HelloController &#123; @Autowired private HelloRemote helloRemote; @RequestMapping(\"/hello/&#123;name&#125;\") public String index(@PathVariable(\"name\")String name)&#123; JSONObject requestJSon = new JSONObject(); requestJSon.put(\"name\",name); return helloRemote.hello(requestJSon); &#125;&#125; æ‰“åŒ…éƒ¨ç½²æµ‹è¯•1234mvn clean package -Dmaven.test.skip&#x3D;truejava -jar xxx.jarcurl localhost:9000&#x2F;hello&#x2F;huskyuihello, huskyui Fri Mar 20 16:11:59 CST 2020 è´Ÿè½½å‡è¡¡å¯åŠ¨ä¸¤ä¸ªä¸åŒç«¯å£çš„ç”Ÿäº§è€…ï¼Œå¯åŠ¨ä¸€ä¸ªæ¶ˆè´¹è€…ä¼šå®ç°ç›¸å…³æ•ˆæœ","categories":[{"name":"springcloud","slug":"springcloud","permalink":"http://yoursite.com/categories/springcloud/"}],"tags":[{"name":"SpringCloud","slug":"SpringCloud","permalink":"http://yoursite.com/tags/SpringCloud/"},{"name":"Eureka","slug":"Eureka","permalink":"http://yoursite.com/tags/Eureka/"}]},{"title":"SpringBootæ•´åˆRabbitMQ","slug":"SpringBootæ•´åˆRabbitMQ","date":"2020-03-19T02:25:44.000Z","updated":"2020-03-19T06:09:24.991Z","comments":true,"path":"2020/03/19/SpringBootæ•´åˆRabbitMQ/","link":"","permalink":"http://yoursite.com/2020/03/19/SpringBoot%E6%95%B4%E5%90%88RabbitMQ/","excerpt":"","text":"SpringBooté…ç½®RabbitMQé…ç½®maven1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-amqp&lt;/artifactId&gt;&lt;/dependency&gt; é…ç½®æ–‡ä»¶application.yml1234567spring: rabbitmq: username: user_mmr #ç”¨æˆ·å password: 123 #å¯†ç  host: localhost # ä½ è¦è¿æ¥çš„RabbitMQçš„host port: 5672 # Rabbitçš„port virtual-host: '/vhost_mmr' #virtual-host RabbitMQæ•™ç¨‹ä»¥ä¸‹æ•™ç¨‹éƒ½å¯ä»¥åœ¨RabbitMQåœ¨githubçš„ä»“åº“rabbitmq-tutorialä¸­æ‰¾åˆ°ï¼Œå…·ä½“springbootåœ¨spring-amqpæ¨¡å—ä¸­ã€‚åœ¨è¿™é‡Œé¢è¦è®²ä¸€ä¸‹å¦‚ä½•è¿è¡Œç›¸å…³ä»£ç  1234567891011121314151617181920212223### æ‰“åŒ…é¡¹ç›®mvn clean package### è¿è¡Œé¡¹ç›®java -jar xxx.jar --spring.profiles.active&#x3D;tut1,sender### ä¸‹é¢æ”¾ä¸Šç›¸å…³è¿è¡Œå‘½ä»¤System.out.println(&quot;java -jar rabbit-tutorials.jar --spring.profiles.active&#x3D;hello-world,receiver&quot;);System.out.println(&quot;java -jar rabbit-tutorials.jar --spring.profiles.active&#x3D;hello-world,sender&quot;);System.out.println(&quot;java -jar rabbit-tutorials.jar --spring.profiles.active&#x3D;work-queues,receiver&quot;);System.out.println(&quot;java -jar rabbit-tutorials.jar --spring.profiles.active&#x3D;work-queues,sender&quot;);System.out.println(&quot;java -jar rabbit-tutorials.jar --spring.profiles.active&#x3D;pub-sub,receiver&quot;);System.out.println(&quot;java -jar rabbit-tutorials.jar --spring.profiles.active&#x3D;pub-sub,sender&quot;);System.out.println(&quot;java -jar rabbit-tutorials.jar --spring.profiles.active&#x3D;routing,receiver&quot;);System.out.println(&quot;java -jar rabbit-tutorials.jar --spring.profiles.active&#x3D;routing,sender&quot;);System.out.println(&quot;java -jar rabbit-tutorials.jar --spring.profiles.active&#x3D;topics,receiver&quot;);System.out.println(&quot;java -jar rabbit-tutorials.jar --spring.profiles.active&#x3D;topics,sender&quot;);#### æ³¨æ„ï¼Œè¯¥é¡¹ç›®ä½¿ç”¨äº†å®šæ—¶ä»»åŠ¡ä½ éœ€è¦é…ç½®å…è®¸å®šæ—¶è°ƒåº¦çš„æ³¨è§£@EnableScheduling helloworld123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354@Profile(&#123;\"tut1\",\"hello-world\"&#125;)@Configurationpublic class Tut1Config &#123; @Bean public Queue hello()&#123; return new Queue(\"hello\"); &#125; @Profile(\"receiver\") @Bean public Tut1Receiver receiver()&#123; return new Tut1Receiver(); &#125; @Profile(\"sender\") @Bean public Tut1Sender sender()&#123; return new Tut1Sender(); &#125;&#125;// ç›‘å¬helloé˜Ÿåˆ— Annotation that marks a method to be the target of a Rabbit message listener on the// specified queues()æˆ–è€…bindings(). @RabbitListener(queues = \"hello\")public class Tut1Receiver &#123; private static final Logger logger = LoggerFactory.getLogger(Tut1Receiver.class); // Annotation that marks a method to be the target of a Rabbit message // listener within a class that is annotated with &#123;@link RabbitListener&#125; @RabbitHandler public void receive(String in) &#123; logger.info(\"[x] Received:&#123;&#125; \", in); System.out.println(\"[x] Received:&#123;&#125; \"+ in); &#125;&#125;public class Tut1Sender &#123; private final static Logger logger = LoggerFactory.getLogger(Tut1Sender.class); @Autowired private RabbitTemplate rabbitTemplate; @Autowired private Queue queue; @Scheduled(fixedDelay = 1000, initialDelay = 500) public void send() &#123; String msg = \"hello world\"; this.rabbitTemplate.convertAndSend(queue.getName(), msg); logger.info(\"[x] sent :\" + msg); System.out.println(\"[x] sent :\" + msg); &#125;&#125;// java -jar xxx.jar --spring.profiles.active=hello-world,receiver// java -jar xxx.jar --spring.profiles.active=hello-world,sender work-queues12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485@RabbitListener(queues = \"tut.hello\")public class Tut2Receiver &#123; private final static Logger logger = LoggerFactory.getLogger(Tut2Receiver.class); private final int instance; public Tut2Receiver(int i)&#123; this.instance = i; &#125; @RabbitHandler public void receive(String in) throws InterruptedException&#123; StopWatch watch = new StopWatch(); watch.start(); logger.info(\"instance \" + this.instance+\"[x] recived\" + in); doWork(in); watch.stop(); logger.info(\"instance \" + this.instance +\"[x] done\"); &#125; private void doWork(String in) throws InterruptedException&#123; for (char ch:in.toCharArray())&#123; if(ch == '.')&#123; TimeUnit.SECONDS.sleep(1); &#125; &#125; &#125;&#125;public class Tut2Sender &#123; private static Logger logger = LoggerFactory.getLogger(Tut2Sender.class); @Autowired private RabbitTemplate rabbitTemplate; @Autowired private Queue queue; AtomicInteger dots = new AtomicInteger(0); AtomicInteger count = new AtomicInteger(0); @Scheduled(fixedDelay = 1000,initialDelay = 500) public void send()&#123; StringBuilder builder = new StringBuilder(\"hello\"); if(dots.getAndIncrement() == 3)&#123; dots.set(1); &#125; for(int i = 0;i&lt;dots.get();i++)&#123; builder.append(\".\"); &#125; builder.append(count.incrementAndGet()); String msg = builder.toString(); rabbitTemplate.convertAndSend(queue.getName(),msg); logger.info(\"[x] sent &#123;&#125;\",msg); &#125;&#125;@Profile(&#123;\"tut2\",\"work-queues\"&#125;)@Configurationpublic class Tut2Config &#123; @Bean public Queue hello()&#123; return new Queue(\"tut.hello\"); &#125; @Profile(\"receiver\") private static class ReceiverConfig&#123; @Bean public Tut2Receiver receiver1()&#123; return new Tut2Receiver(1); &#125; @Bean public Tut2Receiver receiver2()&#123; return new Tut2Receiver(2); &#125; &#125; @Profile(\"sender\") @Bean public Tut2Sender sender()&#123; return new Tut2Sender(); &#125;&#125; pub-sub123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103@Configuration@Profile(&#123;\"tut3\",\"pub-sub\",\"publish-subscribe\"&#125;)public class Tut3Config &#123; @Bean public FanoutExchange fanout()&#123; return new FanoutExchange(\"tut.fanout\"); &#125; @Profile(\"receiver\") private static class ReceiverConfig&#123; @Bean public Queue autoDeleteQueue1()&#123; return new AnonymousQueue(); &#125; @Bean public Queue autoDeleteQueue2()&#123; return new AnonymousQueue(); &#125; // è¿™ä¸ªåœ°æ–¹å¯èƒ½æ³¨å†Œä¸æˆåŠŸ @Bean public Binding binding1(FanoutExchange fanout,Queue autoDeleteQueue1)&#123; return BindingBuilder.bind(autoDeleteQueue1).to(fanout); &#125; @Bean public Binding binding2(FanoutExchange fanout,Queue autoDeleteQueue2)&#123; return BindingBuilder.bind(autoDeleteQueue2).to(fanout); &#125; @Bean public Tut3Receiver receiver()&#123; return new Tut3Receiver(); &#125; &#125; @Profile(\"sender\") @Bean public Tut3Sender sender()&#123; return new Tut3Sender(); &#125;&#125;public class Tut3Receiver &#123; @RabbitListener(queues = \"#&#123;autoDeleteQueue1.name&#125;\") public void receive1(String in) throws InterruptedException&#123; receive(in,1); &#125; @RabbitListener(queues = \"#&#123;autoDeleteQueue2.name&#125;\") public void receive2(String in) throws InterruptedException&#123; receive(in,2); &#125; public void receive(String in,int receiver) throws InterruptedException&#123; StopWatch watch = new StopWatch(); watch.start(); System.out.println(\"instance \" + receiver + \"[x] Received\" + in); doWork(in); watch.stop(); System.out.println(\"instance\" + receiver + \"[x] Done in\" + watch.getTotalTimeSeconds()+\"s\"); &#125; private void doWork(String in) throws InterruptedException&#123; for(char ch: in.toCharArray())&#123; if(ch == '.')&#123; TimeUnit.SECONDS.sleep(1); &#125; &#125; &#125;&#125;public class Tut3Sender &#123; @Autowired private RabbitTemplate rabbitTemplate; @Autowired private FanoutExchange fanout; AtomicInteger dots = new AtomicInteger(0); AtomicInteger count = new AtomicInteger(0); @Scheduled(fixedDelay = 1000,initialDelay = 500) public void send()&#123; StringBuilder builder = new StringBuilder(\"hello\"); if(dots.getAndIncrement() == 3)&#123; dots.set(1); &#125; for(int i = 0;i &lt; dots.get();i++)&#123; builder.append(\".\"); &#125; builder.append(count.incrementAndGet()); String message = builder.toString(); rabbitTemplate.convertAndSend(fanout.getName(),\"\",message); System.out.println(\"[x] sent\" +message); &#125;&#125; direct123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115@Profile(&#123;\"tut4\",\"routing\"&#125;)@Configurationpublic class Tut4Config &#123; // è®¾ç½®exchange @Bean public DirectExchange direct()&#123; return new DirectExchange(\"tut.direct\"); &#125; @Profile(\"receiver\") private static class ReceiverConfig&#123; // åˆ›å»ºä¸¤ä¸ªåŒ¿åQueue an anonymous, non-durable, exclusive, auto-delete queue @Bean public Queue autoDeleteQueue1()&#123; return new AnonymousQueue(); &#125; @Bean public Queue autoDeleteQueue2()&#123; return new AnonymousQueue(); &#125; // ç»‘å®šç›¸å…³æ•°æ® @Bean public Binding binding1a(DirectExchange directExchange,Queue autoDeleteQueue1)&#123; return BindingBuilder.bind(autoDeleteQueue1).to(directExchange).with(\"orange\"); &#125; @Bean public Binding binding1b(DirectExchange directExchange,Queue autoDeleteQueue1)&#123; return BindingBuilder.bind(autoDeleteQueue1).to(directExchange).with(\"black\"); &#125; @Bean public Binding binding2a(DirectExchange directExchange,Queue autoDeleteQueue2)&#123; return BindingBuilder.bind(autoDeleteQueue2).to(directExchange).with(\"green\"); &#125; @Bean public Binding binding2b(DirectExchange direct,Queue autoDeleteQueue2)&#123; return BindingBuilder.bind(autoDeleteQueue2).to(direct).with(\"black\"); &#125; // @Bean public Tut4Receiver receiver()&#123; return new Tut4Receiver(); &#125; &#125; @Profile(\"sender\") @Bean public Tut4Sender sender()&#123; return new Tut4Sender(); &#125; &#125;public class Tut4Receiver &#123; @RabbitListener(queues = \"#&#123;autoDeleteQueue1.name&#125;\") public void receive1(String in) throws InterruptedException&#123; receive(in,1); &#125; @RabbitListener(queues = \"#&#123;autoDeleteQueue2.name&#125;\") public void receive2(String in) throws InterruptedException&#123; receive(in,2); &#125; public void receive(String in,int receiver) throws InterruptedException&#123; StopWatch watch = new StopWatch(); watch.start(); System.out.println(\"instance \" + receiver+\"[x] received ' \" + in+ \"'\"); doWork(in); watch.stop(); System.out.println(\"instance \"+ receiver+\"[x] Done in\" + watch.getTotalTimeSeconds()+\"s\"); &#125; private void doWork(String in) throws InterruptedException&#123; for(char ch: in.toCharArray())&#123; if(ch == '.')&#123; TimeUnit.SECONDS.sleep(1); &#125; &#125; &#125;&#125;public class Tut4Sender &#123; @Autowired private RabbitTemplate rabbitTemplate; @Autowired private DirectExchange directExchange; AtomicInteger index = new AtomicInteger(0); AtomicInteger count = new AtomicInteger(0); private final String[] keys = &#123;\"orange\", \"black\", \"green\"&#125;; @Scheduled(fixedDelay = 1000, initialDelay = 500) public void send() &#123; StringBuilder builder = new StringBuilder(\"Hello to \"); if (this.index.incrementAndGet() == 3) &#123; this.index.set(0); &#125; String key = keys[this.index.get()]; builder.append(key).append(' '); builder.append(this.count.incrementAndGet()); String message = builder.toString(); rabbitTemplate.convertAndSend(directExchange.getName(), key, message); System.out.println(\"[X] sent '\" + message + \"'\"); &#125;&#125; topic123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109@Profile(&#123;\"tut5\",\"topics\"&#125;)@Configurationpublic class Tut5Config &#123; @Bean public TopicExchange topicExchange()&#123; return new TopicExchange(\"tut.topic\"); &#125; @Profile(\"receiver\") private static class ReceiverConfig&#123; @Bean public Tut5Receiver receiver()&#123; return new Tut5Receiver(); &#125; @Bean public Queue autoDeleteQueue1()&#123; return new AnonymousQueue(); &#125; @Bean public Queue autoDeleteQueue2()&#123; return new AnonymousQueue(); &#125; @Bean public Binding binding1a(TopicExchange topicExchange,Queue autoDeleteQueue1)&#123; return BindingBuilder.bind(autoDeleteQueue1).to(topicExchange).with(\"*.orange.*\"); &#125; @Bean public Binding binding1b(TopicExchange topicExchange,Queue autoDeleteQueue1)&#123; return BindingBuilder.bind(autoDeleteQueue1).to(topicExchange).with(\"*.*.rabbit\"); &#125; @Bean public Binding binding2a(TopicExchange topic,Queue autoDeleteQueue2)&#123; return BindingBuilder.bind(autoDeleteQueue2).to(topic).with(\"lazy.#\"); &#125; &#125; @Profile(\"sender\") @Bean public Tut5Sender sender()&#123; return new Tut5Sender(); &#125;&#125;public class Tut5Receiver &#123; @RabbitListener(queues = \"#&#123;autoDeleteQueue1.name&#125;\") public void receive1(String in) throws InterruptedException &#123; receive(in, 1); &#125; @RabbitListener(queues = \"#&#123;autoDeleteQueue2.name&#125;\") public void receive2(String in) throws InterruptedException &#123; receive(in, 2); &#125; public void receive(String in, int receiver) throws InterruptedException &#123; StopWatch watch = new StopWatch(); watch.start(); System.out.println(\"instance \" + receiver + \" [X] received ' \" + in + \" '\"); doWork(in); watch.stop(); System.out.println(\"instance \" + receiver + \" [X] Done in\" + watch.getTotalTimeSeconds() +\"s\"); &#125; private void doWork(String in) throws InterruptedException&#123; for(char ch : in.toCharArray())&#123; if(ch == '.')&#123; TimeUnit.SECONDS.sleep(1); &#125; &#125; &#125;&#125;public class Tut5Sender &#123; @Autowired private RabbitTemplate rabbitTemplate; @Autowired private TopicExchange topicExchange; AtomicInteger index = new AtomicInteger(0); AtomicInteger count = new AtomicInteger(0); private final String[] keys = &#123;\"quick.orange.rabbit\", \"lazy.orange.elephant\", \"quick.orange.fox\", \"lazy.brown.fox\", \"lazy.pink.rabbit\", \"quick.brown.fox\"&#125;; @Scheduled(fixedDelay = 1000,initialDelay = 500) public void send()&#123; StringBuilder builder = new StringBuilder(\"Hello to \"); if(this.index.incrementAndGet() == keys.length)&#123; this.index.set(0); &#125; String key = keys[this.index.get()]; builder.append(key).append(\" \"); builder.append(this.count.incrementAndGet()); String message = builder.toString(); rabbitTemplate.convertAndSend(topicExchange.getName(),key,message); &#125;&#125;","categories":[{"name":"rabbitmq","slug":"rabbitmq","permalink":"http://yoursite.com/categories/rabbitmq/"}],"tags":[{"name":"RabbitMQ","slug":"RabbitMQ","permalink":"http://yoursite.com/tags/RabbitMQ/"}]},{"title":"RabbitMQ-topic","slug":"RabbitMQ-topic","date":"2020-03-13T02:35:52.000Z","updated":"2020-03-13T05:53:59.511Z","comments":true,"path":"2020/03/13/RabbitMQ-topic/","link":"","permalink":"http://yoursite.com/2020/03/13/RabbitMQ-topic/","excerpt":"","text":"Topicåœ¨ä¹‹å‰çš„ä¸€ç¯‡æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ”¹è¿›äº†æ—¥å¿—ç³»ç»Ÿã€‚æˆ‘ä»¬ä½¿ç”¨directç›´æ¥å¹¿æ’­ï¼Œè€Œä¸æ˜¯ä½¿ç”¨fanout,ä»è€Œè·å¾—äº†é€‰æ‹©æ€§æ¥æ”¶æ—¥å¿—çš„å¯èƒ½æ€§ã€‚ è™½ç„¶ä½¿ç”¨direct exchangeæ”¹è¿›äº†æˆ‘ä»¬çš„ç³»ç»Ÿï¼Œä½†å®ƒä»»ç„¶æœ‰å±€é™æ€§â€“å®ƒä¸èƒ½åŸºäºå¤šä¸ªæ ‡å‡†è¿›è¡Œè·¯ç”±ã€‚ Topic exchangeæ¶ˆæ¯å‘é€åˆ°topic exchangeä¸èƒ½æ˜¯ä¸€ä¸ªéšæ„çš„routing-keyã€‚å®ƒå¿…é¡»æ˜¯ä¸€ä¸ªç”±.åˆ†å‰²å•çº¯åˆ—è¡¨ã€‚ ä¾‹å¦‚stock.usd.nyseã€nyse.vmwã€quick.orange.rabbitç­‰ã€‚routing-keyå¯ä»¥æœ‰å°½å¯èƒ½å¤šï¼Œä½†æ˜¯æœ€å¤š255å­—èŠ‚ã€‚ ç»‘å®šé”®å¿…é¡»é‡‡ç”¨ç›¸åŒçš„å½¢å¼ã€‚topic exchangeå’Œdirect exchangeç±»ä¼¼-ä½¿ç”¨ç‰¹å®šroutig keyå‘é€çš„æ¶ˆæ¯ä¼šè¢«ä¼ é€’åˆ°åŒ¹é…binding keyçš„é˜Ÿåˆ—é‡Œé¢ã€‚ä½†æ˜¯ï¼Œå¯¹äºrouting keyæœ‰ä¸¤ä¸ªç‰¹æ®Šæƒ…å†µ * (starï¼‰å¯ä»¥æ›¿ä»£ä¸€ä¸ªå•è¯ `#``(hash) å¯ä»¥ä»£æ›¿0ä¸ªæˆ–å¤šä¸ªå•è¯ Topic exchangeTopic exchangeæ˜¯éå¸¸å‰å®³çš„å¹¶ä¸”å¯ä»¥è¡¨ç°å’Œå…¶ä»–exchangeä¸€æ ·çš„ å½“ä¸€ä¸ªé˜Ÿåˆ—æ˜¯ç”¨#ç»‘å®šï¼Œé‚£ä¹ˆå°±ä¼šæ¥å—åˆ°æ‰€æœ‰ä¿¡æ¯ï¼Œä¸ç®¡routing-keyæ˜¯ä»€ä¹ˆï¼Œå°±åƒfanout å½“ç»‘å®šä¸­ä¸ä½¿ç”¨*å’Œ#ç­‰ç‰¹æ®Šå­—ç¬¦ï¼Œtopic exchangeå°±ä¼šåƒdirect exchange Sender.java12345678910111213141516171819public class Send &#123; private final static String EXCHANGE_NAME = \"test_exchange_topic\"; public static void main(String[] args) throws IOException, TimeoutException &#123; // åˆ›å»ºè¿æ¥ Connection connection = ConnectionUtils.getConnection(); Channel channel = connection.createChannel(); //å£°æ˜exchange channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.TOPIC); // æ¶ˆæ¯å†…å®¹ String msg = \"hello world!\"; channel.basicPublish(EXCHANGE_NAME,\"routekey1.1\",null,msg.getBytes()); channel.close(); connection.close(); &#125;&#125; rece1.java12345678910111213141516171819202122232425262728293031323334353637public class Rece1 &#123; private final static String EXCHANGE_NAME = \"test_exchange_topic\"; public static void main(String[] args) throws IOException, TimeoutException &#123; Connection connection = ConnectionUtils.getConnection(); Channel channel = connection.createChannel(); // String queueName = channel.queueDeclare().getQueue();// // å£°æ˜é˜Ÿåˆ—// channel.queueDeclare(queueName,false,false,false,null); //ç»‘å®šé˜Ÿåˆ—åˆ°äº¤æ¢æœºä¸Š channel.queueBind(queueName,EXCHANGE_NAME,\"routekey.*\"); //åŒä¸€æ—¶åˆ»æœåŠ¡å™¨åªå‘é€ä¸€æ¡æ¶ˆæ¯ channel.basicQos(1); Consumer consumer = new DefaultConsumer(channel)&#123; @Override public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException &#123; String msg = new String(body,\"utf-8\"); System.out.println(\"rece1 :\" + msg); try &#123; TimeUnit.SECONDS.sleep(2); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125;finally &#123; System.out.println(\"rece1 done\"); channel.basicAck(envelope.getDeliveryTag(),false); &#125; &#125; &#125;; channel.basicConsume(queueName,false,consumer); &#125;&#125; rece2.java1234567891011121314151617181920212223242526272829303132333435public class Rece2 &#123; private final static String QUEUE_NAME = \"test_queue_topic_work_2\"; private final static String EXCHANGE_NAME = \"test_exchange_topic\"; public static void main(String[] args) throws IOException, TimeoutException &#123; Connection connection = ConnectionUtils.getConnection(); Channel channel = connection.createChannel(); // å£°æ˜é˜Ÿåˆ— channel.queueDeclare(QUEUE_NAME,false,false,false,null); //ç»‘å®šé˜Ÿåˆ—åˆ°äº¤æ¢æœºä¸Š channel.queueBind(QUEUE_NAME,EXCHANGE_NAME,\"*.*\"); //åŒä¸€æ—¶åˆ»æœåŠ¡å™¨åªå‘é€ä¸€æ¡æ¶ˆæ¯ channel.basicQos(1); Consumer consumer = new DefaultConsumer(channel)&#123; @Override public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException &#123; String msg = new String(body,\"utf-8\"); System.out.println(\"rece1 :\" + msg); try &#123; TimeUnit.SECONDS.sleep(2); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125;finally &#123; System.out.println(\"rece1 done\"); channel.basicAck(envelope.getDeliveryTag(),false); &#125; &#125; &#125;; channel.basicConsume(QUEUE_NAME,false,consumer); &#125;&#125;","categories":[{"name":"rabbitmq","slug":"rabbitmq","permalink":"http://yoursite.com/categories/rabbitmq/"}],"tags":[{"name":"RabbitMQ","slug":"RabbitMQ","permalink":"http://yoursite.com/tags/RabbitMQ/"}]},{"title":"RabbitMQ-routing","slug":"RabbitMQ-routing","date":"2020-03-09T10:42:59.000Z","updated":"2020-03-11T06:44:48.784Z","comments":true,"path":"2020/03/09/RabbitMQ-routing/","link":"","permalink":"http://yoursite.com/2020/03/09/RabbitMQ-routing/","excerpt":"","text":"routingåœ¨ä¹‹å‰çš„å¯¼èˆªä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•æ—¥å¿—ç³»ç»Ÿï¼Œæˆ‘ä»¬èƒ½å¤Ÿå°†æ—¥å¿—ä¿¡æ¯å¹¿æ’­åˆ°å¾ˆå¤šæ¥å—è€…ã€‚ åœ¨æœ¬ç¯‡å¯¼èˆªä¸­ï¼Œæˆ‘ä»¬å°†ä¸ºå…¶æ·»åŠ ä¸€ä¸ªç‰¹æ€§-æˆ‘ä»¬å°†ä½¿è®¢é˜…æ¶ˆæ¯çš„ä¸€ä¸ªå­é›†æˆä¸ºå¯èƒ½ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå°†é”™è¯¯ä¿¡æ¯å®šå‘å†™å…¥é”™è¯¯æ—¥å¿—æ–‡ä»¶ï¼ŒåŒæ—¶èƒ½å¤Ÿåœ¨æ§åˆ¶å°æ‰“å°æ‰€æœ‰ä¿¡æ¯ã€‚ bindingåœ¨ä¹‹å‰çš„ä¾‹å­ä¸­æˆ‘ä»¬èƒ½å¤Ÿåˆ›å»ºç»‘å®šï¼Œä½ å¯èƒ½ä¼šå›æƒ³èµ·è¿™æ ·çš„ä»£ç  1channel.queueBind(queueName, EXCHANGE_NAME, &quot;&quot;); ç»‘å®šæ˜¯äº¤æ¢å’Œé˜Ÿåˆ—ä¹‹é—´çš„å…³ç³»ã€‚è¿™å¯ä»¥ç®€å•åœ°ç†è§£ï¼šé˜Ÿåˆ—å¯¹æ¥è‡ªè¿™ä¸ªäº¤æ¢çš„æ¶ˆæ¯æ„Ÿå…´è¶£ã€‚ ç»‘å®šå¯ä»¥ä½¿ç”¨é¢å¤–çš„routingKeyå‚æ•°ã€‚ä¸ºäº†é¿å…ä¸åŸºæœ¬çš„å‘å¸ƒå‚æ•°æ··æ·†ï¼Œæˆ‘ä»¬å°†å…¶ç§°ä¸ºç»‘å®šé”®ã€‚è¿™å°±æ˜¯æˆ‘ä»¬å¦‚ä½•é”®åˆ›å»ºç»‘å®šçš„æ–¹æ³•ã€‚ 1channel.queueBind(queueName, EXCHANGE_NAME, &quot;black&quot;); ç»‘å®šé”®çš„æ„ä¹‰å–å†³äºäº¤æ¢ç±»å‹ã€‚æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨çš„fanoutäº¤æ¢æœºå®Œå…¨å¿½ç•¥äº†å®ƒçš„ä»·å€¼ã€‚ Direct exchangeæˆ‘ä»¬ä¹‹å‰ä½¿ç”¨çš„fanoutexchange,è¿™å¹¶æ²¡æœ‰ç»™æˆ‘ä»¬å¤šå¤§çš„çµæ´»æ€§â€”â€”å®ƒåªèƒ½è¿›è¡Œä¸éœ€è¦åŠ¨è„‘ç­‹çš„å¹¿æ’­ã€‚æˆ‘ä»¬å°†ç”¨directexchange.æ¶ˆæ¯å¯ä»¥ä¼ é€’åˆ°å…¶ç»‘å®šé”®bindingKeyä¸æ¶ˆæ¯çš„è·¯ç”±é”®routingkeyå®Œå…¨åŒ¹é…çš„é˜Ÿåˆ— æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œé¢errorå¯ä»¥å‘é€åˆ°amqp.gen-S9b...å’Œamqp.gen-Ag1...é˜Ÿåˆ—ä¸­,è€Œinfoå’Œwaringåªèƒ½å‘é€åˆ°amqp.gen-Ag1...é˜Ÿåˆ—ä¸­ Send.java 1234567891011121314151617public class Send &#123; private static final String EXCHANGE_NAME = \"test_exchange_direct\"; public static void main(String[] args) throws IOException, TimeoutException &#123; Connection connection = ConnectionUtils.getConnection(); // åˆ›å»ºchannle Channel channel = connection.createChannel(); // å£°æ˜exchange channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.DIRECT); String msg = \"hello exchange direct\"; String routingKey = \"error\"; channel.basicPublish(EXCHANGE_NAME, routingKey, null, msg.getBytes()); channel.close(); connection.close(); &#125;&#125; Rece1.java 1234567891011121314151617181920212223242526272829303132public class Rece1 &#123; private static final String EXCHANGE_NAME = \"test_exchange_direct\"; private static final String QUEUE_NAME = \"test_queue_direct1\"; public static void main(String[] args) throws IOException, TimeoutException &#123; Connection connection = ConnectionUtils.getConnection(); Channel channel = connection.createChannel(); channel.queueDeclare(QUEUE_NAME,false,false,false,null); channel.queueBind(QUEUE_NAME,EXCHANGE_NAME,\"error\"); channel.basicQos(1); Consumer consumer = new DefaultConsumer(channel)&#123; @Override public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException &#123; String msg = new String(body,\"utf-8\"); System.out.println(\"rece1 recieve msg :\" + msg); try&#123; TimeUnit.SECONDS.sleep(2); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125;finally &#123; System.out.println(\"rece1 done\"); channel.basicAck(envelope.getDeliveryTag(),false); &#125; &#125; &#125;; channel.basicConsume(QUEUE_NAME,false,consumer); &#125;&#125; Rece2.java 123456789101112131415161718192021222324252627282930public class Rece1 &#123; private static final String EXCHANGE_NAME = \"test_exchange_direct\"; private static final String QUEUE_NAME = \"test_queue_direct1\"; public static void main(String[] args) throws IOException, TimeoutException &#123; Connection connection = ConnectionUtils.getConnection(); Channel channel = connection.createChannel(); channel.queueDeclare(QUEUE_NAME,false,false,false,null); channel.queueBind(QUEUE_NAME,EXCHANGE_NAME,\"error\"); channel.basicQos(1); Consumer consumer = new DefaultConsumer(channel)&#123; @Override public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException &#123; String msg = new String(body,\"utf-8\"); System.out.println(\"rece1 recieve msg :\" + msg); try&#123; TimeUnit.SECONDS.sleep(2); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125;finally &#123; System.out.println(\"rece1 done\"); channel.basicAck(envelope.getDeliveryTag(),false); &#125; &#125; &#125;; channel.basicConsume(QUEUE_NAME,false,consumer); &#125;&#125; å¶å°”æŠ¥é”™é˜Ÿåˆ—ç»‘å®šäº¤æ¢æœºæ—¶ï¼ŒroutingKeyæ˜¯å…·æœ‰ç¼“å­˜æœºåˆ¶çš„ã€‚æˆ‘åœ¨å†™ä»£ç çš„æ—¶å€™ï¼Œè¯¯æ“ä½œäº†å°†é˜Ÿåˆ—éƒ½ç»‘å®šäº†errorï¼Œinfo,warning.æˆ‘å‘ç°æ— æ³•å®ç°ä¸Šè¿°çš„æ•ˆæœï¼Œæ”¹äº†ä»£ç ï¼Œä½†æ˜¯è¿˜æ˜¯æ— æ³•è§£å†³ã€‚æœ€åç™»å½•äº†RabbitMQæŸ¥çœ‹ç›¸å…³ç»‘å®šã€‚å¹¶ä½¿ç”¨çš„unbindåŠŸèƒ½ã€‚","categories":[{"name":"rabbitmq","slug":"rabbitmq","permalink":"http://yoursite.com/categories/rabbitmq/"}],"tags":[{"name":"RabbitMQ","slug":"RabbitMQ","permalink":"http://yoursite.com/tags/RabbitMQ/"}]},{"title":"RabbitMQ-å‘å¸ƒ/è®¢é˜…","slug":"RabbitMQ-å‘å¸ƒ-è®¢é˜…","date":"2020-03-01T09:23:16.000Z","updated":"2020-03-11T07:22:28.053Z","comments":true,"path":"2020/03/01/RabbitMQ-å‘å¸ƒ-è®¢é˜…/","link":"","permalink":"http://yoursite.com/2020/03/01/RabbitMQ-%E5%8F%91%E5%B8%83-%E8%AE%A2%E9%98%85/","excerpt":"","text":"å‘å¸ƒä¸è®¢é˜…åœ¨ä¸Šä¸€ä¸ªæ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå·¥ä½œé˜Ÿåˆ—ï¼Œæˆ‘ä»¬å°†æ¯ä¸ªäººç‰©ï¼Œæœ€ç»ˆæ°å¥½åˆ†é…åˆ°ä¸€ä¸ªå·¥äººã€‚ç„¶è€Œï¼Œåœ¨è¿™ä¸ªéƒ¨åˆ†ï¼Œæˆ‘ä»¬å¸Œæœ›æ¯ä¸ªæ¶ˆæ¯èƒ½åˆ†é…ç»™å¤šä¸ªæ¶ˆè´¹è€…ã€‚è¿™ç§å«å‘å¸ƒè®¢é˜…æ¨¡å¼ã€‚ä¸¾ä¾‹ï¼Œæ³¨å†Œæ—¶éœ€è¦åŒæ—¶å‘é€çŸ­ä¿¡å’Œå‘é€email,æˆ‘ä»¬ä¼šå°†ç”¨æˆ·æ³¨å†Œçš„ä¿¡æ¯å‘ç»™ä¸¤ä¸ªæ¶ˆè´¹è€…ï¼Œä¸€ä¸ªä¸“é—¨å‘é€çŸ­ä¿¡æ¶ˆè´¹è€…ï¼Œä¸€ä¸ªä¸“é—¨å‘é€emailæ¶ˆè´¹è€…ã€‚ RabbitMQæ¶ˆæ¯ä¼ é€’æ¨¡å‹çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œç”Ÿäº§è€…ä¸ç›´æ¥æƒ³æ¶ˆæ¯é˜Ÿåˆ—å‘é€ä¿¡æ¯ã€‚å®é™…ä¸Šï¼Œç”Ÿäº§è€…å¹¶ä¸çŸ¥é“æ¶ˆæ¯æ˜¯å¦ä¼šè¢«ä¼ é€’åˆ°ä»»ä½•é˜Ÿåˆ—ä¸Šã€‚ äº¤æ¢æœºè¿™é‡Œå°±è®²åˆ°ä¸€ä¸ªæ–°å‹æ¦‚å¿µï¼Œäº¤æ¢æœºï¼ˆexchangeï¼‰,ä¸€æ–¹é¢æ¥æ”¶ç”Ÿäº§è€…çš„ä¿¡æ¯ï¼Œä¸€æ–¹é¢æ¨é€ç»™é˜Ÿåˆ—ã€‚äº¤æ¢å™¨å¿…é¡»ç¡®åˆ‡åœ°çŸ¥é“å¦‚ä½•å¤„ç†å®ƒæ¥æ”¶åˆ°çš„æ¶ˆæ¯ã€‚å®ƒåº”è¯¥è¢«é™„åŠ åˆ°ä¸€ä¸ªç‰¹å®šçš„é˜Ÿåˆ—å—?å®ƒåº”è¯¥è¢«æ·»åŠ åˆ°è®¸å¤šé˜Ÿåˆ—ä¸­å—?æˆ–è€…å®ƒåº”è¯¥è¢«ä¸¢å¼ƒã€‚è¿™äº›è§„åˆ™ç”±exchangeç±»å‹å®šä¹‰ã€‚æœ‰å‡ ç§å¯ç”¨çš„äº¤æ¢ç±»å‹:directã€topicã€headerså’Œfanoutã€‚ä¸‹é¢è®²ï¼šfanoutï¼Œæ˜¯ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„ç±»å‹ã€‚åªæ˜¯å°†æ¶ˆæ¯å¹¿æ’­åˆ°å®ƒçŸ¥é“çš„æ‰€æœ‰é˜Ÿåˆ—ä¸­å»ã€‚ä¸‹å›¾ä¸­Xå°±æ˜¯äº¤æ¢æœºã€‚ ç”Ÿäº§è€…12345678910111213141516public class Send &#123; private final static String EXCHANGE_NAME &#x3D; &quot;test_exchange_fanout&quot;; public static void main(String[] args) throws IOException, TimeoutException &#123; Connection connection &#x3D; ConnectionUtils.getConnection() ; Channel channel &#x3D; connection.createChannel(); &#x2F;&#x2F; å£°æ˜é˜Ÿåˆ— channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.FANOUT);&#x2F;&#x2F;åˆ†å‘ç±»å‹fanout String msg &#x3D; &quot;hello world ps&quot;; &#x2F;&#x2F; å‘é€ä¿¡æ¯ channel.basicPublish(EXCHANGE_NAME,&quot;&quot;,null,msg.getBytes()); System.out.println(&quot;send success&quot;); &#x2F;&#x2F; å…³é—­æµ channel.close(); connection.close(); &#125;&#125; æ¶ˆè´¹è€…12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152public class Rece1 &#123; private final static String QUEUE_NAME &#x3D; &quot;test_queu_email&quot;; private final static String EXCHANGE_NAME &#x3D; &quot;test_exchange_fanout&quot;; public static void main(String[] args) throws IOException, TimeoutException &#123; Connection connection &#x3D; ConnectionUtils.getConnection(); Channel channel &#x3D; connection.createChannel(); &#x2F;&#x2F; ç»‘å®šé˜Ÿåˆ— channel.queueDeclare(QUEUE_NAME, false, false, false, null); &#x2F;&#x2F; ç»‘å®šé˜Ÿåˆ—åˆ°äº¤æ¢æœºä¸Š channel.queueBind(QUEUE_NAME, EXCHANGE_NAME, &quot;&quot;); &#x2F;&#x2F;qos&#x3D;1 channel.basicQos(1); DefaultConsumer consumer &#x3D; new DefaultConsumer(channel) &#123; @Override public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException &#123; System.out.println(&quot;send email &quot; + new String(body, Charset.defaultCharset())); channel.basicAck(envelope.getDeliveryTag(), false); &#125; &#125;; boolean autoAck &#x3D; false; channel.basicConsume(QUEUE_NAME, autoAck, consumer); &#125;&#125;public class Rece2 &#123; private final static String QUEUE_NAME &#x3D; &quot;test_queu_msg&quot;; private final static String EXCHANGE_NAME &#x3D; &quot;test_exchange_fanout&quot;; public static void main(String[] args) throws IOException, TimeoutException &#123; Connection connection &#x3D; ConnectionUtils.getConnection(); Channel channel &#x3D; connection.createChannel(); &#x2F;&#x2F; ç»‘å®šé˜Ÿåˆ— channel.queueDeclare(QUEUE_NAME, false, false, false, null); &#x2F;&#x2F; ç»‘å®šé˜Ÿåˆ—åˆ°äº¤æ¢æœºä¸Š channel.queueBind(QUEUE_NAME, EXCHANGE_NAME, &quot;&quot;); &#x2F;&#x2F;qos&#x3D;1 channel.basicQos(1); DefaultConsumer consumer &#x3D; new DefaultConsumer(channel) &#123; @Override public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException &#123; System.out.println(&quot;send msg &quot; + new String(body, Charset.defaultCharset())); channel.basicAck(envelope.getDeliveryTag(), false); &#125; &#125;; boolean autoAck &#x3D; false; channel.basicConsume(QUEUE_NAME, autoAck, consumer); &#125;&#125; å®˜æ–¹æ¨èçš„queue_nameå®˜æ–¹å¸Œæœ›èƒ½å¤Ÿå®ç°ï¼Œç”Ÿæˆå”¯ä¸€åç§°queue_name,å¹¶ä¸”ä¸€æ—¦æ–­å¼€ç”Ÿäº§è€…è¿æ¥ï¼Œé˜Ÿåˆ—è‡ªåŠ¨åˆ é™¤ã€‚ 1String queueName &#x3D; channel.queueDeclare().getQueue();","categories":[{"name":"rabbitmq","slug":"rabbitmq","permalink":"http://yoursite.com/categories/rabbitmq/"}],"tags":[{"name":"RabbitMQ","slug":"RabbitMQ","permalink":"http://yoursite.com/tags/RabbitMQ/"}]},{"title":"å·¥ä½œé˜Ÿåˆ—","slug":"å·¥ä½œé˜Ÿåˆ—","date":"2020-02-20T10:01:40.000Z","updated":"2020-03-11T07:22:27.993Z","comments":true,"path":"2020/02/20/å·¥ä½œé˜Ÿåˆ—/","link":"","permalink":"http://yoursite.com/2020/02/20/%E5%B7%A5%E4%BD%9C%E9%98%9F%E5%88%97/","excerpt":"","text":"ä»‹ç»RabbitMQæ˜¯æ¶ˆæ¯ä»£ç†ã€‚å®ƒæ¥æ”¶ä¿¡æ¯å’Œè½¬å‘ä¿¡æ¯ã€‚ä½ å¯ä»¥æŠŠä»–è€ƒè™‘æˆä¸€ä¸ªé‚®å±€ã€‚å½“ä½ è®²é‚®å¯„çš„ä¿¡æ”¾åœ¨é‚®å±€æ—¶ï¼Œä½ å¯ä»¥ç¡®å®šé‚®å·®å…ˆç”Ÿæˆ–è€…å¥³å£«ä¼šæŠŠé‚®ä»¶æœ€ç»ˆé€åˆ°ä½ çš„æ”¶ä»¶äººæ‰‹ä¸­ã€‚å½“ç„¶é‚®å±€å’ŒRabbitMQæœ€å¤§çš„åŒºåˆ«ï¼ŒRabbitMqä¸æ¥å—çº¸å¼ ï¼Œå®ƒåªæ¥æ”¶ï¼Œå­˜å‚¨ï¼Œè½¬å‘äºŒè¿›åˆ¶çš„æ•°æ®æ¶ˆæ¯å¿«ã€‚ ä¸‹é¢è®²ä¸€äº›RabbitMQä¸­çš„æœ¯è¯­ï¼š Producer ç”Ÿæˆåªä¸è¿‡æ„å‘³ç€å‘é€ä¿¡æ¯ã€‚å‘é€ä¿¡æ¯çš„ç¨‹åºæ˜¯ç”Ÿäº§è€… Queue é˜Ÿåˆ—æ˜¯é©»ç•™åœ¨RabbitMQå†…çš„é‚®ç®±çš„åç§°ã€‚å°½ç®¡æ¶ˆæ¯flow RabbitMQå’Œä½ çš„ç¨‹åºï¼Œä½†æ˜¯ä»–ä»¬åªèƒ½å­˜å‚¨åœ¨é˜Ÿåˆ—ä¸­ã€‚ä¸€ä¸ªé˜Ÿåˆ—åªå—ä¸»æœºçš„å†…å­˜å’Œç£ç›˜é™åˆ¶ï¼Œå®ƒçš„æœ¬è´¨æ˜¯ä¸€ä¸ªå¤§çš„æ¶ˆæ¯ç¼“å†²åŒºã€‚è®¸å¤šæ¶ˆè´¹è€…å¯ä»¥å°†æ¶ˆæ¯å‘é€åˆ°ä¸€ä¸ªé˜Ÿåˆ—ï¼Œè®¸å¤šæ¶ˆè´¹è€…å¯ä»¥å°è¯•ä»ä¸€ä¸ªé˜Ÿåˆ—æ¥æ”¶æ•°æ®ï¼Œè¿™å°±æˆ‘ä»¬è¡¨ç¤ºé˜Ÿåˆ—çš„æ–¹å¼ã€‚ Consumer æ¶ˆè´¹å’Œæ¥æ”¶æœ‰ç›¸åŒçš„æ„ä¹‰ã€‚æ¶ˆè´¹è€…æ˜¯ä¸€ä¸ªä¸»è¦æ¥æ”¶æ¶ˆæ¯çš„ç¨‹åº æ³¨æ„ï¼šç”Ÿäº§è€…ã€æ¶ˆè´¹è€…å’Œä»£ç†ä¸å¿…éƒ½åœ¨åŒä¸€ä¸»æœºä¸Šï¼›å®é™…ä¸Šï¼Œåœ¨å¤§å¤šæ•°åº”ç”¨ç¨‹åºä¸­ï¼Œå®ƒä»¬å¹¶æ²¡æœ‰è¿™æ ·åšã€‚åº”ç”¨ç¨‹åºæ—¢å¯ä»¥æ˜¯ç”Ÿæˆè€…ä¹Ÿå¯ä»¥æ˜¯æ¶ˆè´¹è€…ã€‚ ç®€å•é˜Ÿåˆ—ç®€å•é˜Ÿåˆ—ï¼Œå°±æ˜¯å‘é€å•ä¸ªæ¶ˆæ¯çš„æ¶ˆè´¹è€…å’Œæ¥æ”¶ä¿¡æ¯å¹¶å°†å…¶æ‰“å°å‡ºæ¥çš„ä½¿ç”¨è€…ï¼ˆæ¶ˆè´¹è€…ï¼‰ï¼Œä¸å¤šå™è¿°ã€‚ å·¥ä½œé˜Ÿåˆ—å·¥ä½œé˜Ÿåˆ—ä¸»è¦æ˜¯é¿å…çŸ­æ—¶é—´å†…æ‰§è¡Œå¯†é›†ä»»åŠ¡ï¼Œå¹¶ä¸”å¿…é¡»ç­‰å¾…å®ƒå®Œæˆã€‚æˆ‘ä»¬å°†ä»»åŠ¡æ”¾åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œå¯åŠ¨å¤šä¸ªæ¶ˆè´¹è€…ï¼Œä»»åŠ¡åœ¨ä»–ä»¬ä¸­æ˜¯å…±äº«çš„ã€‚ è®¾è®¡åˆ°å·¥ä½œé˜Ÿåˆ—ï¼Œå½“ç„¶ä¼šæœ‰ä¸åŒæ–¹å¼çš„å·¥ä½œé˜Ÿåˆ— ackå…³äºackè¿™è¾¹å¤šè®²ä¸€ç‚¹ï¼Œmessage acknowledgmentæ˜¯æ¶ˆæ¯ç¡®è®¤ï¼Œè®¾ç½®autoack=trueä¹‹åï¼Œconsumerè¿”å›ä¸€ä¸ªackï¼ˆnowledgementï¼‰,å‘Šè¯‰rabbitMQå·²ç»æ¥å—ä¿¡æ¯ï¼Œå¤„ç†äº†ç‰¹å®šçš„æ¶ˆæ¯ï¼ŒRabbitMQå¯ä»¥è‡ªç”±åœ°åˆ é™¤å®ƒã€‚ è½®è¯¢é˜Ÿåˆ—ï¼ˆRound-robin dispatchingï¼‰å°†autoAckè®¾ç½®ä¸ºtrue,é»˜è®¤æƒ…å†µä¸‹ï¼ŒRabbitMQä¼šå‘é€æ¯æ¡ä¿¡æ¯ç»™å¦ä¸€ä¸ªæ¶ˆè´¹è€…ã€‚æ¯ä¸ªæ¶ˆè´¹è€…éƒ½ä¼šè·å–ç›¸åŒæ•°é‡çš„ã€‚å¹¶ä¸”æ˜¯é—´éš”å½¢å¼çš„ã€‚å¦‚æœ‰c1,c2æ¶ˆè´¹è€…ï¼Œ10æ¡æ¶ˆæ¯ï¼Œc1æ˜¯0,2,4,6,8ï¼Œc2æ˜¯1,3,5,7,9ã€‚å½“ç„¶ï¼Œåœ¨æˆ‘æ‰“æ–­ç‚¹æ—¶ï¼Œå‘ç°å¯¹åº”çš„æ•°æ®ä¼šéƒ½ä¸€æ¬¡æ€§å‘é€åˆ°c1ï¼Œå’Œc2ï¼Œc1å’Œc2å¤„ç†ä¿¡æ¯æ—¶ï¼Œå¹¶ä¸å½±å“å½¼æ­¤ã€‚ å…¬å¹³é˜Ÿåˆ—åœ¨RabbitMQåˆ†å‘ä¿¡æ¯çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šå‘ç°ï¼Œä¸€ä¸ªconsumerå¾ˆå¿™ï¼Œå¦ä¸€ä¸ªä¸€ç‚¹ä¹Ÿä¸å¿™ã€‚å› ä¸ºRabbitMQå¯¹æ­¤ä¸€æ— æ‰€çŸ¥ï¼Œåªæ˜¯å°†ç¬¬Næ¡ä¿¡æ¯ï¼Œå‘é€ç»™ç¬¬Nconsumer. ä¸ºäº†è§£å†³è¿™ä¸ªï¼Œæˆ‘ä»¬å°†basicQosæ–¹æ³•å’ŒprefetechCount=1è®¾ç½®ä¸€èµ·ç”¨ã€‚æ¢å¥è¯è¯´ï¼Œåœ¨å¤„ç†å¹¶ç¡®è®¤ä¸Šä¸€æ¡ä¿¡æ¯ä¹‹å‰ï¼Œä¸è¦å°†æ–°ä¿¡æ¯å‘é€ç»™å·¥äººã€‚ 12int prefetchCount = 1;channel.basicQos(prefetchCount); å¹¶ä¸”ï¼Œæˆ‘ä»¬éœ€è¦å°†autoAckè®¾ä¸ºfalseå’Œå¤„ç†å®Œä¸€æ¡æ¶ˆæ¯åå‘é€ackç»™RabbitMQ 12345678910111213141516DefaultConsumer defaultConsumer = new DefaultConsumer(channel)&#123; @Override public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException &#123; String msg = new String(body, \"utf-8\"); System.out.println(\"receive1 : \" + msg); try &#123; Thread.sleep(2000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125;finally &#123; channel.basicAck(envelope.getDeliveryTag(),false); &#125; &#125; &#125;; boolean autoack = false; channel.basicConsume(QUEUE_NAME,autoack,defaultConsumer);","categories":[{"name":"rabbitmq","slug":"rabbitmq","permalink":"http://yoursite.com/categories/rabbitmq/"}],"tags":[{"name":"RabbitMQ","slug":"RabbitMQ","permalink":"http://yoursite.com/tags/RabbitMQ/"}]},{"title":"0109 ä»€ä¹ˆæ˜¯å¾®æœåŠ¡","slug":"0109-ä»€ä¹ˆæ˜¯å¾®æœåŠ¡","date":"2020-01-10T03:52:53.000Z","updated":"2020-01-10T06:32:53.291Z","comments":true,"path":"2020/01/10/0109-ä»€ä¹ˆæ˜¯å¾®æœåŠ¡/","link":"","permalink":"http://yoursite.com/2020/01/10/0109-%E4%BB%80%E4%B9%88%E6%98%AF%E5%BE%AE%E6%9C%8D%E5%8A%A1/","excerpt":"å¾®æœåŠ¡æ¶æ„é£æ ¼ï¼Œå°±åƒæ˜¯æŠŠä¸€ä¸ªå•ç‹¬çš„åº”ç”¨ç¨‹åºå¼€å‘ä¸ºä¸€å¥—å°æœåŠ¡ï¼Œæ¯ä¸ªå°æœåŠ¡è¿è¡Œåœ¨è‡ªå·±çš„è¿›ç¨‹ä¸­ï¼Œå¹¶ä½¿ç”¨è½»é‡çº§æœºåˆ¶é€šä¿¡ï¼Œé€šå¸¸æ˜¯HTTP API.è¿™äº›æœåŠ¡å›´ç»•ä¸šåŠ¡èƒ½åŠ›æ¥æ„å»ºï¼Œå¹¶é€šè¿‡å®Œå…¨è‡ªåŠ¨åŒ–éƒ¨ç½²æœºåˆ¶æ¥ç‹¬ç«‹éƒ¨ç½²ã€‚è¿™äº›æœåŠ¡ä½¿ç”¨ä¸åŒçš„ç¼–ç¨‹è¯­è¨€ä¹¦å†™ï¼Œä»¥åŠä¸åŒæ•°æ®å­˜å‚¨æŠ€æœ¯ï¼Œå¹¶ä¿æŒæœ€ä½é™åº¦çš„é›†ä¸­å¼ç®¡ç†ã€‚","text":"å¾®æœåŠ¡æ¶æ„é£æ ¼ï¼Œå°±åƒæ˜¯æŠŠä¸€ä¸ªå•ç‹¬çš„åº”ç”¨ç¨‹åºå¼€å‘ä¸ºä¸€å¥—å°æœåŠ¡ï¼Œæ¯ä¸ªå°æœåŠ¡è¿è¡Œåœ¨è‡ªå·±çš„è¿›ç¨‹ä¸­ï¼Œå¹¶ä½¿ç”¨è½»é‡çº§æœºåˆ¶é€šä¿¡ï¼Œé€šå¸¸æ˜¯HTTP API.è¿™äº›æœåŠ¡å›´ç»•ä¸šåŠ¡èƒ½åŠ›æ¥æ„å»ºï¼Œå¹¶é€šè¿‡å®Œå…¨è‡ªåŠ¨åŒ–éƒ¨ç½²æœºåˆ¶æ¥ç‹¬ç«‹éƒ¨ç½²ã€‚è¿™äº›æœåŠ¡ä½¿ç”¨ä¸åŒçš„ç¼–ç¨‹è¯­è¨€ä¹¦å†™ï¼Œä»¥åŠä¸åŒæ•°æ®å­˜å‚¨æŠ€æœ¯ï¼Œå¹¶ä¿æŒæœ€ä½é™åº¦çš„é›†ä¸­å¼ç®¡ç†ã€‚ å¾®æœåŠ¡ä¸ºä»€ä¹ˆè¦ä½¿ç”¨Spring Cloudä»ä½¿ç”¨nginxè¯´èµ·æœ€åˆçš„æœåŠ¡åŒ–è§£å†³æ–¹æ¡ˆæ˜¯ç»™æä¾›ç›¸åŒæœåŠ¡æä¾›ä¸€ä¸ªç»Ÿä¸€çš„åŸŸåï¼Œç„¶åæœåŠ¡è°ƒç”¨è€…å‘è¿™ä¸ªåŸŸåå‘é€HTTPè¯·æ±‚ï¼Œç”±Nginxè´Ÿè´£è¯·æ±‚çš„åˆ†å‘å’Œè·³è½¬ ä½†æ˜¯è¿™æ ·æœ‰ä¸å°‘ç¼ºç‚¹: Nginxä½œä¸ºä¸­é—´å±‚ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­è€¦åˆäº†æœåŠ¡è°ƒç”¨çš„é€»è¾‘ï¼Œè¿™å‰Šå¼±äº†å¾®æœåŠ¡çš„å®Œæ•´æ€§ï¼Œä¹Ÿä½¿å¾—Nginxåœ¨ä¸€å®šç¨‹åº¦ä¸Šå˜æˆäº†ä¸€ä¸ªé‡é‡çº§çš„ESB. æœåŠ¡çš„ä¿¡æ¯åˆ†æ•£åœ¨å„ä¸ªç³»ç»Ÿï¼Œæ— æ³•ç»Ÿä¸€ç®¡ç†å’Œç»´æŠ¤ã€‚æ¯ä¸€æ¬¡çš„æœåŠ¡è°ƒç”¨éƒ½æ˜¯ä¸€æ¬¡å°è¯•ï¼ŒæœåŠ¡æ¶ˆè´¹è€…å¹¶ä¸çŸ¥é“æœ‰å“ªäº›å®ä¾‹åœ¨ç»™ä»–ä»¬æä¾›æœåŠ¡ã€‚è¿™ä¸ç¬¦åˆDevOpsçš„ç†å¿µã€‚ æ— æ³•ç›´è§‚çš„çœ‹åˆ°æœåŠ¡æä¾›è€…å’ŒæœåŠ¡æ¶ˆè´¹è€…å½“å‰çš„è¿è¡Œå’Œé€šä¿¡é¢‘ç‡ã€‚è¿™ä¹Ÿä¸ç¬¦åˆDevOpsçš„ç†å¿µã€‚ æ¶ˆè´¹è€…çš„å¤±è´¥é‡å‘ï¼Œè´Ÿè½½å‡è¡¡ç­‰éƒ½æ²¡æœ‰ç»Ÿä¸€ç­–ç•¥ï¼Œè¿™åŠ å¤§äº†å¼€å‘æ¯ä¸ªæœåŠ¡çš„éš¾åº¦ï¼Œä¸åˆ©äºå¿«ç†Ÿæ¼”åŒ–ã€‚ ä¸ºäº†è§£å†³ä¸Šé¢çš„é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªç°æˆçš„ä¸­å¿ƒåŒ–ç»„ä»¶å¯¹æœåŠ¡è¿›è¡Œæ•´åˆï¼Œå°†æ¯ä¸ªæœåŠ¡çš„ä¿¡æ¯æ•´åˆï¼ŒåŒ…æ‹¬æœåŠ¡çš„ç»„ä»¶åç§°ã€åœ°å€ã€æ•°é‡ç­‰ã€‚æœåŠ¡çš„è°ƒç”¨æ–¹åœ¨è¯·æ±‚æ¯é¡¹æœåŠ¡æ—¶é¦–å…ˆé€šè¿‡ä¸­å¿ƒç»„ä»¶è·å–æä¾›è¿™é¡¹æœåŠ¡çš„å®ä¾‹çš„ä¿¡æ¯ï¼ˆIPã€ç«¯å£ç­‰ï¼‰ï¼Œå†é€šè¿‡é»˜è®¤æˆ–è‡ªå®šä¹‰çš„ç­–ç•¥é€‰æ‹©è¯¥æœåŠ¡çš„æŸä¸€æä¾›è€…ç›´æ¥è¿›è¡Œè®¿é—®ï¼Œæ‰€ä»¥æˆ‘ä»¬å¼•å…¥äº†Dubboã€‚ åŸºäºDubboå®ç°å¾®æœåŠ¡Dubboæ˜¯é˜¿é‡Œå¼€æºçš„ä¸€ä¸ªSOAæœåŠ¡æ²»ç†è§£å†³æ–¹æ¡ˆï¼Œæ–‡æ¡£ä¸°å¯Œï¼Œåœ¨å›½å†…çš„ä½¿ç”¨åº¦éå¸¸é«˜ã€‚ ä½¿ç”¨Dubboæ„å»ºçš„å¾®æœåŠ¡ï¼Œå·²ç»æ¯”è¾ƒå¥½åœ°è§£å†³ä¸Šé¢æåˆ°çš„é—®é¢˜ï¼š è°ƒç”¨ä¸­é—´å±‚å˜æˆäº†å¯é€‰ç»„ä»¶ï¼Œæ¶ˆè´¹è€…å¯ä»¥ç›´æ¥è®¿é—®æœåŠ¡æä¾›è€… æœåŠ¡ä¿¡æ¯è¢«é›†ä¸­åˆ°Registryä¸­ï¼Œå½¢æˆäº†æœåŠ¡æ²»ç†çš„ä¸­å¿ƒç»„ä»¶ã€‚ é€šè¿‡Monitorç›‘æ§ç³»ç»Ÿï¼Œå¯ä»¥ç›´è§‚åœ°å±•ç¤ºæœåŠ¡è°ƒç”¨çš„ç»Ÿè®¡ä¿¡æ¯ã€‚ Consumerå¯ä»¥è¿›è¡Œè´Ÿè½½å‡è¡¡ã€æœåŠ¡é™çº§çš„é€‰æ‹© ä½†æ˜¯å¯¹äºå¾®æœåŠ¡æ¶æ„è€Œè¨€ï¼ŒDubboä¹Ÿå¹¶ä¸æ˜¯åå…¨åç¾çš„ï¼š Registryä¸¥é‡ä¾èµ–ç¬¬ä¸‰æ–¹ç»„ä»¶ï¼ˆZookeeperæˆ–è€…redisï¼‰ï¼Œå½“è¿™äº›ç»„ä»¶å‡ºç°é—®é¢˜ï¼ŒæœåŠ¡è°ƒç”¨å¾ˆå¿«å°±ä¼šä¸­æ–­ï¼ˆå½“ç„¶ï¼Œæˆ‘ä¹‹å‰ä¹Ÿè¯•è¿‡ä¸­æ–­æ—¶ï¼Œä¼šæœ‰ç¼“å­˜è¿˜æ˜¯å¯ä»¥è°ƒç”¨ï¼‰ Dubboåªæ”¯æŒRPCè°ƒç”¨ã€‚ä½¿å¾—æœåŠ¡æä¾›æ–¹ä¸è°ƒç”¨æ–¹åœ¨ä»£ç ä¸Šäº§ç”Ÿäº†å¼ºä¾èµ–ï¼ŒæœåŠ¡æä¾›è€…éœ€è¦ä¸æ–­å°†åŒ…å«å…¬å…±ä»£ç çš„jaråŒ…æ‰“åŒ…å‡ºæ¥ä¾›æ¶ˆè´¹è€…ä½¿ç”¨ã€‚ä¸€æ—¦æ‰“åŒ…å‡ºç°é—®é¢˜ï¼Œå°±ä¼šå¯¼è‡´æœåŠ¡è°ƒç”¨å‡ºç°é—®é¢˜ï¼ˆå…¬å…±ä»£ç æ˜¯æŒ‡ åŒ…å«å…¬å…±é…ç½®ï¼šDO(å’Œæ•°æ®åº“åŒæ­¥ï¼Œç”¨äºæŒä¹…åŒ–å¯¹è±¡)ï¼ŒVO(ä¼ è¾“æ•°æ®)ï¼Œå·¥å…·åŒ…ï¼Œæ¥å£ç­‰ï¼‰ æ–°çš„é€‰æ‹©â€“Spring clouddubboå’Œspring cloud åŒºåˆ« Dubbo Spring Cloud æœåŠ¡æ³¨å†Œä¸­å¿ƒ Zookeeper Spring Cloud Netflix Eureka æœåŠ¡è°ƒç”¨æ–¹å¼ RPC REST API æœåŠ¡ç›‘æ§ Dubbo-monitor Spring Boot Admin æ–­è·¯å™¨ ä¸å®Œå–„ Spring Cloud Netflix Hystrix æœåŠ¡ç½‘å…³ æ—  Spring Cloud Netflix Zuul åˆ†å¸ƒå¼é…ç½® æ—  Spring Cloud Config æœåŠ¡è·Ÿè¸ª æ—  Spring Cloud Sleuth æ¶ˆæ¯æ€»çº¿ æ—  Spring Cloud Bus æ•°æ®æµ æ—  Spring Cloud Stream æ‰¹é‡ä»»åŠ¡ æ—  Spring Cloud Task æœåŠ¡è°ƒç”¨æ–¹å¼ï¼šSpring Cloud æŠ›å¼ƒäº†Dubboçš„RPCé€šä¿¡ï¼Œé‡‡ç”¨çš„æ˜¯åŸºäºHTTPçš„RESTæ–¹å¼ã€‚ä¸¥æ ¼æ¥è¯´ï¼Œè¿™ä¸¤ç§å„æœ‰ä¼˜åŠ£ã€‚è™½ç„¶ä»ä¸€å®šç¨‹åº¦ä¸Šæ¥è¯´ï¼Œåè€…ç‰ºç‰²äº†æœåŠ¡è°ƒç”¨çš„æ€§èƒ½ï¼Œä½†ä¹Ÿé¿å…äº†ä¸Šé¢æåˆ°çš„åŸç”ŸRPCå¸¦æ¥çš„é—®é¢˜ã€‚è€Œä¸”RESTç›¸æ¯”RPCæ›´ä¸ºçµæ´»ï¼ŒæœåŠ¡æä¾›æ–¹å’Œè°ƒç”¨çš„ä¾èµ–åªä¾èµ–ä¸€çº¸å¥‘çº¦ï¼Œä¸å­˜åœ¨ä»£ç çº§åˆ«çš„å¼ºä¾èµ–ï¼Œè¿™åœ¨å¼ºè°ƒå¿«é€Ÿæ¼”åŒ–çš„å¾®æœåŠ¡ç¯å¢ƒä¸‹ï¼Œæ˜¾å¾—æ›´åŠ åˆé€‚ã€‚","categories":[{"name":"Spring cloud","slug":"Spring-cloud","permalink":"http://yoursite.com/categories/Spring-cloud/"}],"tags":[{"name":"Spring cloud","slug":"Spring-cloud","permalink":"http://yoursite.com/tags/Spring-cloud/"}]},{"title":"hexoå¤§è‡´æ•™ç¨‹","slug":"hexo","date":"2020-01-10T03:16:18.000Z","updated":"2020-03-09T10:42:24.917Z","comments":true,"path":"2020/01/10/hexo/","link":"","permalink":"http://yoursite.com/2020/01/10/hexo/","excerpt":"","text":"æ­¥éª¤ å®‰è£…npm,å¹¶é…ç½®æ·˜å®é•œåƒ ä¸‹è½½hexo 1$ npm install -g hexo-cli ä¿®æ”¹theme 12æ•™ç¨‹ https:&#x2F;&#x2F;xaoxuu.com&#x2F;wiki&#x2F;material-x&#x2F;index.htmlå®Œæˆåï¼š ä¿®æ”¹_config.ymlä¸­çš„themeé…ç½® éƒ¨ç½²åˆ°ç”¨æˆ·å.github.io 12345å¤§è‡´æ•™ç¨‹ï¼š https:&#x2F;&#x2F;www.bilibili.com&#x2F;read&#x2F;cv2204874&#x2F;æ–°å»ºmdï¼š hexo new æ–‡ä»¶åä¼šåœ¨&#x2F;source&#x2F;_posts&#x2F;æ–‡ä»¶å.mdhexo d -g","categories":[{"name":"Hexo","slug":"Hexo","permalink":"http://yoursite.com/categories/Hexo/"}],"tags":[{"name":"Hexo","slug":"Hexo","permalink":"http://yoursite.com/tags/Hexo/"}]},{"title":"Hello World","slug":"hello-world","date":"2020-01-10T02:35:18.889Z","updated":"2020-01-10T02:35:18.889Z","comments":true,"path":"2020/01/10/hello-world/","link":"","permalink":"http://yoursite.com/2020/01/10/hello-world/","excerpt":"","text":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new \"My New Post\" More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment","categories":[],"tags":[]}]}